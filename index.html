
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>龍昌博客</title>
  <meta name="author" content="龍昌">

  
  <meta name="description" content="jQuery 如果想要在 angular 内部调用 jQuery 的函数（如 jQuery 的 ajax 功能）比较简单，直接调用 $.ajax 即可。
但是如果想要在 angular 外部调用其函数就稍微麻烦一点，毕竟这也与 angular 的设计理念不符。 1
2
3
4
5
6
7
8
9 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.xefan.com/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="龍昌博客" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.useso.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">龍昌博客</a></h1>
  
    <h2>从Pythoneer转向Rubist</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.xefan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
 <li><a href="/about/">About</a></li>  <li><a href="/gbook/">留言板</a></li> 
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84155.html">AngularJS学习笔记6——与jQuery、Bootstrap结合</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-24T10:25:28+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:25 am</span></time>
        
           | <a href="http://www.xefan.com/archives/84155.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84155.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>jQuery</h2>

<p>如果想要在 angular 内部调用 jQuery 的函数（如 jQuery 的 ajax 功能）比较简单，直接调用 <code>$.ajax</code> 即可。<br/>
但是如果想要在 angular 外部调用其函数就稍微麻烦一点，毕竟这也与 angular 的设计理念不符。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div ng-controller="PageController"&gt;
</span><span class='line'>  ...
</span><span class='line'>&lt;/div&gt;
</span><span class='line'>
</span><span class='line'>&lt;script&gt;
</span><span class='line'>  var appModule = angular.module('myApp', []);
</span><span class='line'>  appModule.controller('PageController', ['$scope', '$http', function($scope, $http){
</span><span class='line'>      ...
</span><span class='line'>  }]);</span></code></pre></td></tr></table></div></figure>


<p>例如上个这段代码，如果想要从外部访问 <code>PageController</code> 中的某些内容。则可以先获取 <code>PageController</code> 的上下文对象($scope)：<code>angular.element($('[ng-controller="PageController"]')).scope();</code><br/>
在外部修改了 <code>scope</code> 的某些值时会发现对应的视图并没有更新，这时还需要调用 <code>scope</code> 的 <code>$digest</code> 方法进行同步，或者直接调用 <code>$apply</code> 方法进行操作。</p>

<h2>Bootstrap</h2>

<p>之前使用 angularjs 时遇到了 Bootstrap 的控件不能正常使用了，如 dropdown 组件点击了没有效果。<br/>
经过分析发现是 angularjs 将 Bootstrap 的组件的事件给截获了。</p>

<p>好在有 angular-bootstrap 这么一个组件可以将它们整合在一起。</p>

<p><a href="http://angular-ui.github.io/bootstrap/">http://angular-ui.github.io/bootstrap/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84154.html">在Ruby中使用DATA和__END__将代码和数据混合</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-23T10:12:08+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>10:12 am</span></time>
        
           | <a href="http://www.xefan.com/archives/84154.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84154.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>之前一直不理解 <code>__END__</code> 的用法，现在看了这篇文章后才算是了解了，于是便翻译之。<br/>
《Mixing code and data in Ruby with DATA and __END__》: <a href="http://blog.honeybadger.io/data-and-end-in-ruby/">http://blog.honeybadger.io/data-and-end-in-ruby/</a></p>

<hr />

<p>你知道 Ruby 提供了一种方法在你的脚本中可以将源文件作为数据源来使用吗？当你在写一些一次性的脚本用于验证概念时这个小技巧会为你节约一些时间。让我们来看看吧。</p>

<h2>DATA 和 __END__</h2>

<p>在下面这个例子中，我使用了一个有趣的关键字 <code>__END__</code>。所有在 <code>__END__</code> 下面的内容将会被 Ruby 解释器所忽略。但是有趣的是 ruby 为你提供了一个称为 <code>DATA</code> 的 IO 对象，就像你可以读取其他任何文件一样，它能让你读取到 <code>__END__</code> 以下的所有内容。</p>

<p>下面这个例子中，我们遍历每一行并进行输出。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">DATA</span><span class="o">.</span><span class="n">each_line</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">line</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">__END__</span>
</span><span class='line'><span class="cp">Doom</span>
</span><span class='line'><span class="cp">Quake</span>
</span><span class='line'><span class="cp">Diablo</span>
</span></code></pre></td></tr></table></div></figure>


<p>关于这个技术我最喜欢的实例是使用 <code>DATA</code> 来包含一个 ERB 模板。它同样也可用于 YAML、CSV等等。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;erb&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">time</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
</span><span class='line'><span class="n">renderer</span> <span class="o">=</span> <span class="no">ERB</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">DATA</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">renderer</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="cp">__END__</span>
</span><span class='line'><span class="cp">The current time is &lt;%= time %&gt;.</span>
</span></code></pre></td></tr></table></div></figure>


<p>实际上你也可以使用 <code>DATA</code> 来读取 <code>__END__</code> 关键字以上的内容。那是因为 <code>DATA</code> 实际上是一个指向了整个源文件，并定位到 <code>__END__</code> 关键字的位置。你可以试试看在输出之前将 IO 对象反转。下面这个例子将会输出整个源文件。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">DATA</span><span class="o">.</span><span class="n">rewind</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">DATA</span><span class="o">.</span><span class="n">read</span> <span class="c1"># prints the entire source file</span>
</span><span class='line'>
</span><span class='line'><span class="cp">__END__</span>
</span><span class='line'><span class="cp">meh</span>
</span></code></pre></td></tr></table></div></figure>


<h2>多文件问题</h2>

<p>这个技术最大的缺点是它只能用于单个文件的脚本，直接运行该文件，不能在其他文件进行导入。</p>

<p>下面这个例子，我们有两个文件，并且每个都有它们自己的 <code>__END__</code> 部分。然而却只有一个全局 <code>DATA</code> 对象。因此第二个文件的 <code>__END__</code> 部分刚访问不到了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># first.rb</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;./second&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;First file</span><span class="se">\n</span><span class="s2">----------------------&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">DATA</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'>
</span><span class='line'><span class="n">print_second_data</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="cp">__END__</span>
</span><span class='line'><span class="cp">First end clause</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># second.rb</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">print_second_data</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Second file</span><span class="se">\n</span><span class="s2">----------------------&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="no">DATA</span><span class="o">.</span><span class="n">read</span> <span class="c1"># Won&#39;t output anything, since first.rb read the entire file</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">__END__</span>
</span><span class='line'><span class="cp"> </span>
</span><span class='line'><span class="cp">Second end clause</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">snhorne</span> <span class="o">~</span><span class="sr">/tmp $ ruby first.rb</span>
</span><span class='line'><span class="sr">First file</span>
</span><span class='line'><span class="sr">----------------------</span>
</span><span class='line'><span class="sr">First end clause</span>
</span><span class='line'><span class="sr"> </span>
</span><span class='line'><span class="sr">Second file</span>
</span><span class='line'><span class="sr">----------------------</span>
</span></code></pre></td></tr></table></div></figure>


<h2>对于多文件的一个解决方案</h2>

<p>在 Sinatra 中有一个很酷的特性是它允许你在你应用的 <code>__END__</code> 部分添加多个内联模板。它看起来像下面这样：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># This code is from the Sinatra docs at http://www.sinatrarb.com/intro.html</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">haml</span> <span class="ss">:index</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">__END__</span>
</span><span class='line'><span class="cp"> </span>
</span><span class='line'><span class="cp">@@ layout</span>
</span><span class='line'><span class="cp">%html</span>
</span><span class='line'><span class="cp"> </span>
</span><span class='line'><span class="cp">  = yield</span>
</span><span class='line'><span class="cp"> </span>
</span><span class='line'><span class="cp">@@ index</span>
</span><span class='line'><span class="cp">%div.title Hello world.</span>
</span></code></pre></td></tr></table></div></figure>


<p>sinatra 是如何实现的呢？毕竟你的应用可能是运行在 rack 上。在生产环境中你不能再通过 <code>ruby myapp.rb</code> 来运行！他们必须有一种在多文件中使用 <code>DATA</code> 的解决方案。</p>

<p>因此如果你稍微深入一下 Sinatra 的源代码，你会发现它们并没有使用 <code>DATA</code>。而是使用了跟下面这段代码类似的方案。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># I&#39;m paraphrasing. See the original at https://github.com/sinatra/sinatra/blob/master/lib/sinatra/base.rb#L1284</span>
</span><span class='line'><span class="n">app</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/^__END__$/</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>实际上它比这个要更复杂一些，因为它们不想读取 <code>__FILE__</code>，它只是 <code>sinatra/base.rb</code> 文件。它们其实是需要获取调用了该方法的文件的内容。它们通过解析 <code>caller</code> 的结果来获取。</p>

<p><code>caller</code> 方法将会告诉你当前运行的方法是从哪调用的。这里是个简单的例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">some_method</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="nb">caller</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">some_method</span> <span class="c1"># =&gt; caller.rb:5:in `&lt;main&gt;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在可以简单地获取到文件名了，然后从该文件中再提取出与 <code>DATA</code> 等价的内容。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">get_caller_data</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">caller</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__END__&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">last</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>请善用它，不要作恶</h2>

<p>希望对于这些技巧你不要经常使用。它们不会使得代码干净、可维护。</p>

<p>然后，你偶尔需要一些又快又脏的实现一个一次性的脚本或者验证一些概念。此时 <code>DATA</code> 和 <code>__END__</code> 就非常有用了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84153.html">Mac下使用supervisor进行服务管理</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-22T17:32:32+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>5:32 pm</span></time>
        
           | <a href="http://www.xefan.com/archives/84153.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84153.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近刚切换到 Mac 平台上，感觉各种不适应。之前使用 Ubuntu 时，有 service 命令可以对服务进行管理，
但是在 Mac 系统下没有对应的工具。也许有人说可以用 launchctl 啊。但是 launchctl 的服务是开机自动启动的，
而我又不想要开机自动启动，只想在需要时启动，使用完后就停止。</p>

<p>由于没有相应的工具，因此我只得在终端下通过命令来启动服务，但是这个又得一直打开着一个新的终端标签。
对于有洁癖的我来说，表示很不爽。本来想自己写个脚本来管理的，但是这个又得针对每个服务写个脚本，也很麻烦。
正在纠结的时候想起了还有 supervisor 可以用。</p>

<p>supervisor 是使用 python 开发的一个后台服务管理程序。</p>

<p>首先使用 brew 安装 python 工具： <code>brew install python</code>，并覆盖掉系统自带的 python。
因为我有洁癖不想将软件安装在系统目录中，因此就再单独安装一个 python。
若对此不在意的可跳过此步。</p>

<p>然后再安装 supervisor： <code>pip install supervisor</code>。
supervisor 不支持 python3，并且如果你使用的是系统自带的 python ，可能需要在命令前加上 sudo。</p>

<p>安装完成之后默认是不会创建配置文件的，因此再手动创建配置文件 <code>/usr/local/etc/supervisord.conf</code>，我的配置如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[unix_http_server]
</span><span class='line'>file=/tmp/supervisor.sock                                 ; path to your socket file
</span><span class='line'>
</span><span class='line'>[supervisord]
</span><span class='line'>logfile=/usr/local/var/log/supervisord/supervisord.log    ; supervisord log file
</span><span class='line'>logfile_maxbytes=50MB                                     ; maximum size of logfile before rotation
</span><span class='line'>logfile_backups=10                                        ; number of backed up logfiles
</span><span class='line'>loglevel=error                                            ; info, debug, warn, trace
</span><span class='line'>pidfile=/usr/local/var/run/supervisord.pid                ; pidfile location
</span><span class='line'>nodaemon=false                                            ; run supervisord as a daemon
</span><span class='line'>minfds=1024                                               ; number of startup file descriptors
</span><span class='line'>minprocs=200                                              ; number of process descriptors
</span><span class='line'>user=root                                                 ; default user
</span><span class='line'>childlogdir=/usr/local/var/log/supervisord/               ; where child log files will live
</span><span class='line'>
</span><span class='line'>[rpcinterface:supervisor]
</span><span class='line'>supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
</span><span class='line'>
</span><span class='line'>[supervisorctl]
</span><span class='line'>serverurl=unix:///tmp/supervisor.sock                     ; use a unix:// URL  for a unix socket
</span><span class='line'>
</span><span class='line'>[program:mongod]
</span><span class='line'>command=/usr/local/bin/mongod --config /usr/local/etc/mongod.conf
</span><span class='line'>autostart=false
</span><span class='line'>autorestart=true
</span><span class='line'>
</span><span class='line'>[program:redis]
</span><span class='line'>command=/usr/local/bin/redis-server /usr/local/etc/redis.conf
</span><span class='line'>autostart=false
</span><span class='line'>autorestart=true
</span><span class='line'>
</span><span class='line'>[program:nginx]
</span><span class='line'>command=/usr/local/bin/nginx -c /usr/local/etc/nginx/nginx.conf
</span><span class='line'>autostart=false
</span><span class='line'>autorestart=true</span></code></pre></td></tr></table></div></figure>


<p>这里我的这几个服务都没有设置为自动启动，如有需要可自行将 <code>autostart</code> 设置为 true。</p>

<p>最后执行 <code>supervisord</code> 命令启动 supervisor 服务。之后就可以通过 <code>supervisorctl</code> 命令来进行服务管理了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84152.html">Riot.js之初体验</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-21T09:55:14+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>9:55 am</span></time>
        
           | <a href="http://www.xefan.com/archives/84152.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84152.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Riot(<a href="http://riotjs.com/">http://riotjs.com/</a>)按照官方的介绍，它是一个类似于 React 的微型框架。
压缩之后的文件只有差不多 15K 的大小，相比其他基本上都是上百K大小的框架来说确实是很微型的。</p>

<p>同时它的官方还给出了与 React 和 Polymer 的对比，各位感兴趣可以看看： <a href="http://riotjs.com/compare/">http://riotjs.com/compare/</a></p>

<p>下面通过一个例子来体验一下。</p>

<p>先下载 Riot 库文件： <a href="https://raw.githubusercontent.com/riot/riot/master/riot+compiler.min.js  ">https://raw.githubusercontent.com/riot/riot/master/riot+compiler.min.js  </a>
然后新建一个文件 <code>index.html</code>，内容如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>Tabs exampe<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nc">.tabContent__item</span><span class="p">{</span>
</span><span class='line'>        <span class="k">display</span><span class="o">:</span><span class="k">none</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nc">.tabContent__item.is-active</span><span class="p">{</span>
</span><span class='line'>        <span class="k">display</span><span class="o">:</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="nt">&lt;/style&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;riot-tabs&gt;&lt;/riot-tabs&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;tabs.tag&quot;</span> <span class="na">type=</span><span class="s">&quot;riot/tag&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;riot+compiler.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nx">riot</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;riot-tabs&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>接着再创建文件 <code>tabs.tag</code>：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;riot-tabs&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h2&gt;</span>Tabs<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li</span> <span class="na">each=</span><span class="s">{</span> <span class="na">tab</span><span class="err">,</span> <span class="na">i</span> <span class="na">in</span> <span class="na">tabs</span> <span class="err">}</span> <span class="na">class=</span><span class="s">&quot;tabItem { is-active: parent.isActiveTab(tab.ref) }&quot;</span> <span class="na">onclick=</span><span class="s">{</span> <span class="na">parent</span><span class="err">.</span><span class="na">toggleTab</span> <span class="err">}</span><span class="nt">&gt;</span>{tab.title}<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;tabContent&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">each=</span><span class="s">{</span> <span class="na">tab</span><span class="err">,</span> <span class="na">i</span> <span class="na">in</span> <span class="na">tabs</span> <span class="err">}</span> <span class="na">class=</span><span class="s">&quot;tabContent__item { is-active: parent.isActiveTab(tab.ref) }&quot;</span><span class="nt">&gt;</span>{tab.content}<span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>  this.tabs = [
</span><span class='line'>    { title: &#39;Tab 1&#39;, ref: &#39;tab1&#39;, content: &quot;(1) Lorem ipsum dolor&quot; },
</span><span class='line'>    { title: &#39;Tab 2&#39;, ref: &#39;tab2&#39;, content: &quot;(2) Lorem ipsum dolor&quot; },
</span><span class='line'>    { title: &#39;Tab 3&#39;, ref: &#39;tab3&#39;, content: &quot;(3) Lorem ipsum dolor&quot; }
</span><span class='line'>  ]
</span><span class='line'>
</span><span class='line'>  this.activeTab = &#39;tab1&#39;
</span><span class='line'>
</span><span class='line'>  isActiveTab(tab) {
</span><span class='line'>    return this.activeTab === tab
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  toggleTab(e) {
</span><span class='line'>    this.activeTab = e.item.tab.ref
</span><span class='line'>    return true
</span><span class='line'>  }
</span><span class='line'><span class="nt">&lt;/riot-tabs&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这个是 javascript 与 html 的混合。当然还可以使用纯 js 的写法，将 <code>tabs.tag</code> 改为 <code>tabs.js</code>：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>riot.tag(&#39;riot-tabs&#39;, &#39;<span class="nt">&lt;h2&gt;</span>Tabs<span class="nt">&lt;/h2&gt;</span> <span class="nt">&lt;ul&gt;</span> <span class="nt">&lt;li</span> <span class="na">each=</span><span class="s">&quot;{ tab, i in tabs }&quot;</span> <span class="na">class=</span><span class="s">&quot;tabItem { is-active: parent.isActiveTab(tab.ref) }&quot;</span> <span class="na">onclick=</span><span class="s">&quot;{ parent.toggleTab }&quot;</span><span class="nt">&gt;</span>{tab.title}<span class="nt">&lt;/li&gt;</span> <span class="nt">&lt;/ul&gt;</span> <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;tabContent&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;div</span> <span class="na">each=</span><span class="s">&quot;{ tab, i in tabs }&quot;</span> <span class="na">class=</span><span class="s">&quot;tabContent__item { is-active: parent.isActiveTab(tab.ref) }&quot;</span><span class="nt">&gt;</span>{tab.content}<span class="nt">&lt;/div&gt;</span> <span class="nt">&lt;/div&gt;</span>&#39;, function(opts) {
</span><span class='line'>
</span><span class='line'>  this.tabs = [
</span><span class='line'>    { title: &#39;Tab 1&#39;, ref: &#39;tab1&#39;, content: &quot;(1) Lorem ipsum dolor&quot; },
</span><span class='line'>    { title: &#39;Tab 2&#39;, ref: &#39;tab2&#39;, content: &quot;(2) Lorem ipsum dolor&quot; },
</span><span class='line'>    { title: &#39;Tab 3&#39;, ref: &#39;tab3&#39;, content: &quot;(3) Lorem ipsum dolor&quot; }
</span><span class='line'>  ];
</span><span class='line'>
</span><span class='line'>  this.activeTab = &#39;tab1&#39;;
</span><span class='line'>
</span><span class='line'>  this.isActiveTab = function(tab) {
</span><span class='line'>    return this.activeTab === tab;
</span><span class='line'>  }.bind(this);
</span><span class='line'>
</span><span class='line'>  this.toggleTab = function(e) {
</span><span class='line'>    this.activeTab = e.item.tab.ref;
</span><span class='line'>    return true;
</span><span class='line'>  }.bind(this);
</span><span class='line'>
</span><span class='line'>});
</span></code></pre></td></tr></table></div></figure>


<p>同时将 <code>index.html</code> 中的 <code>&lt;script src="tabs.tag" type="riot/tag"&gt;&lt;/script&gt;</code> 修改为 <code>&lt;script src="tabs.js" type="riot/tag"&gt;&lt;/script&gt;</code> 。</p>

<p>好了，现在打开浏览器看下效果吧。</p>

<p>体验了一下，感觉它比 angular 之类的框架的学习成本要低。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84151.html">AngularJS学习笔记5——路由</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-20T20:58:53+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:58 pm</span></time>
        
           | <a href="http://www.xefan.com/archives/84151.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84151.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>angularjs 的 <code>ngRoute</code> 模块提供了前端路由的功能。
在 angularjs 1.3 中 route 模块被单独提取了出来，要使用其功能需要将引用进来。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;script src="/lib/angular-1.3.15.min.js"&gt;&lt;/script&gt;
</span><span class='line'>  &lt;script src="/lib/angular-route-1.3.15.min.js"&gt;&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var routeApp = angular.module('routeApp', ['ngRoute']);
</span><span class='line'>routeApp.config(['$routeProvider',function ($routeProvider) {
</span><span class='line'>    $routeProvider
</span><span class='line'>    .when('/list', {
</span><span class='line'>      templateUrl: 'list.html',
</span><span class='line'>      controller: 'RouteListCtl'
</span><span class='line'>    })
</span><span class='line'>    .when('/list/:id', {
</span><span class='line'>        templateUrl: 'detail.html',
</span><span class='line'>        controller: 'RouteDetailCtl'
</span><span class='line'>    })
</span><span class='line'>    .otherwise({
</span><span class='line'>      redirectTo: '/list'
</span><span class='line'>    });
</span><span class='line'>}]);</span></code></pre></td></tr></table></div></figure>


<p>这里定义了两条路由规则，对应的视图模板分别为 list.html 和 detail.html</p>

<p>视图模板有三种定义方式：<br/>
方法1：编写在单独的文件中，然后 angularjs 通过 ajax 获取其内容；<br/>
方法2：直接在页面中使用 script 标签定义，如： <code>&lt;script type="text/ng-template" id="list.html"&gt; .... &lt;/script&gt;</code>；<br/>
方法3：使用 <code>$templateCache</code> 进行定义，如:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>routeApp.run(function($templateCache) {
</span><span class='line'>  $templateCache.put('list.html', '...');
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84150.html">AngularJS学习笔记4——依赖注入</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-19T13:33:33+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:33 pm</span></time>
        
           | <a href="http://www.xefan.com/archives/84150.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84150.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>依赖注入</h2>

<p>之前有遇到过 angularjs 的代码压缩之后就报错了，通过查文档得知是因为 angularjs 是通过变量名来查找相应服务的。
而 js 代码压缩之后变量名就变化了，从而无法找到相应的服务而报错。因此就需要指明依赖服务。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function SomeController($scope, $http) { ... }</span></code></pre></td></tr></table></div></figure>


<p>例如以上代码就是定义了 <code>SomeController</code> 这个一个控制器，并依赖 <code>$scope</code> 和 <code>$http</code> 两个服务。
但是当该代码压缩之后，这两个参数名都变化了。因此还需要使用以下代码来指明所需的依赖。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SomeController.$inject = ['$scope', '$http'];</span></code></pre></td></tr></table></div></figure>


<p>或者另一个写法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>angular.module('app', [])
</span><span class='line'>       .controller('SomeController', ['$scope', '$http', function($scope, $http){
</span><span class='line'>
</span><span class='line'>}]);</span></code></pre></td></tr></table></div></figure>


<p>这样就可以保证我们的代码压缩之后也能正常运行了。</p>

<h2>自定义服务</h2>

<p>上面的 <code>$http</code> 服务为我们提供了 ajax 的功能。</p>

<p>需要自定义服务的可以使用 <code>module.factory</code> 方法或者 <code>module.service</code> 方法进行注册服务。
这两个方法稍微有些不同，一般我习惯使用 <code>module.factory</code> 。
然后在需要使用自定义服务的地方，将其添加到依赖列表中即可。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84149.html">AngularJS学习笔记3——表单</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-18T18:32:35+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:32 pm</span></time>
        
           | <a href="http://www.xefan.com/archives/84149.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84149.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>双向绑定</h2>

<p>使用 <code>ngModel</code> 指令将输入框与 model 进行绑定，如： <code>&lt;input type="text" ng-model="text" name="text" /&gt;</code><br/>
当输入框或者 model 的值其中一方改变都会影响另一方。</p>

<h2>表单验证</h2>

<p>之前表单验证都是用的 jquery-validation 这个插件，这需要编写大量的 js 代码用于逻辑控制，
现在改用 angularjs 之后方便了许多，不过还是要编写大量的视图代码。</p>

<p>一个简单的例子： <a href="https://github.com/wusuopu/angularjs-practice/blob/master/static/form/validate.html">https://github.com/wusuopu/angularjs-practice/blob/master/static/form/validate.html</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;form action="#" name="user_form" ng-submit="submitForm(user_form.$valid, $event)" novalidate&gt;
</span><span class='line'>
</span><span class='line'>    &lt;div class="form-group" ng-class="{'has-error' : user_form.name.$invalid && user_form.name.$dirty, 'has-success' : user_form.name.$valid}"&gt;
</span><span class='line'>        &lt;label&gt;Name&lt;/label&gt;
</span><span class='line'>        &lt;input type="text" name="name" class="form-control" ng-model="formData.name" required&gt;
</span><span class='line'>        &lt;p ng-show="user_form.name.$invalid && user_form.name.$dirty" class="help-block"&gt;You name is required.&lt;/p&gt;
</span><span class='line'>    &lt;/div&gt;
</span><span class='line'>.....
</span><span class='line'>&lt;/form&gt;</span></code></pre></td></tr></table></div></figure>


<p>首先为 form 表单设置 <code>name</code> 属性，并设置 <code>novalidate</code> 属性禁止浏览器使用 HTML5 自带的验证功能。
然后对于需要验证的字段添加相应的验证属性，angularjs 内建的验证规则如下：</p>

<ul>
<li>email</li>
<li>max</li>
<li>maxlength</li>
<li>min</li>
<li>minlength</li>
<li>number</li>
<li>pattern</li>
<li>required</li>
<li>url</li>
<li>date</li>
<li>datetimelocal</li>
<li>time</li>
<li>week</li>
<li>month</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84148.html">AngularJS学习笔记2——模板</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-14T22:00:21+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:00 pm</span></time>
        
           | <a href="http://www.xefan.com/archives/84148.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84148.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>ngRepeat</h2>

<p>对于一些需要循环遍历的对象可以使用 <code>ngRepeat</code> 指令。 如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;li ng-repeat="msg in messages"&gt; &lt;/li&gt;
</span><span class='line'>
</span><span class='line'>  // 对于 messages 数组进行遍历
</span><span class='line'>  $scope.messages =  [
</span><span class='line'>    "第一条消息",
</span><span class='line'>    "第二条消息",
</span><span class='line'>    "第三条消息",
</span><span class='line'>    "第四条消息",
</span><span class='line'>    "第五条消息"
</span><span class='line'>  ];
</span></code></pre></td></tr></table></div></figure>


<h2>ngSwitch</h2>

<p>使用 <code>ngSwitch</code> 指令在不同条件下显示不同内容。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div ng-controller="ExampleController"&gt;
</span><span class='line'>  &lt;select ng-model="selection" ng-options="item for item in items"&gt;
</span><span class='line'>  &lt;/select&gt;
</span><span class='line'>  &lt;code&gt;selection=&lt;/code&gt;
</span><span class='line'>  &lt;hr/&gt;
</span><span class='line'>  &lt;div class="animate-switch-container"
</span><span class='line'>    ng-switch="selection"&gt;
</span><span class='line'>      &lt;div class="animate-switch" ng-switch-when="settings"&gt;Settings Div&lt;/div&gt;
</span><span class='line'>      &lt;div class="animate-switch" ng-switch-when="home"&gt;Home Span&lt;/div&gt;
</span><span class='line'>      &lt;div class="animate-switch" ng-switch-default&gt;default&lt;/div&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/div&gt;
</span><span class='line'>
</span><span class='line'>&lt;script type="text/javascript"&gt;
</span><span class='line'>angular.module('myApp', []).controller('ExampleController', ['$scope', function($scope) {
</span><span class='line'>  $scope.items = ['settings', 'home', 'other'];
</span><span class='line'>  $scope.selection = $scope.items[0];
</span><span class='line'>}]);
</span><span class='line'>&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<h2>Filter</h2>

<p>使用 <code>filter</code> 指令过滤需要的内容，基本形式： &#8220;
如果有用过其他模板引擎的话（如：Jinja）应该很好理解的。</p>

<p>angularjs 提供了一些内置的过滤器：date, json, lowercase, uppercase 等。</p>

<h2>ngIf</h2>

<p>基本形式： <code>&lt;ANY ng-if="expression"&gt; ... &lt;/ANY&gt;</code>
当 <code>expression</code> 的值为真时才会输出该标签。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84147.html">AngularJS学习笔记1——基础入门</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-13T22:54:04+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:54 pm</span></time>
        
           | <a href="http://www.xefan.com/archives/84147.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84147.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>angularjs 是一款前端的 MVVM 框架，目前 2.0 好像也快要发布了。
angularjs 2.0 的理念又变为了 Web 组件，与 1.x 不兼容。
于是这里就把之前 angularjs 1.x 的学习笔记整理一下，作为以后回顾吧。</p>

<p>相关的事例代码可以从 <a href="https://github.com/wusuopu/angularjs-practice">https://github.com/wusuopu/angularjs-practice</a> 获取。</p>

<h2>简单事例</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!doctype html&gt;
</span><span class='line'>&lt;html lang="en" ng-app&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>    &lt;meta charset="utf-8"&gt;
</span><span class='line'>    &lt;title&gt;基本例子&lt;/title&gt;
</span><span class='line'>    &lt;script src="/lib/angular-1.0.4.min.js"&gt;&lt;/script&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>  &lt;p&gt;1 + 2 = 1&lt;/p&gt;
</span><span class='line'>  &lt;div ng-controller="DemoController"&gt;
</span><span class='line'>    &lt;p&gt;&lt;/p&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;script type="text/javascript" charset="utf-8"&gt;
</span><span class='line'>  function DemoController($scope){
</span><span class='line'>    $scope.content = "简单的控制器例子";
</span><span class='line'>  }
</span><span class='line'>&lt;/script&gt;
</span><span class='line'>&lt;/html&gt;</span></code></pre></td></tr></table></div></figure>


<p>以上是一个最简单的例子。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;html lang="en" ng-app&gt;</span></code></pre></td></tr></table></div></figure>


<p>html 的 <code>ng-app</code> 属性表明在该页面中启用 angularjs。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;p&gt;1 + 2 = 1&lt;/p&gt;</span></code></pre></td></tr></table></div></figure>


<p>在页面加载完成之后 angularjs 会解析大括号内的表达式，并进行渲染。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;div ng-controller="DemoController"&gt;
</span><span class='line'>    &lt;p&gt;&lt;/p&gt;
</span><span class='line'>  &lt;/div&gt;</span></code></pre></td></tr></table></div></figure>


<p><code>ng-controller</code> 表示在该标签下定义一个控制器。一个控制器就是一个普通的 js 函数。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script type="text/javascript" charset="utf-8"&gt;
</span><span class='line'>  function DemoController($scope){
</span><span class='line'>    $scope.content = "简单的控制器例子";
</span><span class='line'>  }
</span><span class='line'>&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p>这里定义 <code>DemoController</code> 控制器函数，并传入一个 <code>$scope</code> 参数，它是用于表示该控制器的上下文。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/84146.html">Unicorn是如何与nginx通讯的——介绍ruby中的unix Socket</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-03T16:01:52+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>4:01 pm</span></time>
        
           | <a href="http://www.xefan.com/archives/84146.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/84146.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ruby 应用服务典型地是与一个 web 服务一同使用的，如 nginx。当用户请求你的 Rails 应用中的页面时，nginx 将请求指派给应用服务。
然而这个过程是如何完成的呢？nginx 与 unicorn 是如何通讯的呢？</p>

<p>最有效的一种选择是使用 unix 套接字(sockets)。让我们来看看它们是如何工作的！
在这篇文章中我们将从一个基本的套接字(sockets)开始，最后将创建一个使用 nginx 代理的简单应用服务。</p>

<p><img src="/wp-content/uploads/2015/07/socket.png" alt="socket" /></p>

<p><em>套接字(sockets)允许进程之间通过对一个文件读或者写进行相互通讯。</em>
<em>在这个例子中 Unicorn 创建 socket 并监听它的连接。然后 Nginx 就可以连接到这个 socket 并与 Unicorn 通讯了。</em></p>

<h2>什么是 unix socket？</h2>

<p>Unix socket 使得一个进程通过类似文件的方式与另一个进程进行通讯。它是 IPC(Interprocess Communication) 的一种。</p>

<p>要使得可以通过 socket 访问进程，首先需要创建一个 socket 并作为一个文件保存在磁盘中。
然后监听这个 socket 的连入连接。当接收到一个连接时，就可以使用<a href="http://ruby-doc.org/core-2.2.2/IO.html#method-i-readline">标准 IO 方法</a>进行读写数据。</p>

<p>Ruby 通过以下一组类提供了 unix socket 所需的所有内容：</p>

<ul>
<li>UNIXServer - 创建 socket 并保存到磁盘中，并且让你可以监听新连接。</li>
<li>UNIXSocket - 打开已存在的套接字(sockets)。</li>
</ul>


<p><strong>注意：</strong>还存在着其它类型的 socket，最突出的是 TCP socket。不过这篇文章只处理 unix socket。那么它们之间的区别是什么呢？unix  socket 具有文件名。</p>

<h2>最简单的 Socket</h2>

<p>我们接下来看两个小程序。</p>

<p>第一个是服务端，它创建一个 <code>UnixServer</code> 实例，然后使用 <code>server.accept</code> 等待连接。当收到连接后则相互问候。</p>

<p>需要说明一下，<code>accept</code> 和 <code>readline</code> 方法都会阻塞程序的执行，直到收到内容。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;socket&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">server</span> <span class="o">=</span> <span class="no">UNIXServer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;/tmp/simple.sock&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;==== Waiting for connection&quot;</span>
</span><span class='line'><span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">accept</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;==== Got Request:&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">socket</span><span class="o">.</span><span class="n">readline</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;==== Sending Response&quot;</span>
</span><span class='line'><span class="n">socket</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;I read you loud and clear, good buddy!&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">socket</span><span class="o">.</span><span class="n">close</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里我们有了服务端，现在还需要客户端。</p>

<p>在下面这个例子中，我们打开由服务端创建的 socket，然后使用普通的 IO 方法进行发送和接收问候。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;socket&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">socket</span> <span class="o">=</span> <span class="no">UNIXSocket</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;/tmp/simple.sock&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;==== Sending&quot;</span>
</span><span class='line'><span class="n">socket</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello server, can you hear me?</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;==== Getting Response&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">socket</span><span class="o">.</span><span class="n">readline</span>
</span><span class='line'>
</span><span class='line'><span class="n">socket</span><span class="o">.</span><span class="n">close</span>
</span></code></pre></td></tr></table></div></figure>


<p>演示一下程序，先运行服务端，然后再运行客户端。你可以看到以下结果：</p>

<p><img src="/wp-content/uploads/2015/07/simple_ruby_socket_example.png" alt="simple_ruby_socket_example" />
<em>简单的 Unix socket 服务端/客户端交互的例子。左边是客户端，右边是服务端。</em></p>

<h2>与 nginx 接合</h2>

<p>现在我们知道如何创建一个 unix socket 的服务端了，我们可以很容易地与 nginx 接合。</p>

<p>不相信我？让我们来做一个快速的概念验证吧。我修改上面的代码使其输出从 socket 接收到的所有内容。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;socket&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Create the socket and &quot;save it&quot; to the file system</span>
</span><span class='line'><span class="n">server</span> <span class="o">=</span> <span class="no">UNIXServer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;/tmp/socktest.sock&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Wait until for a connection (by nginx)</span>
</span><span class='line'><span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">accept</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Read everything from the socket</span>
</span><span class='line'><span class="k">while</span> <span class="n">line</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">readline</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">line</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">socket</span><span class="o">.</span><span class="n">close</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在如果我修改 nginx 配置，将请求转发到 <code>/tmp/socktest.sock</code> socket 上。
我就能看到 nginx 发送来的数据了。(别担心，我们稍后会讨论它的配置的)</p>

<p>当我发起一个 web 请求时，nginx 将如下数据发送到我的服务端上：</p>

<p><img src="/wp-content/uploads/2015/07/request_http.png" alt="request_http" /></p>

<p>太酷了！这就是一个包含了额外头信息的 HTTP 请求。现在我们准备来构建一个真正的应用服务。
但是，首先让我们讨论一个 nginx 的配置吧。</p>

<h2>安装配置 Nginx</h2>

<p>如果你还没有安装 nginx 的话，请先安装。对于 OSX 可以 homebrew 简单完成：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">nginx</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在我们配置 nginx 将 localhost:2048 的请求通过名为 <code>/tmp/socktest.sock</code> 的 socket 转发到上游服务端。
名字可以是任意的，它仅需要与我们 web 服务的 socket 名字匹配即可。</p>

<p>你可以将其保存至 <code>/tmp/nginx.conf</code> 并通过命令 <code>nginx -c /tmp/nginx.conf</code> 运行 nginx。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Run nginx as a normal console program, not as a daemon</span>
</span><span class='line'><span class="n">daemon</span> <span class="n">off</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Log errors to stdout</span>
</span><span class='line'><span class="n">error_log</span> <span class="sr">/dev/s</span><span class="n">tdout</span> <span class="n">info</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">events</span> <span class="p">{}</span> <span class="c1"># Boilerplate</span>
</span><span class='line'>
</span><span class='line'><span class="n">http</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Print the access log to stdout</span>
</span><span class='line'>  <span class="n">access_log</span> <span class="sr">/dev/s</span><span class="n">tdout</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Tell nginx that there&#39;s an external server called @app living at our socket</span>
</span><span class='line'>  <span class="n">upstream</span> <span class="n">app</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">server</span> <span class="ss">unix</span><span class="p">:</span><span class="sr">/tmp/so</span><span class="n">cktest</span><span class="o">.</span><span class="n">sock</span> <span class="n">fail_timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">server</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Accept connections on localhost:2048</span>
</span><span class='line'>    <span class="n">listen</span> <span class="mi">2048</span><span class="p">;</span>
</span><span class='line'>    <span class="n">server_name</span> <span class="n">localhost</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Application root</span>
</span><span class='line'>    <span class="n">root</span> <span class="sr">/tmp;</span>
</span><span class='line'><span class="sr"> </span>
</span><span class='line'><span class="sr">    # If a path doesn&#39;t exist on disk, forward the request to @app</span>
</span><span class='line'><span class="sr">    try_files $uri/in</span><span class="n">dex</span><span class="o">.</span><span class="n">html</span> <span class="vg">$uri</span> <span class="vi">@app</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Set some configuration options on requests forwarded to @app</span>
</span><span class='line'>    <span class="n">location</span> <span class="vi">@app</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">proxy_set_header</span> <span class="n">X</span><span class="o">-</span><span class="no">Forwarded</span><span class="o">-</span><span class="no">For</span> <span class="vg">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span class='line'>      <span class="n">proxy_set_header</span> <span class="no">Host</span> <span class="vg">$http_host</span><span class="p">;</span>
</span><span class='line'>      <span class="n">proxy_redirect</span> <span class="n">off</span><span class="p">;</span>
</span><span class='line'>      <span class="n">proxy_pass</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="n">app</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以非后台模式运行 nginx。当你运行 nginx 时它应该看起来像如下这样：</p>

<p><img src="/wp-content/uploads/2015/07/nginx_non_daemon.png" alt="nginx_non_daemon" />
<em>Nginx 以非后台模式运行</em></p>

<h2>自定义应用服务</h2>

<p>既然我们已经知道了如何将 nginx 与我们程序进行连接，那么我们就来构建一个简单的应用服务。
当 nginx 将请求转发到我们的 socket 时，它是一个标准的 HTTP 请求。
经过一些处理后我可以决定 socket 是否会返回一个有效的 HTTP 响应，它会在浏览器中显示。</p>

<p>下面这个应用接受任何请求并显示时间戳。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;socket&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Connection creates the socket and accepts new connections</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Connection</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:path</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="ss">path</span><span class="p">:)</span>
</span><span class='line'>    <span class="vi">@path</span> <span class="o">=</span> <span class="n">path</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">server</span>
</span><span class='line'>    <span class="vi">@server</span> <span class="o">||=</span> <span class="no">UNIXServer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@path</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">on_request</span>
</span><span class='line'>    <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">accept</span>
</span><span class='line'>    <span class="k">yield</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
</span><span class='line'>    <span class="n">socket</span><span class="o">.</span><span class="n">close</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># AppServer logs incoming requests and renders a view in response</span>
</span><span class='line'><span class="k">class</span> <span class="nc">AppServer</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:connection</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:view</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="ss">connection</span><span class="p">:,</span> <span class="ss">view</span><span class="p">:)</span>
</span><span class='line'>    <span class="vi">@connection</span> <span class="o">=</span> <span class="n">connection</span>
</span><span class='line'>    <span class="vi">@view</span> <span class="o">=</span> <span class="n">view</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">run</span>
</span><span class='line'>    <span class="k">while</span> <span class="kp">true</span>
</span><span class='line'>      <span class="n">connection</span><span class="o">.</span><span class="n">on_request</span> <span class="k">do</span> <span class="o">|</span><span class="n">socket</span><span class="o">|</span>
</span><span class='line'>        <span class="k">while</span> <span class="p">(</span><span class="n">line</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">readline</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
</span><span class='line'>          <span class="nb">puts</span> <span class="n">line</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="n">socket</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">render</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># TimeView simply provides the HTTP response</span>
</span><span class='line'><span class="k">class</span> <span class="nc">TimeView</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">render</span>
</span><span class='line'><span class="sx">%[HTTP/1.1 200 OK</span>
</span><span class='line'><span class="sx"> </span>
</span><span class='line'><span class="sx"> </span>
</span><span class='line'><span class="sx">The current timestamp is: </span><span class="si">#{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">to_i</span> <span class="si">}</span><span class="sx"></span>
</span><span class='line'><span class="sx"> </span>
</span><span class='line'><span class="sx">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="no">AppServer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">connection</span><span class="p">:</span> <span class="no">Connection</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">path</span><span class="p">:</span> <span class="s1">&#39;/tmp/socktest.sock&#39;</span><span class="p">),</span> <span class="ss">view</span><span class="p">:</span> <span class="no">TimeView</span><span class="o">.</span><span class="n">new</span><span class="p">)</span><span class="o">.</span><span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在运行 nginx 和脚本，然后访问 localhost:2048。请求会发送到我的应用上，然后响应被浏览器渲染。太酷了！</p>

<p><img src="/wp-content/uploads/2015/07/appserver.png" alt="appserver" />
<em>HTTP 请求信息由我们的应用服务输出到 STDOUT</em></p>

<p>以下就是我们的劳动成果。</p>

<p><img src="/wp-content/uploads/2015/07/timestamp.png" alt="timestamp" />
<em>浏览器中显示服务端返回的时间戳</em></p>

<p>原文地址： <a href="http://blog.honeybadger.io/how-unicorn-talks-to-nginx-an-introduction-to-unix-sockets-in-ruby/">http://blog.honeybadger.io/how-unicorn-talks-to-nginx-an-introduction-to-unix-sockets-in-ruby/</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Subscription</h1>
  <!--以下是QQ邮件列表订阅嵌入代码--><script >var nId = "e7ee5da6d322dc7157c25cfd8a7700bb23a056dd1fb18cb4",nWidth="auto",sColor="light",sText="请输入邮件地址：" ;</script><script src="http://list.qq.com/zh_CN/htmledition/js/qf/page/qfcode.js" charset="gb18030"></script>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84155.html">AngularJS学习笔记6——与jQuery、Bootstrap结合</a>
      </li>
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84154.html">在Ruby中使用DATA和__END__将代码和数据混合</a>
      </li>
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84153.html">Mac下使用supervisor进行服务管理</a>
      </li>
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84152.html">Riot.js之初体验</a>
      </li>
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84151.html">AngularJS学习笔记5——路由</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/categories/linux栏目/index.html'>linux栏目 (48)</a></li><li><a href='/categories/python栏目/index.html'>python栏目 (34)</a></li><li><a href='/categories/ruby栏目/index.html'>ruby栏目 (32)</a></li><li><a href='/categories/web开发/index.html'>web开发 (19)</a></li><li><a href='/categories/前端相关/index.html'>前端相关 (7)</a></li><li><a href='/categories/嵌入式栏目/index.html'>嵌入式栏目 (11)</a></li><li><a href='/categories/开源软件/index.html'>开源软件 (20)</a></li><li><a href='/categories/教程/index.html'>教程 (16)</a></li><li><a href='/categories/数据库/index.html'>数据库 (10)</a></li><li><a href='/categories/数据结构和算法/index.html'>数据结构和算法 (16)</a></li><li><a href='/categories/编程开发/index.html'>编程开发 (38)</a></li><li><a href='/categories/网络日志/index.html'>网络日志 (11)</a></li><li><a href='/categories/资源分享/index.html'>资源分享 (23)</a></li></ul>
</section>
<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/tags/access/index.html' style='font-size: 105.3731343283582%'>access(6)</a> <a href='/tags/adobe/index.html' style='font-size: 100.8955223880597%'>adobe(1)</a> <a href='/tags/ajax/index.html' style='font-size: 101.7910447761194%'>ajax(2)</a> <a href='/tags/angular/index.html' style='font-size: 105.3731343283582%'>angular(6)</a> <a href='/tags/apache/index.html' style='font-size: 100.8955223880597%'>apache(1)</a> <a href='/tags/arch/index.html' style='font-size: 106.26865671641791%'>Arch(7)</a> <a href='/tags/arm/index.html' style='font-size: 107.16417910447761%'>ARM(8)</a> <a href='/tags/asp/index.html' style='font-size: 106.26865671641791%'>asp(7)</a> <a href='/tags/c/index.html' style='font-size: 111.64179104477611%'>C(13)</a> <a href='/tags/css/index.html' style='font-size: 101.7910447761194%'>css(2)</a> <a href='/tags/django/index.html' style='font-size: 102.68656716417911%'>Django(3)</a> <a href='/tags/dreamweaver/index.html' style='font-size: 100.8955223880597%'>Dreamweaver(1)</a> <a href='/tags/fedora/index.html' style='font-size: 101.7910447761194%'>Fedora(2)</a> <a href='/tags/firefox/index.html' style='font-size: 102.68656716417911%'>firefox(3)</a> <a href='/tags/flash/index.html' style='font-size: 100.8955223880597%'>Flash(1)</a> <a href='/tags/ftp/index.html' style='font-size: 100.8955223880597%'>ftp(1)</a> <a href='/tags/gcc/index.html' style='font-size: 105.3731343283582%'>gcc(6)</a> <a href='/tags/gentoo/index.html' style='font-size: 101.7910447761194%'>Gentoo(2)</a> <a href='/tags/git/index.html' style='font-size: 103.58208955223881%'>git(4)</a> <a href='/tags/gobject/index.html' style='font-size: 105.3731343283582%'>GObject(6)</a> <a href='/tags/grub/index.html' style='font-size: 100.8955223880597%'>grub(1)</a> <a href='/tags/gtk/index.html' style='font-size: 115.22388059701493%'>gtk(17)</a> <a href='/tags/hash/index.html' style='font-size: 100.8955223880597%'>Hash(1)</a> <a href='/tags/ibus/index.html' style='font-size: 100.8955223880597%'>ibus(1)</a> <a href='/tags/js/index.html' style='font-size: 107.16417910447761%'>js(8)</a> <a href='/tags/linux/index.html' style='font-size: 160.0%'>Linux(67)</a> <a href='/tags/mac/index.html' style='font-size: 100.8955223880597%'>Mac(1)</a> <a href='/tags/mongodb/index.html' style='font-size: 110.74626865671642%'>mongodb(12)</a> <a href='/tags/mysql/index.html' style='font-size: 103.58208955223881%'>mysql(4)</a> <a href='/tags/nginx/index.html' style='font-size: 100.8955223880597%'>nginx(1)</a> <a href='/tags/node/index.html' style='font-size: 100.8955223880597%'>node(1)</a> <a href='/tags/php/index.html' style='font-size: 108.95522388059702%'>php(10)</a> <a href='/tags/ps/index.html' style='font-size: 105.3731343283582%'>PS(6)</a> <a href='/tags/pygame/index.html' style='font-size: 110.74626865671642%'>pygame(12)</a> <a href='/tags/python/index.html' style='font-size: 145.67164179104478%'>python(51)</a> <a href='/tags/qt/index.html' style='font-size: 101.7910447761194%'>Qt(2)</a> <a href='/tags/redis/index.html' style='font-size: 100.8955223880597%'>redis(1)</a> <a href='/tags/redis/index.html' style='font-size: 100.8955223880597%'>Redis(1)</a> <a href='/tags/ruby/index.html' style='font-size: 129.55223880597015%'>Ruby(33)</a> <a href='/tags/scrapy/index.html' style='font-size: 102.68656716417911%'>Scrapy(3)</a> <a href='/tags/shell/index.html' style='font-size: 100.8955223880597%'>shell(1)</a> <a href='/tags/tq2440/index.html' style='font-size: 104.4776119402985%'>TQ2440(5)</a> <a href='/tags/ubuntu/index.html' style='font-size: 106.26865671641791%'>ubuntu(7)</a> <a href='/tags/usb/index.html' style='font-size: 102.68656716417911%'>USB(3)</a> <a href='/tags/vim/index.html' style='font-size: 123.28358208955224%'>vim(26)</a> <a href='/tags/virtualbox/index.html' style='font-size: 102.68656716417911%'>VirtualBox(3)</a> <a href='/tags/vmware/index.html' style='font-size: 100.8955223880597%'>vmware(1)</a> <a href='/tags/w3m/index.html' style='font-size: 100.8955223880597%'>w3m(1)</a> <a href='/tags/web开发/index.html' style='font-size: 113.43283582089552%'>Web开发(15)</a> <a href='/tags/windows/index.html' style='font-size: 106.26865671641791%'>windows(7)</a> <a href='/tags/wordpress/index.html' style='font-size: 100.8955223880597%'>WordPress(1)</a> <a href='/tags/xml/index.html' style='font-size: 100.8955223880597%'>xml(1)</a> <a href='/tags/免费/index.html' style='font-size: 100.8955223880597%'>免费(1)</a> <a href='/tags/内核/index.html' style='font-size: 100.8955223880597%'>内核(1)</a> <a href='/tags/匹配算法/index.html' style='font-size: 105.3731343283582%'>匹配算法(6)</a> <a href='/tags/单片机/index.html' style='font-size: 101.7910447761194%'>单片机(2)</a> <a href='/tags/嵌入式/index.html' style='font-size: 100.8955223880597%'>嵌入式(1)</a> <a href='/tags/开源软件/index.html' style='font-size: 108.05970149253731%'>开源软件(9)</a> <a href='/tags/排序算法/index.html' style='font-size: 108.05970149253731%'>排序算法(9)</a> <a href='/tags/文件空间/index.html' style='font-size: 100.8955223880597%'>文件空间(1)</a> <a href='/tags/无线网/index.html' style='font-size: 100.8955223880597%'>无线网(1)</a> <a href='/tags/正则式/index.html' style='font-size: 100.8955223880597%'>正则式(1)</a> <a href='/tags/注册机/index.html' style='font-size: 101.7910447761194%'>注册机(2)</a> <a href='/tags/游戏/index.html' style='font-size: 108.95522388059702%'>游戏(10)</a> <a href='/tags/电脑技巧/index.html' style='font-size: 108.05970149253731%'>电脑技巧(9)</a> <a href='/tags/空间/index.html' style='font-size: 100.8955223880597%'>空间(1)</a> <a href='/tags/算法/index.html' style='font-size: 114.32835820895522%'>算法(16)</a> <a href='/tags/红旗/index.html' style='font-size: 100.8955223880597%'>红旗(1)</a> <a href='/tags/经典语录/index.html' style='font-size: 100.8955223880597%'>经典语录(1)</a> <a href='/tags/网络日志/index.html' style='font-size: 105.3731343283582%'>网络日志(6)</a> <a href='/tags/翻译/index.html' style='font-size: 123.28358208955224%'>翻译(26)</a> <a href='/tags/视频教程/index.html' style='font-size: 108.95522388059702%'>视频教程(10)</a> <a href='/tags/资源分享/index.html' style='font-size: 110.74626865671642%'>资源分享(12)</a> <a href='/tags/转载/index.html' style='font-size: 101.7910447761194%'>转载(2)</a> <a href='/tags/随笔/index.html' style='font-size: 100.8955223880597%'>随笔(1)</a> </span>
</section>
<section>
  <h1>Link</h1>
    <ul id="category-list">
      <li><a target="_blank" title="我的Github" href="https://github.com/wusuopu">@Github</a></li>
      <li><a target="_blank" title="我的微博" href="http://www.weibo.com/u/1768691343">@Weibo</a></li>
      <li><a target="_blank" title="我的Twitter" href="https://twitter.com/longchangjin">@Twitter</a></li>
      <li><a target="_blank" title="我的豆瓣" href="http://www.douban.com/people/lchj/">@Douban</a></li>

      <li><a target="_blank" title="" href="http://www.vimer.cn/">Vimer的程序世界</a></li>
      <li><a target="_blank" title="" href="http://pythoner.net/">python开发者社区</a></li>
      <li><a target="_blank" title="" href="http://simple-is-better.com/">python.cn(news, jobs)</a></li>
      <li><a target="_blank" title="" href="http://gtk.awaysoft.com/">GTK+ 中文社区</a></li>
    </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - 龍昌 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
<div style="display:none;"><script src="http://s94.cnzz.com/stat.php?id=1259846&web_id=1259846&show=pic" language="JavaScript"></script></div>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'longchang';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      //dsq.src = '/javascripts/disqus/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
