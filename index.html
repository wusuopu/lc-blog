<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>龍昌博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="关注Linux及开源信息">
<meta property="og:type" content="website">
<meta property="og:title" content="龍昌博客">
<meta property="og:url" content="http://www.xefan.com/index.html">
<meta property="og:site_name" content="龍昌博客">
<meta property="og:description" content="关注Linux及开源信息">
<meta property="og:locale">
<meta property="article:author" content="龍昌">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="龍昌博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5P14X16L9L"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-5P14X16L9L');
  </script>
  <!-- clarity -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "g5amsf3p9d");
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">龍昌博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/gbook">留言板</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.xefan.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Bitbucket-Runner-配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/.html" class="article-date">
  <time datetime="2023-10-14T20:45:42.000Z" itemprop="datePublished">2023-10-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/.html">Bitbucket Runner 配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>以前有介绍过 Github Runner 和 Gitlab Runner 的配置，现在再来介绍一下 Bitbucket Runner 的配置。</p>
<p>参考官方文档： <a target="_blank" rel="noopener" href="https://support.atlassian.com/bitbucket-cloud/docs/runners/">https://support.atlassian.com/bitbucket-cloud/docs/runners/</a></p>
<h2 id="添加-Runner"><a href="#添加-Runner" class="headerlink" title="添加 Runner"></a>添加 Runner</h2><p>首先禁用 Linux 系统的 swap 功能。若不禁用 swap，在 runner 进行 builder 时会使用 swap 内存，可能会出现内存不足的错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapoff -sv</span><br></pre></td></tr></table></figure>
<p>编辑 <code>/etc/sysctl.conf</code> 添加 <code>vm.swappiness = 1</code> 再重启系统。</p>
<p>接着在 Bitbucket 的设置界面添加 Runner，然后执行界面给出的命令。<br>然后在目标机器上执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run-it -d \</span><br><span class="line">  --name bitbucket-runner \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  -e ACCOUNT_UUID=&lt;accountUuid&gt; \</span><br><span class="line">  -e REPOSITORY_UUID=&lt;repositoryUuid&gt; \</span><br><span class="line">  -e RUNNER_UUID=&lt;runnerUuid&gt; \</span><br><span class="line">  -e OAUTH_CLIENT_ID=&lt;OAuthClientId&gt; \</span><br><span class="line">  -e OAUTH_CLIENT_SECRET=&lt;OAuthClientSecret&gt; \</span><br><span class="line">  wusuopu/bitbucket-pipelines-runner:1.512</span><br></pre></td></tr></table></figure>
<h2 id="使用-Runner"><a href="#使用-Runner" class="headerlink" title="使用 Runner"></a>使用 Runner</h2><p>在 <code>bitbucket.pipelines.yml</code> 中的相关步骤配置 <code>runs-on</code>，如：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pipelines:</span><br><span class="line">  default:</span><br><span class="line">      - step:</span><br><span class="line">          runs-on:</span><br><span class="line">            - self.hosted</span><br><span class="line">            - linux.shell</span><br><span class="line">          script:</span><br></pre></td></tr></table></figure></p>
<p>因为 runner 是以 linux-shell 的方式运行的，所以会有一些限制： <a target="_blank" rel="noopener" href="https://support.atlassian.com/bitbucket-cloud/docs/set-up-runners-for-linux-shell/">https://support.atlassian.com/bitbucket-cloud/docs/set-up-runners-for-linux-shell/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/.html" data-id="clnqs280400mwsglp0gnibu1x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-记录在docker中运行whenever遇到的问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84183.html" class="article-date">
  <time datetime="2021-09-09T02:12:48.610Z" itemprop="datePublished">2021-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/">编程开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84183.html">记录在docker中运行whenever遇到的问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在将一个 rails 的项目移到 docker 方式来部署。这个项目有用到了 whenever 来执行定时任务，这里记录一下在迁移过程中遇到的一些问题。</p>
<p>因为 whenever 是使用系统的 cron 来实现的定时任务，所以直接就在 docker image 内安装一个 cron 即可： <code>apt-get install -y cron</code> 。<br>然后尝试执行命令： <code>whenever -i; crontab -l</code> 看看定时任务都有设置正确。最后在容器启动的时候使用命令 <code>service cron start</code> 一并将 cron 也启动。</p>
<p>至此感觉事情很简单，一切都很顺利。然而过了两天客户反馈说是这两天的定时任务都没有执行。<br>定时任务没执行，那就是 cron 有问题。现在来开始排查问题。</p>
<p>先再安装 syslog： <code>apt-get install -y rsyslog</code>，将 cron 的日志保存下来，方便查找错误。<br>然后往 crontab 中随便添加一条任务，每分钟执行一次命令： <code>date &gt;&gt; /tmp/date.log</code>。</p>
<p>结果1分钟之后 cron 的日志显示有报如下错误：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FAILED to open PAM security session (Cannot make/remove an entry for the specified session)</span><br></pre></td></tr></table></figure></p>
<p>经过搜索知道在 docker 内是没有 session 的，所以 PAM set_loginuid 会失败。需要将 <code>set_loginuid</code> 这行注释掉：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;/^session\s\+required\s\+pam_loginuid.so/c\#session required pam_loginuid.so&#x27; /etc/pam.d/cron</span><br></pre></td></tr></table></figure></p>
<p>重启 cron 之后，<code>date &gt;&gt; /tmp/date.log</code> 定时任务也有正常执行了。</p>
<p>到此感觉问题应该是解决了。然而又过了一天客户还是说定时任务没有执行。<br>看来还是存在问题的，还得接着排查。</p>
<p>whenever 的任务是定时执行一些 rake 任务，然而执行的结果没有任何的日志。<br>于是我就新添加了一条 crontab 任务，将 rake 命令的 stdout 和 stderr 重定向到日志文件中。<br>然后就发现其实是因为在执行 rake 命令时提示 rake 命令不存在，从而导致执行失败的。<br>看来就因为 PATH 环境变量的问题。</p>
<p>在启动 container 时是有设置了一些环境变量的，然而 cron 这个进程并没有继承这些变量。<br>所以现在就需要手动为 cron 再配置环境变量。在启动 cron 之前先执行命令：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm /etc/environment</span><br><span class="line">for variable_value in $(cat /proc/1/environ | sed &#x27;s/\x00/\n/g&#x27;); do</span><br><span class="line">  echo $variable_value &gt;&gt; /etc/environment</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>现在再测试一切就正常了。<br>至此问题终于是解决了，于是就记录一下方便以后查阅。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84183.html" data-id="clnqs280300mssglp2p9pdl2h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/" rel="tag">ruby</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Gitlab-Runner-配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84182.html" class="article-date">
  <time datetime="2021-04-13T10:13:48.096Z" itemprop="datePublished">2021-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/">编程开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84182.html">Gitlab Runner 配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前一篇文章有介绍了 Github Runner 的配置，现在再来介绍一下 Gitlab Runner 的配置。</p>
<p>关于添加自己的机器，可参考 Gitlab 官方文档: <a target="_blank" rel="noopener" href="https://docs.gitlab.com/runner/register/index.html">https://docs.gitlab.com/runner/register/index.html</a></p>
<p>同样的，为了方便，我们使用 docker 来一键部署。首先到 gitlab 的 CI/CD 项目设置页面，然后查看当前项目的 runner 注册 token。<br>然后执行如下命令进行 runner 注册。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -it -v $PWD/tmp/gitlab-runner-config:/etc/gitlab-runner gitlab/gitlab-runner:alpine register</span><br><span class="line">  --non-interactive \</span><br><span class="line">  --url &quot;https://gitlab.com/&quot; \</span><br><span class="line">  --token &quot;PROJECT_REGISTRATION_TOKEN&quot; \</span><br><span class="line">  --executor &quot;docker&quot; \</span><br><span class="line">  --docker-image alpine:latest \</span><br><span class="line">  --docker-volumes /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">  --description &quot;docker-runner&quot; \</span><br><span class="line">  --tag-list &quot;docker,linux&quot; \</span><br><span class="line">  --run-untagged=&quot;true&quot; \</span><br><span class="line">  --locked=&quot;false&quot; \</span><br><span class="line">  --access-level=&quot;not_protected&quot;</span><br></pre></td></tr></table></figure>
<p>注意这里的 <code>PROJECT_REGISTRATION_TOKEN</code> 需要替换为对应的 token；<br><code>--run-untagged</code> 要设为 true，才能运行所有的 job。否则就只会执行打了 tag 的 job 。<br>如果需要多个项目共享该 runner，那么 <code>--locked</code> 就设为 false；</p>
<p>注册成功之后会生成 ./tmp/gitlab-runner-config/config.toml 文件：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">concurrent = 1</span><br><span class="line">check_interval = 0</span><br><span class="line"></span><br><span class="line">[session_server]</span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line">[[runners]]</span><br><span class="line">  name = &quot;runner-docker-01&quot;</span><br><span class="line">  url = &quot;https://gitlab.com/&quot;</span><br><span class="line">  token = &quot;xxxxxxxxxxxxxxxxxxxx&quot;</span><br><span class="line">  executor = &quot;docker&quot;</span><br><span class="line">  [runners.custom_build_dir]</span><br><span class="line">  [runners.cache]</span><br><span class="line">    [runners.cache.s3]</span><br><span class="line">    [runners.cache.gcs]</span><br><span class="line">    [runners.cache.azure]</span><br><span class="line">  [runners.docker]</span><br><span class="line">    host = &quot;unix:///var/run/docker.sock&quot;</span><br><span class="line">    tls_verify = false</span><br><span class="line">    image = &quot;alpine&quot;</span><br><span class="line">    privileged = true</span><br><span class="line">    disable_entrypoint_overwrite = false</span><br><span class="line">    oom_kill_disable = false</span><br><span class="line">    disable_cache = false</span><br><span class="line">    volumes = [&quot;/var/run/docker.sock:/var/run/docker.sock&quot;, &quot;/cache&quot;]</span><br><span class="line">    shm_size = 0</span><br></pre></td></tr></table></figure></p>
<p>如果更换服务器了，但是还想要继续使用该 runner 的配置，只需要保留该配置文件即可。</p>
<p>以上是 runner 注册成功，接下来就使用该配置文件来启动 runner 服务吧。<br>同样也是为了安全起见，我们使用 docker-in-docker 的方式来部署。<br>创建一个 docker-compose.yml 文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">dind:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker:19.03-dind</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 使用国内docker镜像源</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;--registry-mirror&quot;</span>, <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>]</span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./tmp/docker-lib:/var/lib/docker</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./tmp/docker-run:/var/run</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">gitlab-runner:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitlab/gitlab-runner:alpine</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dind</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./tmp/docker-run:/var/run</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./tmp/gitlab-runner-config:/etc/gitlab-runner</span></span><br></pre></td></tr></table></figure>
<p>然后执行命令 <code>docker-compose up -d</code> 启动服务即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84182.html" data-id="clnqs280200mosglp1re9033o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Github-Runner-配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84181.html" class="article-date">
  <time datetime="2020-11-23T01:00:58.877Z" itemprop="datePublished">2020-11-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/">编程开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84181.html">Github Runner 配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在之前的文章<a href="/archives/84178.html">《Github Actions使用》</a>有介绍了Github Actions的使用方法。<br>之前是直接的 Github 官方提供的 runner，来执行。不过官方提供的 runner 多少还是有些限制。<br>这次我们来尝试将自己的 server 配置成 runner 来执行 actions。</p>
<p>关于添加自己的机器，可参考 Github 官方文档： <a target="_blank" rel="noopener" href="https://docs.github.com/en/free-pro-team@latest/actions/hosting-your-own-runners/adding-self-hosted-runners">https://docs.github.com/en/free-pro-team@latest/actions/hosting-your-own-runners/adding-self-hosted-runners</a></p>
<p>在 github 中 runner 分为三个级别： repository, organization, enterprise。<br>其中 repository 级别的 runner 就只能在这个代码仓库下使用；<br>organization 和 enterprise 级别的 runner 可以在这个 organization 或者 enterprise 下的所有代码仓库中共享。</p>
<p>由于我是免费用户，这里我就以 organization 为例吧。另外为了方便我们就直接通过 docker 来运行。</p>
<p>参考官方文档，首先进入到 organization 的 actions 设置页面，然后选择添加一个 runner。没有 organization 的可以自己创建一个。<br>接着在自己的 server 上执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">    -e GH_REPOSITORY=xxxxxxxxxxxx \</span><br><span class="line">    -e GH_RUNNER_TOKEN=xxxxxxxxxxxxx \</span><br><span class="line">    -e GH_RUNNER_LABELS=label1,label2 \</span><br><span class="line">    wusuopu/github-actions-runner:2.273.6</span><br></pre></td></tr></table></figure>
<p>其中 GH_REPOSITORY 就是设置页面上显示的 url 参数，GH_RUNNER_TOKEN 就是 token 参数。GH_RUNNER_LABELS 则根据自己的需要来为该 runner 设置标签。</p>
<p>至此，自己的 runner 就已经配置好了。不过这里我们是直接在这个 runerr 的 container 中操作 server 上的 docker 服务。这样其实是非常危险的，尤其是对于公有仓库来说。</p>
<p>为了安全起见，我们可以再运行一个 Docker-in-Docker 的服务，然后这个就只需要连接到该服务即可。<br>创建一个 docker-compose.yml 文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">dind:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker:19.03-dind</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./tmp/docker-lib:/var/lib/docker</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./tmp/docker-run:/var/run</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">github-runner:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wusuopu/github-actions-runner:2.273.6</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dind</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GH_REPOSITORY=https://github.com/xxxx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GH_RUNNER_TOKEN=xxxxxxxxxxxxx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GH_RUNNER_LABELS=dind</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./tmp/docker-run:/var/run</span></span><br></pre></td></tr></table></figure>
<p>然后执行命令 <code>docker-compose up -d</code> 启动服务即可。<br>如果之后 actions 任务太多处理不过来，可以将 runner 扩容，多增加几个 runner 实例： <code>docker-compose scale github-runner=3</code></p>
<p>至此，我们自己的 runner 就配置好了。如果想要在 actions 中使用我们自己的 runner，则需要修改之前的配置文件 <code>.github/workflows/main.yml</code>。将 <code>runs-on: ubuntu-latest</code> 改为 <code>runs-on: self-hosted</code> 。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84181.html" data-id="clnqs280200mksglpglmlej4u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-使用python编写帝国时代2修改器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84180.html" class="article-date">
  <time datetime="2020-05-14T02:12:42.474Z" itemprop="datePublished">2020-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python%E6%A0%8F%E7%9B%AE/">Python栏目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84180.html">使用python编写帝国时代2修改器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>之前的文章有介绍了<a href="/archives/84171.html">《使用python编写游戏修改器》</a>。<br>最近怀旧一下，在玩《帝国时代2》，然后就尝试着再写一个修改器试试。</p>
<h2 id="查找内存地址"><a href="#查找内存地址" class="headerlink" title="查找内存地址"></a>查找内存地址</h2><p>首先用 Cheat Engine 来修改资源，以及查找资源的内存地址。注意这里的数据都要使用浮点数类型。<br>如图找到的食物内存地址是 0F2B93B0<br><img src="/wp-content/uploads/2020/05/age2_ce01.jpg" alt="age2_ce01"></p>
<p>通过逐步分析得到以下指标的内存地址为：<br>木材地址 = 食物地址 + 4<br>石头地址 = 食物地址 + 8<br>黄金地址 = 食物地址 + 12<br>黄金地址 = 食物地址 + 12<br>人口上限地址 = 食物地址 + 16<br>当前人口地址 = 食物地址 + 44</p>
<p>如果想要实际无限人口，只需要修改 人口上限 和 当前人口 这两个数据即可。<br>这些地址都找到之后，然后就开始写代码，使用 Python 调用 <code>WriteProcessMemory</code> 来修改游戏的内存。<br>然而在打完这一局之后开启新的游戏时却发现这些地址全都变了。<br>每次开启新的游戏时都需要重新查找一遍地址内存，这个就有点麻烦了。</p>
<h2 id="查找游戏基址"><a href="#查找游戏基址" class="headerlink" title="查找游戏基址"></a>查找游戏基址</h2><p>通过分析发现这些地址都全是动态地址，每次游戏时都不一样。根据仅记得的一点汇编知识知道，这些动态地址是通过基址加偏移地址得到的。所以现在一劳永逸的方法是找到基址地址。而基址是静态的。然后接下来逐步进行分析。</p>
<p>首先刚刚食物地址是0F2B93B0。游戏程序如果要从这个地址获取食物数据，那么就得在某个地方储存这个地址值。这里我们就先将这个地址称为<code>食物地址指针</code>。接着用 CE 查找一下 0F2B93B0 这个值，然后就找到了<code>食物地址指针</code>地址为 206221B8。如图：<br><img src="/wp-content/uploads/2020/05/age2_ce02.jpg" alt="age2_ce02"><br>注意这里要用 16 进制的方式来查找这个地址值。如果用 C 语言代码的描述相当于：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> food_point = <span class="number">0x206221B8</span>       <span class="comment">// 食物地址指针</span></span><br><span class="line"><span class="type">int</span> food_address = *food_point;   <span class="comment">// 食物地址指针 指向食物地址 0x0F2B93B0</span></span><br><span class="line"><span class="type">int</span> food = *food_point;           <span class="comment">// 从食物地址 0x0F2B93B0 得到食物的值</span></span><br></pre></td></tr></table></figure></p>
<p>经过测试发现这个<code>食物地址指针</code>地址也是动态的。没办法了，只能继续往下找。现在来看看都有谁访问了这个地址。如图：<br><img src="/wp-content/uploads/2020/05/age2_ce03.jpg" alt="age2_ce03"><br><img src="/wp-content/uploads/2020/05/age2_ce04.jpg" alt="age2_ce04"><br>这里我们又得到了一个地址： 20622110 。再来看看是哪里记录了这个地址呢。如图：<br><img src="/wp-content/uploads/2020/05/age2_ce05.jpg" alt="age2_ce05"><br>这里我们又找到了 007A5FEC 这个地址，运气不错。在 CE 中显示为绿色，表示它是一个静态地址。这表示它就是我们要找的基址了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>现在来总结一下。使用 C 语言代码描述如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> base_addr = <span class="number">0x007A5FEC</span>;             <span class="comment">// 游戏基址</span></span><br><span class="line"><span class="type">int</span> food_point = *base_addr + <span class="number">0xA8</span>;     <span class="comment">// 基址记录的值0x20622110 + 偏移地址0xA8 = 食物地址指针</span></span><br><span class="line"><span class="type">int</span> food_address = *food_point;         <span class="comment">// 得到食物地址</span></span><br><span class="line"><span class="type">int</span> food = *food_address;               <span class="comment">// 从食物地址 0x0F2B93B0 得到食物的值</span></span><br></pre></td></tr></table></figure></p>
<p>最终修改的结果如图：<br><img src="/wp-content/uploads/2020/05/age2_ce06.jpg" alt="age2_ce06"></p>
<p>上面修改器的完整源代码，如有需要可通过以下链接获取：<br><a target="_blank" rel="noopener" href="https://github.com/wusuopu/cheat_engine_age2">https://github.com/wusuopu/cheat_engine_age2</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84180.html" data-id="clnqs280100mgsglp5dah7hsx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-使用Vagrant和Docker搭建Kubernetes集群" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84179.html" class="article-date">
  <time datetime="2020-04-03T04:28:20.946Z" itemprop="datePublished">2020-04-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux%E6%A0%8F%E7%9B%AE/">Linux栏目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84179.html">使用Vagrant和Docker搭建Kubernetes集群</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在之前的文章<a href="/archives/84177.html">《使用Vagrant在Ubuntu系统上搭建Kubernetes集群》</a>介绍了使用 Vagrant 在 VirtualBox 中安装 Ubuntu 系统搭建 Kubernetes 集群。<br>因为 Vagrant 是支持 Docker 的，所以这篇文章就来尝试不再使用 VirtualBox 了，而是直接使用 Docker 来搭建 Kubernetes 集群。</p>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>需要先安装以下程序：</p>
<ul>
<li>Vagrant</li>
<li>Docker</li>
<li>Kubectl</li>
</ul>
<h2 id="运行集群"><a href="#运行集群" class="headerlink" title="运行集群"></a>运行集群</h2><p>因为是在本地学习 k8s，因此为了方便我就使用 Rancher 的 k3s 来进行安装。<br>下载 Vagrant 配置文件： <a target="_blank" rel="noopener" href="https://github.com/wusuopu/kubernetes-vagrant-alpine">https://github.com/wusuopu/kubernetes-vagrant-alpine</a></p>
<p>然后执行命令：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant up --no-parallel --provision</span><br></pre></td></tr></table></figure></p>
<p>这里启动 k3s 服务，并将 master node 的 /etc/rancher/k3s/k3s.yaml 文件内容复制到 host 系统上来，这样就可以直接在 host 系统中用 kubectl 来操作集群。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-&gt; % k get node -o wide</span><br><span class="line">NAME        STATUS   ROLES    AGE   VERSION        INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME</span><br><span class="line">alpine-02   Ready    &lt;none&gt;   59m   v1.17.4-k3s1   172.17.0.3    &lt;none&gt;        Alpine Linux v3.11   4.9.184-linuxkit   docker://19.3.8</span><br><span class="line">alpine-01   Ready    master   59m   v1.17.4-k3s1   172.17.0.2    &lt;none&gt;        Alpine Linux v3.11   4.9.184-linuxkit   docker://19.3.8</span><br><span class="line">alpine-03   Ready    &lt;none&gt;   58m   v1.17.4-k3s1   172.17.0.4    &lt;none&gt;        Alpine Linux v3.11   4.9.184-linuxkit   docker://19.3.8</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里集群的各个 node 都是一个 docker container。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-&gt; % docker ps</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND                  CREATED             STATUS              PORTS                                                           NAMES</span><br><span class="line">a91d13e2cca0        wusuopu/vagrant:k3s-alpine   &quot;dockerd-entrypoint.…&quot;   About an hour ago   Up 35 minutes       2375-2376/tcp, 6443/tcp, 127.0.0.1:2201-&gt;22/tcp                 kubernetes-vagrant-alpine_alpine-03_1585887389</span><br><span class="line">cce93873b666        wusuopu/vagrant:k3s-alpine   &quot;dockerd-entrypoint.…&quot;   About an hour ago   Up 35 minutes       2375-2376/tcp, 6443/tcp, 127.0.0.1:2200-&gt;22/tcp                 kubernetes-vagrant-alpine_alpine-02_1585887382</span><br><span class="line">d4844843ca3e        wusuopu/vagrant:k3s-alpine   &quot;dockerd-entrypoint.…&quot;   About an hour ago   Up 36 minutes       2375-2376/tcp, 0.0.0.0:6443-&gt;6443/tcp, 127.0.0.1:2222-&gt;22/tcp   kubernetes-vagrant-alpine_alpine-01_1585887365</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84179.html" data-id="clnqs280100mcsglp6poudzpw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Github-Actions使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84178.html" class="article-date">
  <time datetime="2020-02-03T06:35:36.443Z" itemprop="datePublished">2020-02-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/">编程开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84178.html">Github Actions使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在看 Github Actions，相对一 Gitlab CI 来说，它的配置就没有那么直观了。</p>
<p>以下通过一个例子来说下 Github Actions 的用法。</p>
<p>在项目根目录下创建文件 <code>.github/workflows/main.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">CI</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="comment"># 仅在有以 &#x27;v&#x27; 开头的 tag push 时才会触发</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">v*</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">build</span> <span class="string">docker</span> <span class="string">image</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="comment"># 切换到当前的 commit</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">ref:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.ref</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">build</span> <span class="string">docker</span> <span class="string">image</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="attr">canister_user:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.canister_user</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">canister_password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.canister_password</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">docker_image_name:</span> <span class="string">cloud.canister.io:5000/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        echo $GITHUB_WORKSPACE $GITHUB_REF</span></span><br><span class="line"><span class="string">        cd $GITHUB_WORKSPACE</span></span><br><span class="line"><span class="string">        docker build -t $docker_image_name:$&#123;GITHUB_REF##*/&#125; .</span></span><br><span class="line"><span class="string">        docker login -u $canister_user -p $canister_password cloud.canister.io:5000</span></span><br><span class="line"><span class="string">        docker push $docker_image_name:$&#123;GITHUB_REF##*/&#125;</span></span><br></pre></td></tr></table></figure>
<p>以上的配置执行的操作是，当有新的 ‘v’ 开头的 tag push 时，则 build docker image 并 push 到 cloud.canister.io 的私有 docker registry 上。</p>
<p>这里 canister 的用户名和密码是通过 secrets 来配置的，在 github 的 repository -&gt; Settings -&gt; Secrets 页面。</p>
<p>参考： <a target="_blank" rel="noopener" href="https://help.github.com/en/actions">https://help.github.com/en/actions</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84178.html" data-id="clnqs280000m8sglp346d6jlh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-使用Vagrant在Ubuntu系统上搭建Kubernetes集群" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84177.html" class="article-date">
  <time datetime="2019-11-30T07:37:50.127Z" itemprop="datePublished">2019-11-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux%E6%A0%8F%E7%9B%AE/">Linux栏目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84177.html">使用Vagrant在Ubuntu系统上搭建Kubernetes集群</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><h3 id="Vagrant"><a href="#Vagrant" class="headerlink" title="Vagrant"></a>Vagrant</h3><p>目前 Vagrant (<a target="_blank" rel="noopener" href="https://www.vagrantup.com/downloads.html">https://www.vagrantup.com/downloads.html</a>) 最新为 v2.2.6，Kubernetes 为 v1.16</p>
<h3 id="Kubectl"><a href="#Kubectl" class="headerlink" title="Kubectl"></a>Kubectl</h3><p>下载最新版的 kubectl:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl`</span><br></pre></td></tr></table></figure>
<h3 id="VirtualBox"><a href="#VirtualBox" class="headerlink" title="VirtualBox"></a>VirtualBox</h3><p>需要下载 Vagrant 所兼容的版本( <a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/virtualbox/">https://www.vagrantup.com/docs/virtualbox/</a> )。我是直接用 apt-get 安装 5.2 的版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install virtualbox virtualbox-guest-additions-iso</span><br></pre></td></tr></table></figure>
<h2 id="运行-ubuntu-单实例"><a href="#运行-ubuntu-单实例" class="headerlink" title="运行 ubuntu 单实例"></a>运行 ubuntu 单实例</h2><p>创建 Vagrantfile 配置文件，这里在 virtualbox 内运行的是 Ubuntu 18.04。<br>若 Vagrant 的 Box 文件下载太慢，可先提前下载好：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wget https://app.vagrantup.com/ubuntu/boxes/bionic64/versions/20191125.0.0/providers/virtualbox.box</span><br><span class="line"></span><br><span class="line">cat &gt; virtualbox.json &lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;ubuntu/bionic64&quot;,</span><br><span class="line">  &quot;versions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;version&quot;: &quot;20191125.0.0&quot;,</span><br><span class="line">      &quot;providers&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;name&quot;: &quot;virtualbox&quot;,</span><br><span class="line">          &quot;url&quot;: &quot;virtualbox.box&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">vagrant box add ubuntu/bionic64 virtualbox.json</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$num_instances</span> = <span class="number">1</span></span><br><span class="line"><span class="variable">$instance_name_prefix</span> = <span class="string">&quot;ubuntu&quot;</span></span><br><span class="line"><span class="variable">$vm_gui</span> = <span class="literal">false</span></span><br><span class="line"><span class="variable">$vm_memory</span> = <span class="number">1024</span></span><br><span class="line"><span class="variable">$vm_cpus</span> = <span class="number">1</span></span><br><span class="line"><span class="variable">$vb_cpuexecutioncap</span> = <span class="number">100</span></span><br><span class="line">ip_prefix = <span class="string">&#x27;172.17.8.&#x27;</span></span><br><span class="line"></span><br><span class="line">Vagrant.configure(<span class="number">2</span>) <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line">  (<span class="number">1</span>..<span class="variable">$num_instances</span>).each <span class="keyword">do</span> |<span class="params">i</span>|</span><br><span class="line">    config.vm.define vm_name = <span class="string">&quot;%s-%02d&quot;</span> % [<span class="variable">$instance_name_prefix</span>, i] <span class="keyword">do</span> |<span class="params">node</span>|</span><br><span class="line">      node.vm.box = <span class="string">&#x27;ubuntu/bionic64&#x27;</span></span><br><span class="line">      node.vm.box_version = <span class="string">&quot;20191125.0.0&quot;</span></span><br><span class="line">      node.vm.box_check_update = <span class="literal">false</span></span><br><span class="line">      node.vm.hostname = vm_name</span><br><span class="line">      node.vm.synced_folder <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/vagrant&#x27;</span>, <span class="symbol">type:</span> <span class="string">&#x27;virtualbox&#x27;</span></span><br><span class="line"></span><br><span class="line">      ip = <span class="string">&quot;<span class="subst">#&#123;ip_prefix&#125;</span><span class="subst">#&#123;i+<span class="number">100</span>&#125;</span>&quot;</span></span><br><span class="line">      node.vm.network <span class="string">&#x27;private_network&#x27;</span>, <span class="symbol">ip:</span> ip</span><br><span class="line">      node.vm.provider <span class="symbol">:virtualbox</span> <span class="keyword">do</span> |<span class="params">vb</span>|</span><br><span class="line">        vb.gui = <span class="variable">$vm_gui</span></span><br><span class="line">        vb.memory = <span class="variable">$vm_memory</span></span><br><span class="line">        vb.cpus = <span class="variable">$vm_cpus</span></span><br><span class="line">        vb.customize [<span class="string">&quot;modifyvm&quot;</span>, <span class="symbol">:id</span>, <span class="string">&quot;--cpuexecutioncap&quot;</span>, <span class="string">&quot;<span class="subst">#&#123;<span class="variable">$vb_cpuexecutioncap</span>&#125;</span>&quot;</span>]</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>接着启动 ubuntu</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant up</span><br></pre></td></tr></table></figure>
<p>登录 ubuntu 实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant ssh</span><br></pre></td></tr></table></figure>
<p>至此 ubuntu 就是运行起来了。然后却只有一个 实例，但是在实际应用中可能是多个实例组成的集群。</p>
<h2 id="运行-ubuntu-多实例"><a href="#运行-ubuntu-多实例" class="headerlink" title="运行 ubuntu 多实例"></a>运行 ubuntu 多实例</h2><p>先停止刚刚的实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant halt</span><br></pre></td></tr></table></figure>
<p>然后修改 Vagrantfile 文件，将 $num_instances 变量改为3。这里我就启动3个实例来组成集群。<br>接着启动这3个实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant up</span><br></pre></td></tr></table></figure>
<p>查看实例状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-&gt; % vagrant status</span><br><span class="line">Current machine states:</span><br><span class="line"></span><br><span class="line">ubuntu-01                 running (virtualbox)</span><br><span class="line">ubuntu-02                 running (virtualbox)</span><br><span class="line">ubuntu-03                 running (virtualbox)</span><br><span class="line"></span><br><span class="line">This environment represents multiple VMs. The VMs are all listed</span><br><span class="line">above with their current state. For more information about a specific</span><br><span class="line">VM, run `vagrant status NAME`.</span><br></pre></td></tr></table></figure>
<p>然后登录到其中的某个实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant ssh ubuntu-02</span><br></pre></td></tr></table></figure>
<h2 id="安装-Kubernetes"><a href="#安装-Kubernetes" class="headerlink" title="安装 Kubernetes"></a>安装 Kubernetes</h2><p>目前的3个 ubuntu 实例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">172.17.8.101 (ubuntu-01)    master</span><br><span class="line">172.17.8.102 (ubuntu-02)    worker1</span><br><span class="line">172.17.8.103 (ubuntu-03)    worker2</span><br></pre></td></tr></table></figure>
<p>因为是在本地学习 k8s，因此为了方便我就使用 Rancher 的 k3s 来进行安装。<br>先分别在各个实例中安装 docker，参考： <a target="_blank" rel="noopener" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a></p>
<p>先安装  master node</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vagrant ssh ubuntu-01</span><br><span class="line">curl -sfL https://get.k3s.io | sh -</span><br></pre></td></tr></table></figure>
<p>接着分别进入另外两个实例内安装 worker node，其中 K3S_TOKEN 的值来自 /var/lib/rancher/k3s/server/node-token 文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vagrant ssh ubuntu-02</span><br><span class="line">curl -sfL https://get.k3s.io | K3S_URL=https://172.17.8.101:6443 K3S_TOKEN=XXX sh -</span><br></pre></td></tr></table></figure>
<p>最后可以将 master node 的 /etc/rancher/k3s/k3s.yaml 文件内容复制到 host 系统上来，这样就可以直接在 host 系统中用 kubectl 来操作集群。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-&gt; % k get nodes -o wide</span><br><span class="line">NAME        STATUS   ROLES    AGE     VERSION         INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME</span><br><span class="line">ubuntu-03   Ready    &lt;none&gt;   4m57s   v1.16.3-k3s.2   172.17.8.103   &lt;none&gt;        Ubuntu 18.04.3 LTS   4.15.0-70-generic   docker://19.3.5</span><br><span class="line">ubuntu-02   Ready    &lt;none&gt;   7m25s   v1.16.3-k3s.2   172.17.8.102   &lt;none&gt;        Ubuntu 18.04.3 LTS   4.15.0-70-generic   docker://19.3.5</span><br><span class="line">ubuntu-01   Ready    master   8m5s    v1.16.3-k3s.2   172.17.8.101   &lt;none&gt;        Ubuntu 18.04.3 LTS   4.15.0-70-generic   docker://19.3.5</span><br></pre></td></tr></table></figure>
<p>当前安装的 k3s 是 v1.0.0，k8s 是 v1.16.3</p>
<p>最后我将完整的配置已经上传到 github 上了。大家有需要可以直接执行如下命令即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/wusuopu/kubernetes-vagrant-ubuntu</span><br><span class="line">cd kubernetes-vagrant-ubuntu</span><br><span class="line">vagrant up</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84177.html" data-id="clnqs27zz00m4sglp6a2p9toy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-使用TypeScript开发Express应用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84176.html" class="article-date">
  <time datetime="2019-11-04T03:01:06.658Z" itemprop="datePublished">2019-11-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84176.html">使用TypeScript开发Express应用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="首先创建新项目"><a href="#首先创建新项目" class="headerlink" title="首先创建新项目"></a>首先创建新项目</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn init</span><br></pre></td></tr></table></figure>
<h2 id="然后安装-express"><a href="#然后安装-express" class="headerlink" title="然后安装 express"></a>然后安装 express</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add express</span><br><span class="line">yarn add @types/express @types/node --dev</span><br></pre></td></tr></table></figure>
<h2 id="安装-TypeScript"><a href="#安装-TypeScript" class="headerlink" title="安装 TypeScript"></a>安装 TypeScript</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev typescript</span><br></pre></td></tr></table></figure>
<h2 id="配置-webpack"><a href="#配置-webpack" class="headerlink" title="配置 webpack"></a>配置 webpack</h2><p>这是最麻烦的一步。先安装 webpack:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev webpack webpack-cli webpack-node-externals ts-loader</span><br><span class="line">yarn add --dev nodemon webpack-shell-plugin</span><br></pre></td></tr></table></figure>
<p>添加 <code>webpack.config.js</code>:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&#x27;path&#x27;);</span><br><span class="line">const nodeExternals = require(&#x27;webpack-node-externals&#x27;);</span><br><span class="line">const WebpackShellPlugin = require(&#x27;webpack-shell-plugin&#x27;);</span><br><span class="line"></span><br><span class="line">const &#123; NODE_ENV = &#x27;production&#x27; &#125; = process.env;</span><br><span class="line">const rootPath = path.resolve(__dirname)</span><br><span class="line"></span><br><span class="line">let plugins = []</span><br><span class="line">if (NODE_ENV === &#x27;development&#x27;) &#123;</span><br><span class="line">  plugins.push(new WebpackShellPlugin(&#123;</span><br><span class="line">    onBuildEnd: [&#x27;yarn run:dev&#x27;]</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  entry: path.resolve(rootPath, &#x27;./src/index.ts&#x27;),</span><br><span class="line">  mode: NODE_ENV,</span><br><span class="line">  target: &#x27;node&#x27;,</span><br><span class="line">  watch: NODE_ENV === &#x27;development&#x27;,</span><br><span class="line">  externals: [ nodeExternals() ],</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(rootPath, &#x27;build&#x27;, NODE_ENV === &#x27;development&#x27; ? &#x27;dev&#x27; : &#x27;prod&#x27;),</span><br><span class="line">    filename: &#x27;index.js&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [&#x27;.ts&#x27;, &#x27;.js&#x27;],</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: plugins,</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.ts$/,</span><br><span class="line">        use: [</span><br><span class="line">          &#x27;ts-loader&#x27;,</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>添加 <code>tsconfig.json</code>:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    &quot;module&quot;: &quot;commonjs&quot;,</span><br><span class="line">    &quot;target&quot;: &quot;es5&quot;,</span><br><span class="line">    &quot;noImplicitAny&quot;: false,</span><br><span class="line">    &quot;sourceMap&quot;: true,</span><br><span class="line">    &quot;outDir&quot;: &quot;build&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;exclude&quot;: [</span><br><span class="line">    &quot;node_modules&quot;,</span><br><span class="line">    &quot;build&quot;,</span><br><span class="line">    &quot;config&quot;,</span><br><span class="line">    &quot;release&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在 <code>package.json</code> 中添加相关命令:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;start&quot;: &quot;node build/prod/index.js&quot;,</span><br><span class="line">  &quot;start:dev&quot;: &quot;NODE_ENV=development node node_modules/webpack/bin/webpack.js --config webpack.config.js&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;NODE_ENV=production node node_modules/webpack/bin/webpack.js --config webpack.config.js&quot;,</span><br><span class="line">  &quot;run:dev&quot;: &quot;NODE_ENV=development nodemon build/dev/index.js&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样在开发过程只需要执行 <code>yarn run start:dev</code> 启动开发服务器即可，在代码有改动之后会自己重新 build 并重启服务。<br>开发完成之后执行 <code>yarn build</code> 进行打包发布。</p>
<h2 id="使用-jest-进行测试-可选"><a href="#使用-jest-进行测试-可选" class="headerlink" title="使用 jest 进行测试(可选)"></a>使用 jest 进行测试(可选)</h2><p>安装 jest：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D jest @types/jest ts-jest supertest</span><br></pre></td></tr></table></figure></p>
<p>添加 <code>jest.config.js</code>:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  testEnvironment: &#x27;node&#x27;,</span><br><span class="line">  transform: &#123;</span><br><span class="line">    &quot;^.+\\.ts$&quot;: &quot;ts-jest&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>相应的测试文件的文件名以 <code>.test.ts</code> 结尾。</p>
<p>然后在 <code>package.json</code> 中添加相关命令：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;jest&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最终项目目录结构如下：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── jest.config.js</span><br><span class="line">├── package.json</span><br><span class="line">├── src</span><br><span class="line">│   └── index.ts</span><br><span class="line">├── tests</span><br><span class="line">│   └── index.test.ts</span><br><span class="line">├── tsconfig.json</span><br><span class="line">├── webpack.config.js</span><br><span class="line">└── yarn.lock</span><br></pre></td></tr></table></figure></p>
<p>参考源代码： <a target="_blank" rel="noopener" href="https://github.com/wusuopu/baidu-pan-cli">https://github.com/wusuopu/baidu-pan-cli</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84176.html" data-id="clnqs27zz00m0sglp6fapcdoy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-神舟战神-Z7-KP7GZ-安装黑苹果" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84175.html" class="article-date">
  <time datetime="2019-05-28T00:40:43.583Z" itemprop="datePublished">2019-05-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%99%E7%A8%8B/">教程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84175.html">记录神舟战神 Z7M-KP7GZ 安装黑苹果过程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>现在这台 MacBook Air 差不多用了4年，因此打算换台新的电脑。目前需要一台有独显的电脑，一来是跑一些程序，二来是方便打游戏。<br>另外由于 macOS 已经用习惯了，不想再换其他系统。因此才考虑的安装黑苹果。通过两周的调研，别人给的经验是最好选择已经有人安装成功过的电脑型号，免得有问题自己折腾。<br>于是乎就选择了性价比比较高的神舟。最后安装完成之后，系统还有些小问题，不过基本也能用。对于要求比较高的建议还是白苹果吧。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul>
<li>一个8G以上的U盘，用于烧写系统镜像</li>
<li>一个U盘，大小不限，只要启动WinPE就行</li>
<li>一个usb鼠标，安装过程中触摸板用不了</li>
</ul>
<p>因为我打算安装3个系统，我的硬盘分区如下：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">128G SSD:</span><br><span class="line">ESP     600M    用于EFI引导</span><br><span class="line">EXT4    127G    用于安装ubuntu</span><br><span class="line"></span><br><span class="line">1TB机械硬盘：</span><br><span class="line">ESP     200M    用于EFI引导</span><br><span class="line">MSR     128M</span><br><span class="line">NTFS    100G    Windows C</span><br><span class="line">NTFS    100G    Windows D</span><br><span class="line">SWAP    16G     Linux交换分区</span><br><span class="line">EXFAT32 320G    用于多个系统之间分享文件</span><br><span class="line">APFS    440G    安装黑苹果</span><br></pre></td></tr></table></figure></p>
<p>在安装过程中需要用苹果的硬盘工具进行分区，如果硬盘上有文件的话需要先进行备份。</p>
<p>安装过程我是参考的黑果小兵博客： <a target="_blank" rel="noopener" href="https://blog.daliansky.net/Lenovo-Xiaoxin-Air-13-macOS-Mojave-installation-tutorial.html">https://blog.daliansky.net/Lenovo-Xiaoxin-Air-13-macOS-Mojave-installation-tutorial.html</a></p>
<p>下载镜像 ( <a target="_blank" rel="noopener" href="https://blog.daliansky.net/tags/%E9%95%9C%E5%83%8F/">https://blog.daliansky.net/tags/%E9%95%9C%E5%83%8F/</a> ) 然后使用镜像烧写工具将镜像烧写到8G的U盘。这里我用的是 Etcher 这个工具。<br>参考别人的说法，10.14 的系统没有 Nvidia 的显卡驱动，10.13 的系统才有。不过我还是下载的 10.14.4 的系统镜像。</p>
<p>下载 Z7M-KP7GZ 的相关驱动： <a target="_blank" rel="noopener" href="https://github.com/kirainmoe/hasee-z7-kp7gz-macos">https://github.com/kirainmoe/hasee-z7-kp7gz-macos</a></p>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><p>启动电脑进入 BIOS 禁用 Secure Boot。然后通过U盘启动进入WinPE，先按照上面的硬盘分区计划对硬盘进行分区。如果你是整块硬盘只用于安装 macOS，则可以忽略这上步。<br>然后重启换另一个U盘启动进入 macOS 的安装界面。进入 Clover 后按 o 键在 Boot 项后面添加 nv_disable=1 参数。如图：<br><img src="/wp-content/uploads/2019/05/hasee_macos_01.jpg" alt=""></p>
<p>然后回车开始引导 macOS。等几分钟之后就进入了安装程序，依次选择语言、同意用户协议、选择安装硬盘。<br>这里可以打开硬盘工具，然后进行分区。建议使用 APFS 格式的分区。注意，如果原来硬盘上有数据的记得先备份。如图：<br><img src="/wp-content/uploads/2019/05/hasee_macos_02.png" alt=""><br><img src="/wp-content/uploads/2019/05/hasee_macos_03.jpg" alt=""></p>
<p>安装过程中会重启，重启之后进入 Clover 再选择使用对应的硬盘分区，选择”Boot macOS install from Mac”启动项，不要选择Preboot的启动项。<br><img src="/wp-content/uploads/2019/05/hasee_macos_04.jpg" alt=""></p>
<p>如果出现Kernel Panic错误，重启再来试一遍吧。<br><img src="/wp-content/uploads/2019/05/hasee_macos_05.jpg" alt=""></p>
<p>安装过程中啥都干不了，只能等了。差不多等半个小时就安装完成。接下来进入设置向导，选择地区、添加几号等操作。这个过程中触摸板用不了，所以需要外接鼠标。<br>最后安装完成，进入系统。<br><img src="/wp-content/uploads/2019/05/hasee_macos_06.jpg" alt=""></p>
<p>系统安装完成之后，接下来就是安装EFI。因为现在EFI文件还是U盘里，否则就只能每次启动时都需要通过U盘来引导了。<br>在前面使用硬盘工具进行分区时，它会在当前硬盘的开始位置创建一个200M的ESP分区。我们只需要将U盘中的EFI复制到这个分区里即可。</p>
<p>打开终端执行命令：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查找分区情况</span><br><span class="line">diskutil list</span><br><span class="line"></span><br><span class="line"># 分别挂载本地硬盘的EFI分区各u盘的EFI分区</span><br><span class="line">sudo diskutil mount disk1s1</span><br><span class="line">sudo diskutil mount disk3s1</span><br></pre></td></tr></table></figure></p>
<p>然后将u盘中EFI目录下的所有文件复制到硬盘中的EFI目录。如果之前已经有安装过其他的系统，那么只需要将u盘中的 EFI/CLOVER 复制到硬盘中的 EFI 目录下即可</p>
<h2 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h2><p>现在系统安装好了，EFI也安装好了。应该就可以正常地进入系统了。不过目前还有这些问题：</p>
<ul>
<li>触摸板用不了</li>
<li>WiFi、蓝牙用不了</li>
<li>显卡用不了，不用使用外接显示器</li>
</ul>
<p>然后我们再接着安装驱动文件。先挂载 ESP 分区，备份 EFI 目录，以免出错之后进不了系统时可以恢复。</p>
<p>删掉 /EFI/CLOVER 文件夹中的所有文件，然后将刚刚下载的所有驱动文件复制到 /EFI/CLOVER 目录下。<br>重启电脑然后执行里面的 optimize.sh 脚本，注意不要启动HiDPI。驱动安装好之后触摸板应该就能用了。</p>
<p>如果声卡不能使用的话，执行命令 kextstat -list-only | grep AppleALC  看看AppleALC.kext 驱动已正确加载。如果没有正确加载，请将其安装在 /Library/Extensions 下后执行命令 sudo kextcache -i / 重建缓存并重启。</p>
<p>接下来搞定无线网卡，如果不想折腾直接用有线了行。Z7M-KP7GZ用的是Intel的无线网卡，这个在 macOS 下是无解的。<br>其他折腾过的网友建议是换Broadcom的。如果要使用AirDrop或者Handoff，要求有蓝牙4.0LE，需要特定型号的博通网卡，比如博通BCM94322HMP（有带蓝牙和不带蓝牙版本的，注意挑选）。</p>
<p>于是我就在淘宝上买了块 BCM94350 WiFi、蓝牙二合一。然后拆机将网卡换上去。网卡在风扇的旁边。<br><img src="/wp-content/uploads/2019/05/hasee_macos_07.jpg" alt=""></p>
<p>结果一开机系统就崩溃了，进入不了登录界面。后来联系卖家，他们说这个只有 macOS 10.13 的驱动，没有 10.14 的。而我安装主正是 10.14 的系统。<br>欲哭无泪啊，折腾了两天，BCM94350网卡的驱动实在搞不定。最后只得再买了个支持黑苹果的USB无线网卡。<br>另外显卡驱动目前在 10.14 下也是无解的。如果要外接显示器的话，可能需要再购买带显卡的 type-C 设备。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84175.html" data-id="clnqs27zy00lwsglp4k7j2p8f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac/" rel="tag">Mac</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><a class="extend next" rel="next" href="/page/2/">Next»</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux%E6%A0%8F%E7%9B%AE/">Linux栏目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python%E6%A0%8F%E7%9B%AE/">Python栏目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby%E6%A0%8F%E7%9B%AE/">Ruby栏目</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby%E6%A0%8F%E7%9B%AE/Web%E5%BC%80%E5%8F%91/">Web开发</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%BC%80%E5%8F%91/Python%E6%A0%8F%E7%9B%AE/">Python栏目</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/">前端相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%A0%8F%E7%9B%AE/">嵌入式栏目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">开源软件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/">数据结构和算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/">编程开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97/">网络日志</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/">资源分享</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARM/" rel="tag">ARM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Arch/" rel="tag">Arch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dreamweaver/" rel="tag">Dreamweaver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fedora/" rel="tag">Fedora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flash/" rel="tag">Flash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GObject/" rel="tag">GObject</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gentoo/" rel="tag">Gentoo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hash/" rel="tag">Hash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/" rel="tag">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PS/" rel="tag">PS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt/" rel="tag">Qt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspberry-pi/" rel="tag">Raspberry pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby/" rel="tag">Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrapy/" rel="tag">Scrapy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TQ2440/" rel="tag">TQ2440</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/USB/" rel="tag">USB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VirtualBox/" rel="tag">VirtualBox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web%E5%BC%80%E5%8F%91/" rel="tag">Web开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WordPress/" rel="tag">WordPress</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xcode/" rel="tag">Xcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/access/" rel="tag">access</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adobe/" rel="tag">adobe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ajax/" rel="tag">ajax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/" rel="tag">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/" rel="tag">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp/" rel="tag">asp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/firefox/" rel="tag">firefox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftp/" rel="tag">ftp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcc/" rel="tag">gcc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grub/" rel="tag">grub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gtk/" rel="tag">gtk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gulp/" rel="tag">gulp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ibus/" rel="tag">ibus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pygame/" rel="tag">pygame</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/" rel="tag">ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vmware/" rel="tag">vmware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/w3m/" rel="tag">w3m</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/" rel="tag">xml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%8D%E8%B4%B9/" rel="tag">免费</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E6%A0%B8/" rel="tag">内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/" rel="tag">匹配算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag">嵌入式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/" rel="tag">开源软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" rel="tag">排序算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E7%A9%BA%E9%97%B4/" rel="tag">文件空间</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A0%E7%BA%BF%E7%BD%91/" rel="tag">无线网</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">树莓派</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E5%BC%8F/" rel="tag">正则式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%A8%E5%86%8C%E6%9C%BA/" rel="tag">注册机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag">游戏</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E8%84%91%E6%8A%80%E5%B7%A7/" rel="tag">电脑技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A9%BA%E9%97%B4/" rel="tag">空间</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%A2%E6%97%97/" rel="tag">红旗</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E5%85%B8%E8%AF%AD%E5%BD%95/" rel="tag">经典语录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97/" rel="tag">网络日志</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BF%BB%E8%AF%91/" rel="tag">翻译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B/" rel="tag">视频教程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/" rel="tag">资源分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ARM/" style="font-size: 13.68px;">ARM</a> <a href="/tags/Android/" style="font-size: 10.53px;">Android</a> <a href="/tags/Arch/" style="font-size: 13.16px;">Arch</a> <a href="/tags/C/" style="font-size: 15.79px;">C</a> <a href="/tags/Django/" style="font-size: 11.05px;">Django</a> <a href="/tags/Docker/" style="font-size: 11.05px;">Docker</a> <a href="/tags/Dreamweaver/" style="font-size: 10px;">Dreamweaver</a> <a href="/tags/Fedora/" style="font-size: 10.53px;">Fedora</a> <a href="/tags/Flash/" style="font-size: 10px;">Flash</a> <a href="/tags/GObject/" style="font-size: 12.63px;">GObject</a> <a href="/tags/Gentoo/" style="font-size: 10.53px;">Gentoo</a> <a href="/tags/Hash/" style="font-size: 10px;">Hash</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Mac/" style="font-size: 10.53px;">Mac</a> <a href="/tags/PS/" style="font-size: 12.63px;">PS</a> <a href="/tags/Qt/" style="font-size: 10.53px;">Qt</a> <a href="/tags/Raspberry-pi/" style="font-size: 10px;">Raspberry pi</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Ruby/" style="font-size: 18.95px;">Ruby</a> <a href="/tags/Scrapy/" style="font-size: 11.05px;">Scrapy</a> <a href="/tags/TQ2440/" style="font-size: 12.11px;">TQ2440</a> <a href="/tags/USB/" style="font-size: 11.05px;">USB</a> <a href="/tags/VirtualBox/" style="font-size: 11.05px;">VirtualBox</a> <a href="/tags/Web%E5%BC%80%E5%8F%91/" style="font-size: 16.84px;">Web开发</a> <a href="/tags/WordPress/" style="font-size: 10px;">WordPress</a> <a href="/tags/Xcode/" style="font-size: 10px;">Xcode</a> <a href="/tags/access/" style="font-size: 12.63px;">access</a> <a href="/tags/adobe/" style="font-size: 10px;">adobe</a> <a href="/tags/ajax/" style="font-size: 11.05px;">ajax</a> <a href="/tags/angular/" style="font-size: 13.16px;">angular</a> <a href="/tags/apache/" style="font-size: 10px;">apache</a> <a href="/tags/asp/" style="font-size: 13.16px;">asp</a> <a href="/tags/css/" style="font-size: 10.53px;">css</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/firefox/" style="font-size: 11.05px;">firefox</a> <a href="/tags/ftp/" style="font-size: 10px;">ftp</a> <a href="/tags/gcc/" style="font-size: 12.63px;">gcc</a> <a href="/tags/git/" style="font-size: 13.68px;">git</a> <a href="/tags/grub/" style="font-size: 10px;">grub</a> <a href="/tags/gtk/" style="font-size: 17.89px;">gtk</a> <a href="/tags/gulp/" style="font-size: 10px;">gulp</a> <a href="/tags/ibus/" style="font-size: 10px;">ibus</a> <a href="/tags/js/" style="font-size: 16.32px;">js</a> <a href="/tags/k8s/" style="font-size: 10.53px;">k8s</a> <a href="/tags/mongodb/" style="font-size: 15.26px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 11.58px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/node/" style="font-size: 10.53px;">node</a> <a href="/tags/php/" style="font-size: 14.74px;">php</a> <a href="/tags/pygame/" style="font-size: 15.26px;">pygame</a> <a href="/tags/python/" style="font-size: 19.47px;">python</a> <a href="/tags/react/" style="font-size: 12.63px;">react</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/ruby/" style="font-size: 10px;">ruby</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/typescript/" style="font-size: 10px;">typescript</a> <a href="/tags/ubuntu/" style="font-size: 13.16px;">ubuntu</a> <a href="/tags/vim/" style="font-size: 18.42px;">vim</a> <a href="/tags/vmware/" style="font-size: 10px;">vmware</a> <a href="/tags/w3m/" style="font-size: 10px;">w3m</a> <a href="/tags/windows/" style="font-size: 13.16px;">windows</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a> <a href="/tags/%E5%85%8D%E8%B4%B9/" style="font-size: 10px;">免费</a> <a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 10px;">内核</a> <a href="/tags/%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/" style="font-size: 12.63px;">匹配算法</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 10.53px;">单片机</a> <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 10px;">嵌入式</a> <a href="/tags/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/" style="font-size: 14.21px;">开源软件</a> <a href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" style="font-size: 14.21px;">排序算法</a> <a href="/tags/%E6%96%87%E4%BB%B6%E7%A9%BA%E9%97%B4/" style="font-size: 10px;">文件空间</a> <a href="/tags/%E6%97%A0%E7%BA%BF%E7%BD%91/" style="font-size: 10px;">无线网</a> <a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 10px;">树莓派</a> <a href="/tags/%E6%AD%A3%E5%88%99%E5%BC%8F/" style="font-size: 10px;">正则式</a> <a href="/tags/%E6%B3%A8%E5%86%8C%E6%9C%BA/" style="font-size: 10.53px;">注册机</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 14.74px;">游戏</a> <a href="/tags/%E7%94%B5%E8%84%91%E6%8A%80%E5%B7%A7/" style="font-size: 14.21px;">电脑技巧</a> <a href="/tags/%E7%A9%BA%E9%97%B4/" style="font-size: 10px;">空间</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 17.37px;">算法</a> <a href="/tags/%E7%BA%A2%E6%97%97/" style="font-size: 10px;">红旗</a> <a href="/tags/%E7%BB%8F%E5%85%B8%E8%AF%AD%E5%BD%95/" style="font-size: 10px;">经典语录</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97/" style="font-size: 13.16px;">网络日志</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 18.42px;">翻译</a> <a href="/tags/%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B/" style="font-size: 14.74px;">视频教程</a> <a href="/tags/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/" style="font-size: 15.26px;">资源分享</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 10.53px;">转载</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">December 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">November 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">August 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">July 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/03/">March 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/02/">February 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/01/">January 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">December 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">October 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">August 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">July 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06/">June 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/05/">May 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/12/">December 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/11/">November 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/10/">October 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/09/">September 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/08/">August 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/07/">July 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/05/">May 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/12/">December 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/07/">July 2008</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/archives/.html">Bitbucket Runner 配置</a>
          </li>
        
          <li>
            <a href="/archives/84183.html">记录在docker中运行whenever遇到的问题</a>
          </li>
        
          <li>
            <a href="/archives/84182.html">Gitlab Runner 配置</a>
          </li>
        
          <li>
            <a href="/archives/84181.html">Github Runner 配置</a>
          </li>
        
          <li>
            <a href="/archives/84180.html">使用python编写帝国时代2修改器</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
  <h3 class="widget-title">Link</h3>
    <div class="widget">
      <ul id="category-list">
        <li><a target="_blank" title="我的Github" href="https://github.com/wusuopu">@Github</a></li>
        <li><a target="_blank" title="我的微博" href="http://www.weibo.com/u/1768691343">@Weibo</a></li>
        <li><a target="_blank" title="我的Twitter" href="https://twitter.com/longchangjin">@Twitter</a></li>
        <li><a target="_blank" title="我的豆瓣" href="http://www.douban.com/people/lchj/">@Douban</a></li>

        <li><a target="_blank" title="" href="http://gtk.awaysoft.com/">GTK+ 中文社区</a></li>
      </ul>
    </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 龍昌<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/gbook" class="mobile-nav-link">留言板</a>
  
</nav>
    


<script src="/js/jquery.min.js"></script>



  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>