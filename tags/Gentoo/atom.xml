<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Gentoo | 龍昌博客]]></title>
  <link href="http://www.xefan.com/tags/Gentoo/atom.xml" rel="self"/>
  <link href="http://www.xefan.com/"/>
  <updated>2016-06-26T13:08:06+08:00</updated>
  <id>http://www.xefan.com/</id>
  <author>
    <name><![CDATA[龍昌]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Linux下安装sudo工具]]></title>
    <link href="http://www.xefan.com/archives/83817.html"/>
    <updated>2013-04-14T00:00:00+08:00</updated>
    <id>http://www.xefan.com/archives/83817-Linux下安装sudo工具</id>
    <content type="html"><![CDATA[<p>以gentoo为例，先执行命令安装sudo工具<br/>
<code># emerge sudo</code></p>

<p>然后再进行配置。sudo的配置文件是/etc/sudoers。应当永远使用visudo命令编辑/etc/sudoers文件。visudo会锁住sudoers文件，保存修改到临时文件，然后检查文件格式，确保正确后才会覆盖sudoers文件。必须保证sudoers格式正确，否则sudo将无法运行。</p>

<p>编辑/etc/sudoers文件，加入以下内容：
<code>
Defaults    env_reset
Defaults    secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
</code></p>

<p>要为某个用户提供特权，使其可以使用sudo执行所有命令，在配置文件中加入：<br/>
<code>用户名   ALL=(ALL) ALL</code></p>

<p>如果只想允许本地登陆的用户使用sudo：<br/>
<code>用户名   主机名=(ALL) ALL</code></p>

<p>允许admin用户组成员无密码使用sudo：<br/>
<code>%admin      ALL=(ALL) NOPASSWD: ALL</code></p>

<p>请把用户名替换为实际用户名称。</p>

<p>只为用户启用部分特权：<br/>
<code>用户名 主机名=/sbin/halt,/sbin/reboot -Syu</code><br/>
<code>该用户只能使用sudo执行halt、reboot。</code></p>

<p>在~/.bashrc中加入 complete -cf sudo 开启sudo的自动补全。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gentoo安装笔记]]></title>
    <link href="http://www.xefan.com/archives/83811.html"/>
    <updated>2013-01-27T00:00:00+08:00</updated>
    <id>http://www.xefan.com/archives/83811-Gentoo安装笔记</id>
    <content type="html"><![CDATA[<p>参考官方手册，并整理一下。<a href="http://www.gentoo.org/doc/zh_cn/handbook/">http://www.gentoo.org/doc/zh_cn/handbook/</a>
下载iso文件，并使用其进行引导系统。安装光盘上提供了几个内核。默认的是gentoo。<br/>
即使用boot:gentoo来启动安装光盘即可。</p>

<p>整个安装过程需要联网进行，请确保网络已经配置好了。</p>

<p>1、先创建一个分区，然后挂载到/mnt/gentoo目录下。</p>

<p>2、安装需要的安装文件<br/>
(1)、下载stage3 tarball文件，并解压到安装目录下，也就是/mnt/gentoo。<br/>
(2)、下载安装Portage文件。<br/>
<code># cd /mnt/gentoo</code><br/>
<code># tar xvf portage-lastest.bar.bz2 -C /mnt/gentoo/usr</code></p>

<p>3、配置编译选项<br/>
定义CFLAGS和CXXFLAGS变量</p>

<pre><code># nano -w /mnt/gentoo/etc/portage/make.conf

CFLAGS="-O2 -march=i686 -pipe"
# 两个变量使用相同的设置
CXXFLAGS="${CFLAGS}"
</code></pre>

<p>4、安装Gentoo基本系统<br/>
为了快速下载源代码，建议选择一个速度快的境像。我用的网易的源，在make.conf文件中添加以下内容。<br/>
<code>GENTOO_MIRRORS="http://mirrors.163.com/gentoo/"</code></p>

<p>(1)、拷贝DNS信息<br/>
<code># cp -L /etc/resolv.conf /mnt/gentoo/etc</code></p>

<p>(2)、挂载proc和dev文件系统<br/>
<code># mount -t proc none /mnt/gentoo/proc</code><br/>
<code># mount -o bind /dev /mnt/gentoo/dev</code></p>

<p>(3)、进入新系统环境<br/>
<code># chroot /mnt/gentoo /bin/bash</code><br/>
<code># env-update</code><br/>
<code># source /etc/profile</code><br/>
<code># export PS1="(chroot)$PS1"</code></p>

<p>(4)、配置Portage<br/>
更新Portage树<br/>
<code># emerge --sync</code></p>

<p>修改/etc/locale.gen文件设置locale然后再执行命令locale-gen</p>

<p>5、配置内核<br/>
(1)、设置时区，我这用的是上海的时区。<br/>
<code># cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code></p>

<p>(2)、安装源码<br/>
<code># emerge gentoo-sources</code><br/>
然后内核源码就会下载到/usr/src/linux目录下。转到该目录进行内核编译配置。<br/>
<code># cd /usr/src/linux</code><br/>
执行以下命令进行手动配置，手动配置就要注意驱动都要选对，并且要编译进内核，不要编译成模块。反正我是编译了好几次系统都不能正常启动。最后我就使用自动配置。<br/>
<code># make menuconfig</code></p>

<p>自动编译内核首先先安装genkernel<br/>
<code># emerge genkernel</code><br/>
然后复制光盘上的内核配置文件到genkernel搜索配置文件的默认位置。<br/>
  # zcat /proc/config.gz &gt; /usr/share/genkernel/arch/x86/kernel-config<br/>
现在执行如下命令编译内核。这样编译出来的内核支持几乎所有配件，但是耗时较多。<br/>
<code># genkernel all</code><br/>
编译完成后将会在/boot目录下生成内核文件和initrd文件。</p>

<p>6、配置系统<br/>
(1)、文件系统信息<br/>
编辑/etc/fstab文件，设置分区的挂载。</p>

<p>(2)、网络信息<br/>
编辑/etc/conf.d/hostname文件，设置主机名。<br/>
编辑/etc/conf.d/net 文件，设置ip。<br/>
手动设置ip，设置 config_eth0和routes_eth0：<br/>
config_eth0=( &ldquo;192.168.0.2 netmask 255.255.255.0 brd 192.168.0.255&rdquo; )<br/>
routes_eth0=( &ldquo;default via 192.168.0.1&rdquo; )<br/>
使用DHCP，请定义一下config_eth0：<br/>
config_eth0=( &ldquo;dhcp&rdquo; )</p>

<p>创建启动脚本，并设置自动启动。</p>

<pre><code># cd /etc/init.d
# ls -s net.lo net.eth0
# rc-update add net.eth0 default
</code></pre>

<p>(3)、系统信息<br/>
设置root密码，并创建一个普通用户。<br/>
<code># passwd</code><br/>
<code># useradd users</code></p>

<p>7、安装一些系统工具<br/>
根据自己需求再安装一些系统工具。<br/>
(1)、系统日志工具<br/>
<code># emerge syslog-ng</code><br/>
<code># rc-update add syslog-ng default</code></p>

<p>(2)、守护进程<br/>
<code># emerge vixie-cron</code><br/>
<code># rc-update add vixie-cron default</code></p>

<p>(3)、网络工具<br/>
<code># emerge dhcpd</code><br/>
<code># emerge ppp</code></p>

<p>8、配置引导程序<br/>
Gentoo提供的引导程序有GRUB和LILO，我用的是GRUB。<br/>
安装Grub，请根据自己的情况进行调整。<br/>
&#8220;`</p>

<h1>emerge grub</h1>

<h1>grep -v rootfs /proc/mounts &gt; /etc/mtab</h1>

<h1>grub-install &ndash;no-floppy /dev/sda</h1>

<h1>update-grub -o /boot/grub/grub.conf</h1>

<pre><code>
9、重启系统  
</code></pre>

<h1>eixt</h1>

<h1>umount /mnt/gentoo/{dev,proc,}</h1>

<h1>reboot</h1>

<p>&#8220;`</p>
]]></content>
  </entry>
  
</feed>
