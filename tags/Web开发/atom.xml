<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Web开发 | 龍昌博客]]></title>
  <link href="http://www.xefan.com/tags/Web开发/atom.xml" rel="self"/>
  <link href="http://www.xefan.com/"/>
  <updated>2016-06-18T22:29:12+08:00</updated>
  <id>http://www.xefan.com/</id>
  <author>
    <name><![CDATA[龍昌]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[使用Unicorn部署rails应用]]></title>
    <link href="http://www.xefan.com/archives/84142.html"/>
    <updated>2015-04-05T20:47:15+08:00</updated>
    <id>http://www.xefan.com/archives/84142-使用Unicorn部署rails应用</id>
    <content type="html"><![CDATA[<p>玩 rails 也有段时间了，最近研究下怎么部署一个 rails 应用。在几年前的话要部署 rails 应用是件很麻烦的事，
但是近几年出现了一些比较好的工具可以方便的进行 rails 部署。如： Unicorn、thin、Passenger等。</p>

<p>Unicorn 是一个 Rack 应用的HTTP服务器。之前玩 Python 的时候也有一个 Gunicorn ，使用它来部署 Python 的 Web 应用
也很方便，可以参考我之前的那篇文件 <a href="84138.html">《使用gunicorn部署Django》</a> 。</p>

<p>接下来简单分享下使用 Nginx + Unicorn 来部署 rails 的配置。</p>

<h2>安装</h2>

<p>首先安装 unicorn 包： <code>$ gem install unicorn</code></p>

<p>然后编译一下静态文件：</p>

<pre><code>$ RAILS_ENV=production rake assets:clean
$ RAILS_ENV=production rake assets:precompile
</code></pre>

<p>下载配置文件： <code>$ curl -o config/unicorn.rb https://raw.github.com/defunkt/unicorn/master/examples/unicorn.conf.rb</code></p>

<p>接着根据情况修改相关配置，如： working_directory、listen 等。
例如我的是需要同时监听网络端口和 sock 文件，那么我的 listen 设置如下：</p>

<pre><code>listen "#{root_path}/tmp/sockets/unicorn.sock", :backlog =&gt; 64
listen 8081, :tcp_nopush =&gt; true
</code></pre>

<h2>配置 Nginx</h2>

<p>然后配置 Nginx 的反向代理，以下是我的 Nginx 配置示例：</p>

<pre><code>upstream rails_server {
  server unix:/app_path/tmp/sockets/unicorn.sock fail_timeout=0;
}

server {
  listen 80;
    server_name webserver localhost;

    root /app_path/public;

  try_files $uri $uri @unicorn;

  location @unicorn {
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_redirect off;
    proxy_pass http://rails_server;
  }

  location ~ /\.ht {
    deny  all;
  }
}
</code></pre>

<h2>启动服务</h2>

<p>配置完成之后，最后启动服务。</p>

<pre><code>$ bundle exec unicorn_rails -c config/unicorn.rb -D -E production
$ sudo service nginx start
</code></pre>

<p>然后再在浏览器中访问试试。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rack开发简介]]></title>
    <link href="http://www.xefan.com/archives/84103.html"/>
    <updated>2014-05-02T00:00:00+08:00</updated>
    <id>http://www.xefan.com/archives/84103-Rack开发简介</id>
    <content type="html"><![CDATA[<p>Rack是Ruby应用与web服务器之间的一个接口，它在服务器与应用程序之间作为中间件，可以对用户的请求和程序的返回数据进行处理。现在几乎所有主流的Ruby web框架都是支持Rack接口的。</p>


<p>Rack与Python的wsgi很相似，在它的规格书（http://rack.rubyforge.org/doc/SPEC.html）中也说道它采用了WSGI的一些内容。</p>


<h2>开始</h2>


<p>首先安装Rack:</p>


<pre><code>[sudo] gem install rack
</code></pre>


<p>然后通过一个简单的例子来讲解。</p>


<pre><code>require "rack"
rack_app = lambda{|env| [200, {}, ["Hello World!"]]}
Rack::Handler::WEBrick.run rack_app, :Port =&gt; 3000
</code></pre>


<p>执行上述代码，然后访问 http://127.0.0.1:3000 会看到 &#8220;Hello World!&#8221;。</p>


<p>上面代码中的rack_app即是一个Rack应用。Rack应用除了lambda之外也还可以使用其他对象，只要满足以下条件即可：<br>
  * 可响应call方法的对象；<br>
  * 接收一个参数rack环境 environment 。它是一个散列表，包含了CGI的信息和rack的一些变量；<br>
  * 返回一个有三个值的数组，第一个值为返回状态 status；第二个值为返回头 headers，也是一个散列表；第三个值为返回正文 body，它必须是一个可响应each方法并生成字符串的对象，例如字符串数组。</p>


<p>WEBrick是Handler的一种。Handler用于将web服务器与Rack连接。使用 Rack::Handler.constants 可以查看Rack包含的所有Handler。</p>


<h2>请求/Request</h2>


<p>在Rack应用中可以直接操作env参数来访问请求信息，但是这种方法不太方便。对于这种操作Rack::Request对象提供了方便的接口。</p>


<pre><code>request = Rack::Request.new env
</code></pre>


<p>创建request对象时传入env参数。</p>


<h2>响应/Response</h2>


<p>Rack应用的返回值是一个有三个值的数组，包含了返回状态、返回头和返回正文。对于简单的程序手动构建数组还行，如果是复杂的程序则要考虑自动构建了。<br>
同样的可以使用Rack::Request对象来创建返回数据。</p>


<pre><code>response = Rack::Response.new
response.finish
</code></pre>


<p>内容填充完之后调用response对象的finish方法生成符合Rack规范的数组对象。</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用css3绘制lxde桌面]]></title>
    <link href="http://www.xefan.com/archives/84032.html"/>
    <updated>2014-01-15T00:00:00+08:00</updated>
    <id>http://www.xefan.com/archives/84032-使用css3绘制lxde桌面</id>
    <content type="html"><![CDATA[<p>最近在学习CSS，本来是打算写点小东西练习练习。正好自己用的是linux系统的lxde桌面，于是就用CSS来绘制一个lxde。</p>


<p>在做的过程中发现了less，感觉很不错，于是就把less也加进来了。</p>


<p>最后的效果图：</p>


<p><img src="https://github.com/wusuopu/css3-lxde/blob/master/snapshoot/lxde0.png?raw=true" /></p>


<p><img src="https://github.com/wusuopu/css3-lxde/blob/master/snapshoot/lxde1.png?raw=true" /></p>


<p><img src="https://github.com/wusuopu/css3-lxde/blob/master/snapshoot/lxde2.png?raw=true" /></p>


<p>源代码： https://github.com/wusuopu/css3-lxde</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用CSS3绘制海贼王]]></title>
    <link href="http://www.xefan.com/archives/84018.html"/>
    <updated>2013-12-11T00:00:00+08:00</updated>
    <id>http://www.xefan.com/archives/84018-使用CSS3绘制海贼王</id>
    <content type="html"><![CDATA[<p style="-qt-block-indent: 0; text-indent: 0px; margin: 0px;">之前国外有网友用CSS3绘制了一个哆啦A梦，最近也在学习CSS，于是就自己画了一个海贼王的图标。</p>


<p style="-qt-block-indent: 0; text-indent: 0px; margin: 0px;"></p>


<p style="-qt-block-indent: 0; text-indent: 0px; margin: 0px;">以下是画出来的效果：</p>


<p style="-qt-block-indent: 0; text-indent: 0px; margin: 0px;"></p>


<p style="-qt-block-indent: 0; text-indent: 0px; margin: 0px;"><a href="http://www.xefan.com/wp-content/uploads/2013/12/lufei.png"><img class="aligncenter size-medium wp-image-84019" title="lufei" src="http://www.xefan.com/wp-content/uploads/2013/12/lufei-300x233.png" alt="" width="300" height="233" /></a></p>


<p style="-qt-block-indent: 0; text-indent: 0px; margin: 0px;"></p>


<p style="-qt-block-indent: 0; text-indent: 0px; margin: 0px;"></p>


<p style="-qt-block-indent: 0; text-indent: 0px; margin: 0px;">以下是原图：</p>


<p style="-qt-paragraph-type: empty; -qt-block-indent: 0; text-indent: 0px; margin: 0px;"><a href="http://www.xefan.com/wp-content/uploads/2013/12/caimao.jpg"><img class="aligncenter size-medium wp-image-84021" title="caimao" src="http://www.xefan.com/wp-content/uploads/2013/12/caimao-300x192.jpg" alt="" width="300" height="192" /></a></p>


<p>源代码： <a href="https://gist.github.com/wusuopu/7910942">https://gist.github.com/wusuopu/7910942</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Python wsgi教程5——POST请求]]></title>
    <link href="http://www.xefan.com/archives/84015.html"/>
    <updated>2013-12-08T00:00:00+08:00</updated>
    <id>http://www.xefan.com/archives/84015-python wsgi教程5——POST请求</id>
    <content type="html"><![CDATA[<p>当请求方法为POST时，请求字符串会放在HTTP的body中。可以使用环境变量中的wsgi.input进行读取。同时CONTENT_LENGTH变量记录了内容的长度。</p>

<p>下面是一个简单的例子：</p>

<pre><code class="python">#!/usr/bin/env python

from wsgiref.simple_server import make_server
from cgi import parse_qs, escape

html = """
&lt;html&gt;
&lt;body&gt;
   &lt;form method="post" action=""&gt;
      &lt;p&gt;
         Age: &lt;input type="text" name="age"&gt;
         &lt;/p&gt;
      &lt;p&gt;
         Hobbies:
         &lt;input name="hobbies" type="checkbox" value="software"&gt; Software
         &lt;input name="hobbies" type="checkbox" value="tunning"&gt; Auto Tunning
         &lt;/p&gt;
      &lt;p&gt;
         &lt;input type="submit" value="Submit"&gt;
         &lt;/p&gt;
      &lt;/form&gt;
   &lt;p&gt;
      Age: %s&lt;br&gt;
      Hobbies: %s
      &lt;/p&gt;
   &lt;/body&gt;
&lt;/html&gt;
"""

def application(environ, start_response):

   # the environment variable CONTENT_LENGTH may be empty or missing
   try:
      request_body_size = int(environ.get('CONTENT_LENGTH', 0))
   except (ValueError):
      request_body_size = 0

   # When the method is POST the query string will be sent
   # in the HTTP request body which is passed by the WSGI server
   # in the file like wsgi.input environment variable.
   request_body = environ['wsgi.input'].read(request_body_size)
   d = parse_qs(request_body)

   age = d.get('age', [''])[0] # Returns the first age value.
   hobbies = d.get('hobbies', []) # Returns a list of hobbies.

   # Always escape user input to avoid script injection
   age = escape(age)
   hobbies = [escape(hobby) for hobby in hobbies]

   response_body = html % (age or 'Empty',
               ', '.join(hobbies or ['No Hobbies']))

   status = '200 OK'

   response_headers = [('Content-Type', 'text/html'),
                  ('Content-Length', str(len(response_body)))]
   start_response(status, response_headers)

   return [response_body]

httpd = make_server('localhost', 8051, application)
httpd.serve_forever()
</code></pre>
]]></content>
  </entry>
  
</feed>
