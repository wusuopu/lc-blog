<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>龍昌博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="关注Linux及开源信息">
<meta property="og:type" content="website">
<meta property="og:title" content="龍昌博客">
<meta property="og:url" content="http://www.xefan.com/page/5/index.html">
<meta property="og:site_name" content="龍昌博客">
<meta property="og:description" content="关注Linux及开源信息">
<meta property="og:locale">
<meta property="article:author" content="龍昌">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="龍昌博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 6.1.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">龍昌博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/gbook">留言板</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.xefan.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Ruby中一些重要的钩子方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84143.html" class="article-date">
  <time datetime="2015-04-30T14:35:42.000Z" itemprop="datePublished">2015-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Ruby%E6%A0%8F%E7%9B%AE/">Ruby栏目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84143.html">Ruby中一些重要的钩子方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Ruby的哲学理念是基于一个基本的要素，那就是让程序员快乐。Ruby非常注重程序员的快乐，并且也提供了许多不同的方法来实现它。<br>它的元编程能力能够让程序员编写在运行时动态生成的代码。它的线程功能使得程序员有一种优雅的的方式编写多线程代码。<br>它的钩子方法能让程序员在程序运行时扩展它的行为。</p>
<p>上述的这些特性，以及一些其他很酷的语言方面，使得Ruby成为编写代码的优先选择之一。<br>本文将探讨Ruby中的一些重要的钩子方法。我们将从不同方面讨论钩子方法，如它们是什么，它们用于什么，以及我们如何使用它们来解决不同的问题。<br>我们同时也了解一下一些流行的Ruby框架/Gem包/库是如何使用它们来提供非常酷的特性的。</p>
<p>我们开始吧。</p>
<h1 id="什么是钩子方法？"><a href="#什么是钩子方法？" class="headerlink" title="什么是钩子方法？"></a>什么是钩子方法？</h1><p>钩子方法提供了一种方式用于在程序运行时扩展程序的行为。<br>假设有这样的功能，可以在无论何时一个子类继承了一些特定的父类时收到通知，<br>或者是比较优雅地处理一个对象上的不可调用的方法而不是让编译器抛出异常。<br>这些情况就是使用钩子方法，但是它们的用法并不仅限于此。<br>不同的框架/库使用了不同的钩子方法来实现它们的功能。</p>
<p>在本文中我们将会讨论如下几个钩子方法：</p>
<ul>
<li>included</li>
<li>extended</li>
<li>prepended</li>
<li>inherited</li>
<li>method_missing</li>
</ul>
<h2 id="included"><a href="#included" class="headerlink" title="included"></a>included</h2><p>Ruby给我们提供了一种方式使用 <code>模块(modules)</code> （在其他语言中被称作 <code>混入类(mixins)</code>）来编写模块化的代码供其他的 <code>模块</code>/<code>类</code> 使用。<br><code>模块</code> 的概念很简单，它就是一个可以在其他地方使用的独立代码块。</p>
<p>例如，如果我们想要编写一些代码在任何时候调用特定的方法都会返回一个静态字符串。<br>我们姑且将这个方法称作 <code>name</code>。你可能在其他地方也会想使用同一块代码。<br>这样最好是新建一个模块。让我们来创建一个：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Person</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    puts <span class="string">&quot;My name is Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>这是一个非常简单的模块，仅有一个 <code>name</code> 方法用于返回一个静态字符串。在我们的程序中使用这个模块：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span></span><br><span class="line">  <span class="keyword">include</span> Person</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Ruby提供了一些不同的方法来使用<code>模块</code>。<code>include</code> 是其中之一。<code>include</code> 所做的就是将在 <code>module</code> 内定义的方法在一个 <code>class</code> 的实例变量上可用。<br>在我们的例子中，是将 <code>Person</code> 模块中定义的方法变为一个 <code>User</code> 类实例对象的方法。<br>这就相当于我们是将 <code>name</code> 方法写在 <code>User</code> 类里一样，但是定义在 <code>module</code> 里的好处是可复用。<br>要调用 <code>name</code> 方法我们需要创建一个 <code>User</code> 的实例对象，然后再在这个对象上调用 <code>name</code> 方法。例如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User.new.name</span><br><span class="line">=&gt; My name is Person</span><br></pre></td></tr></table></figure>
<p>让我们看看基于 <code>include</code> 的钩子方法。<code>included</code> 是Ruby提供的一个钩子方法，当你在一些 <code>module</code> 或者 <code>class</code> 中 <code>include</code> 了一个 <code>module</code> 时它会被调用。<br>更新 <code>Person</code> 模块：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Person</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">self</span>.included(base)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;base&#125;</span> included <span class="subst">#&#123;<span class="variable language_">self</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name is Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>你可以看到一个新的方法 <code>included</code> 被定义为 <code>Person</code> 模块的类方法。当你在其他的模块或者类中执行 <code>include Person</code> 时，这个 <code>included</code> 方法会被调用。<br>该方法接收的一个参数是对包含该模块的类的引用。试试运行 <code>User.new.name</code>，你会看到如下的输出：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User included Person</span><br><span class="line">My name is Person</span><br></pre></td></tr></table></figure>
<p>正如你所见，<code>base</code> 返回的是包含该模块的类名。现在我们有了一个包含 <code>Person</code> 模块的类的引用，我们可以通过元编程来实现我们想要的功能。<br>让我们来看看 <strong>Devise</strong>是如何使用 <code>included</code> 钩子的。</p>
<h3 id="Devise中的-included"><a href="#Devise中的-included" class="headerlink" title="Devise中的 included"></a>Devise中的 <code>included</code></h3><p>Devise是Ruby中使用最广泛的身份验证gem包之一。它主要是由我喜欢的程序员 <a target="_blank" rel="noopener" href="https://twitter.com/josevalim">José Valim</a> 开发的，现在是由一些了不起的贡献者在维护。<br>Devise为我们提供了从注册到登录，从忘记密码到找回密码等等完善的功能。它可以让我们在用户模型中使用简单的语法来配置各种模块：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devise <span class="symbol">:database_authenticatable</span>, <span class="symbol">:registerable</span>, <span class="symbol">:validatable</span></span><br></pre></td></tr></table></figure>
<p>在我们模型中使用的 <code>devise</code> 方法在<a target="_blank" rel="noopener" href="https://github.com/plataformatec/devise/blob/v3.4.1/lib/devise/models.rb#L77">这里</a>定义。<br>为了方便我将这段代码粘贴在下面：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">devise</span>(<span class="params">*modules</span>)</span><br><span class="line">  options = modules.extract_options!.dup</span><br><span class="line"> </span><br><span class="line">  selected_modules = modules.map(&amp;<span class="symbol">:to_sym</span>).uniq.sort_by <span class="keyword">do</span> |<span class="params">s</span>|</span><br><span class="line">    Devise::<span class="variable constant_">ALL</span>.index(s) |<span class="params"></span>| -<span class="number">1</span>  <span class="comment"># follow Devise::ALL order</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">  devise_modules_hook! <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">include</span> Devise::Models::Authenticatable</span><br><span class="line"> </span><br><span class="line">    selected_modules.each <span class="keyword">do</span> |<span class="params">m</span>|</span><br><span class="line">      mod = Devise::Models.const_get(m.to_s.classify)</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span> mod.const_defined?(<span class="string">&quot;ClassMethods&quot;</span>)</span><br><span class="line">        class_mod = mod.const_get(<span class="string">&quot;ClassMethods&quot;</span>)</span><br><span class="line">        extend class_mod</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> class_mod.respond_to?(<span class="symbol">:available_configs</span>)</span><br><span class="line">          available_configs = class_mod.available_configs</span><br><span class="line">          available_configs.each <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line">            <span class="keyword">next</span> <span class="keyword">unless</span> options.key?(config)</span><br><span class="line">            send(<span class="symbol">:<span class="string">&quot;<span class="subst">#&#123;config&#125;</span>=&quot;</span></span>, options.delete(config))</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">      <span class="keyword">include</span> mod</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">self</span>.devise_modules |<span class="params">= selected_modules</span></span><br><span class="line"><span class="params">    options.each &#123; </span>|key, value|<span class="params"> send(:&quot;#&#123;key&#125;=&quot;, value) &#125;</span></span><br><span class="line"><span class="params">  <span class="keyword">end</span></span></span><br><span class="line"><span class="params"><span class="keyword">end</span></span></span><br></pre></td></tr></table></figure>
<p>在我们的模型中传给 <code>devise</code> 方法的模块名将会作为一个数组保存在 <code>*modules</code> 中。<br>对于传入的模块调用 <code>extract_options!</code> 方法提取可能传入的选项。<br>在11行中调用 <code>each</code> 方法，并且每个模块在代码块中用 <code>m</code> 表示。<br>在12行中 <code>m</code> 将会转化为一个常量（类名），因此使用 <code>m.to.classify</code> 一个例如 <code>:validatable</code> 这样的符号会变为 <code>Validatable</code> 。<br>随便说一下 <code>classify</code> 是ActiveSupport的方法。<br><code>Devise::Models.const_get(m.to_classify)</code> 会获取该模块的引用，并赋值给 <code>mod</code>。<br>在27行使用 <code>include mod</code> 包含该模块。<br>例子中的 <code>Validatable</code> 模块是定义在<a target="_blank" rel="noopener" href="https://github.com/plataformatec/devise/blob/v3.4.1/lib/devise/models/validatable.rb">这里</a>。<br><code>Validatable</code> 的 <code>included</code> 钩子方法定义如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">self</span>.included(base)</span><br><span class="line">  base.extend ClassMethods</span><br><span class="line">  assert_validations_api!(base)</span><br><span class="line"> </span><br><span class="line">  base.class_eval <span class="keyword">do</span></span><br><span class="line">    validates_presence_of   <span class="symbol">:email</span>, <span class="symbol">if:</span> <span class="symbol">:email_required?</span></span><br><span class="line">    validates_uniqueness_of <span class="symbol">:email</span>, <span class="symbol">allow_blank:</span> <span class="literal">true</span>, <span class="symbol">if:</span> <span class="symbol">:email_changed?</span></span><br><span class="line">    validates_format_of     <span class="symbol">:email</span>, <span class="symbol">with:</span> email_regexp, <span class="symbol">allow_blank:</span> <span class="literal">true</span>, <span class="symbol">if:</span> <span class="symbol">:email_changed?</span></span><br><span class="line"> </span><br><span class="line">    validates_presence_of     <span class="symbol">:password</span>, <span class="symbol">if:</span> <span class="symbol">:password_required?</span></span><br><span class="line">    validates_confirmation_of <span class="symbol">:password</span>, <span class="symbol">if:</span> <span class="symbol">:password_required?</span></span><br><span class="line">    validates_length_of       <span class="symbol">:password</span>, <span class="symbol">within:</span> password_length, <span class="symbol">allow_blank:</span> <span class="literal">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>此时模型是 <code>base</code>。在第5行的 <code>class_eval</code> 代码块会以该类作为上下文进行求值运算。<br>通过 <code>class_eval</code> 编写的代码与直接打开该类的文件将代码粘贴进去效果是一样的。<br>Devise是通过 <code>class_eval</code> 将验证包含到我们的用户模型中的。</p>
<p>当我们试着使用Devise注册或者登录时，我们会看到这些验证，但是我们并没有编写这些验证代码。<br>Devise是利用了 <code>included</code> 钩子来实现这些的。非常的优雅吧。</p>
<h2 id="extended"><a href="#extended" class="headerlink" title="extended"></a>extended</h2><p>Ruby也允许开发者 <code>扩展(extend)</code> 一个模块，这与 <code>包含(include)</code> 有点不同。<br><code>extend</code> 是将定义在 <code>模块(module)</code> 内的方法应用为类的方法，而不是实例的方法。<br>让我们来看一个简单的例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Person</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name is Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span></span><br><span class="line">  extend Person</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">puts User.name <span class="comment"># =&gt; My name is Person</span></span><br></pre></td></tr></table></figure>
<p>正如你所看到的，我们将 <code>Person</code> 模块内定义的 <code>name</code> 方法作为了 <code>User</code> 的类方法调用。<br><code>extend</code> 将 <code>Person</code> 模块内的方法添加到了 <code>User</code> 类中。<code>extend</code> 同样也可以用于将模块内的方法作为单例方法(singleton methods)。<br>让我们再来看另外一个例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We are using same Person module and User class from previous example.     </span></span><br><span class="line"></span><br><span class="line">u1 = User.new</span><br><span class="line">u2 = User.new</span><br><span class="line"></span><br><span class="line">u1.extend Person</span><br><span class="line"></span><br><span class="line">puts u1.name <span class="comment"># =&gt; My name is Person</span></span><br><span class="line">puts u2.name <span class="comment"># =&gt; undefined method `name&#x27; for #&lt;User:0x007fb8aaa2ab38&gt; (NoMethodError)</span></span><br></pre></td></tr></table></figure>
<p>我们创建了两个 <code>User</code> 的实例对象，并将 <code>Person</code> 作为参数在 <code>u1</code> 上调用 <code>extend</code> 方法。<br>使用这种调用方式，<code>Person</code> 的 <code>name</code> 方法仅对 <code>u1</code> 有效，对于其他实例是无效的。</p>
<p>正如 <code>included</code> 一样，与 <code>extend</code> 相对应的钩子方法是 <code>extended</code>。<br>当一个模块被其他模块或者类执行了 <code>extend</code> 操作时，该方法将会被调用。<br>让我们来看一个例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Modified version of Person module</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> Person</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">self</span>.extended(base)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;base&#125;</span> extended <span class="subst">#&#123;<span class="variable language_">self</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name is Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span></span><br><span class="line">  extend Person</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>该代码的运行结果是输出 <code>User extended Person</code>。</p>
<p>关于 <code>extended</code> 的介绍已经完了，让我们来看看 <code>ActiveRecord</code> 是如何使用它的。</p>
<h3 id="ActiveRecord中的-extended"><a href="#ActiveRecord中的-extended" class="headerlink" title="ActiveRecord中的 extended"></a>ActiveRecord中的 <code>extended</code></h3><p><code>ActiveRecord</code> 是在 Ruby 以及 Rails 中广泛使用的ORM框架。它具有许多酷的特性，<br>因此使用它在很多情况下成为了ORM的首选。让我们进入 <code>ActiveRecord</code> 内部看看 <code>ActiveRecord</code> 是如何使用回调的。<br>(我们使用的是 Rails v3.2.21)</p>
<p><code>ActiveRecord</code> 在<a target="_blank" rel="noopener" href="https://github.com/rails/rails/blob/v3.2.21/activerecord/lib/active_record/callbacks.rb#L246">这里</a> <code>extend</code> 了 <code>ActiveRecord::Models</code> 模块。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extend ActiveModel::Callbacks</span><br></pre></td></tr></table></figure>
<p><code>ActiveModel</code> 提供了一套在模型类中使用的接口。它们允许 ActionPack 与不是 ActiveRecord 的模型进行交互。<br>在<a target="_blank" rel="noopener" href="https://github.com/rails/rails/blob/v3.2.21/activemodel/lib/active_model/callbacks.rb#L49-L53">这里</a>， <code>ActiveModel::Callbacks</code> 内部你将会看到如下代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">self</span>.extended(base)</span><br><span class="line">  base.class_eval <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">include</span> ActiveSupport::Callbacks</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>ActiveModel::Callbacks</code> 对 <code>base</code> 即就是 <code>ActiveRecord::Callbacks</code> 调用了 <code>class_eval</code> 方法，<br>并包含了 <code>ActiveSupport::Callbacks</code> 模块。我们前面已经提到过了，对一个类调用 <code>class_eval</code> 与手动地将代码写在这个类里是一样的。<br><code>ActiveSupport::Callbacks</code> 为 <code>ActiveRecord::Callbacks</code> 提供了 Rails 中的回调方法。</p>
<p>这里我们讨论了 <code>extend</code> 方法，以及与之对应的钩子 <code>extended</code>。并且也了解了 <code>ActiveRecord</code> / <code>ActiveModel</code><br>是如何使用上述方法为我们提供可用功能的。</p>
<h2 id="prepended"><a href="#prepended" class="headerlink" title="prepended"></a>prepended</h2><p>另一个使用定义在模块内部方法的方式称为 <code>prepend</code>。<code>prepend</code> 是在Ruby 2.0中引入的，并且与 <code>include</code> 和 <code>extend</code> 很不一样。<br>使用 <code>include</code> 和 <code>extend</code> 引入的方法可以被目标模块/类重新定义覆盖。<br>例如，如果我们在某个模块中定义了一个名为 <code>name</code> 的方法，并且在目标模块/类中也定义同名的方法。<br>那么这个在我们类在定义的 <code>name</code> 方法将会覆盖模块中的。而 <code>prepend</code> 是不一样的，它会将 <code>prepend</code> 引入的模块<br>中的方法覆盖掉我们模块/类中定义的方法。让我们来看一个简单的例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Person</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name belongs to Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span></span><br><span class="line">  <span class="keyword">include</span> Person</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name belongs to User&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">puts User.new.name </span><br><span class="line">=&gt; My name belongs to User</span><br></pre></td></tr></table></figure>
<p>现在再来看看 <code>prepend</code> 的情况：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Person</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name belongs to Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span></span><br><span class="line">  prepend Person</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name belongs to User&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">puts User.new.name </span><br><span class="line">=&gt; My name belongs to Person</span><br></pre></td></tr></table></figure>
<p>使用 <code>prepend Person</code> 会将 <code>User</code> 中的同名方法给覆盖掉，因此在终端输出的结果为 <code>My name belongs to Person</code>。<br><code>prepend</code> 实际上是将方法添加到方法链的前端。在调用 <code>User</code> 类内定义的 <code>name</code> 方法时，会调用 <code>super</code> 从而调用 <code>Person</code> 模块的 <code>name</code>。</p>
<p>与 <code>prepend</code> 对应的回调名为（你应该猜到了） <code>prepended</code>。当一个模块被预置到另一个模块/类中时它会被调用。<br>我们来看下效果。更新 <code>Person</code> 模块的定义：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Person</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">self</span>.prepended(base)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>&#125;</span> prepended to <span class="subst">#&#123;base&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name belongs to Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>你再运行这段代码应该会看到如下结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person prepended to User</span><br><span class="line">My name belongs to Person</span><br></pre></td></tr></table></figure>
<p><code>prepend</code> 的引入是为了去除 <code>alias_method_chain</code> hack的丑陋，它曾被Rails以及其他库广泛地使用以达到与 <code>prepend</code> 相同的功能。<br>因为 <code>prepend</code> 只有在 Ruby &gt;= 2.0 的版本中才能使用，因此如果你打算使用 <code>prepend</code> 的话，那么你就应该升级你的Ruby版本。</p>
<h2 id="inherited"><a href="#inherited" class="headerlink" title="inherited"></a>inherited</h2><p>继承是面向对象中一个最重要的概念。Ruby是一门面向对象的编程语言，并且提供了从基/父类继承一个子类的功能。<br>我们来看一个简单的例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">     <span class="string">&quot;My name is Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &lt; <span class="title class_ inherited__">Person</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">puts User.new.name <span class="comment"># =&gt; My name is Person</span></span><br></pre></td></tr></table></figure>
<p>我们创建了一个 <code>Person</code> 类和一个子类 <code>User</code>。在 <code>Person</code> 中定义的方法也成为了 <code>User</code> 的一部分。<br>这是非常简单的继承。你可能会好奇，是否有什么方法可以在一个类被其他类继承时收到通知呢？<br>是的，Ruby有一个名为 <code>inherited</code> 的钩子可以实现。我们再看看这个例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">self</span>.inherited(child_class)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;child_class&#125;</span> inherits <span class="subst">#&#123;<span class="variable language_">self</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name is Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &lt; <span class="title class_ inherited__">Person</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">puts User.new.name</span><br></pre></td></tr></table></figure>
<p>正如你所见，当 <code>Person</code> 类被其他子类继承时 <code>inherited</code> 类方法将会被调用。<br>运行以上代码结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User inherits Person</span><br><span class="line">My name is Person</span><br></pre></td></tr></table></figure>
<p>让我们看看 <code>Rails</code> 在它的代码中是如何使用 <code>inherited</code> 的。</p>
<h3 id="Rails中的-inherited"><a href="#Rails中的-inherited" class="headerlink" title="Rails中的 inherited"></a>Rails中的 <code>inherited</code></h3><p>Rails应用中有一个重要的类名为 <code>Application</code> ，定义中 <strong>config/application.rb</strong> 文件内。<br>这个类执行了许多不同的任务，如运行所有的Railties，引擎以及插件的初始化。<br>关于 <code>Application</code> 类的一个有趣的事件是，在同一个进程中不能运行两个实例。<br>如果我们尝试修改这个行为，Rails将会抛出一个异常。让我们来看看Rails是如何实现这个特性的。</p>
<p><code>Application</code> 类继承自 <code>Rails::Application</code>，它是在<a target="_blank" rel="noopener" href="https://github.com/rails/rails/blob/v3.2.21/railties/lib/rails/application.rb">这里</a>定义的。<br>在62行定义了 <code>inherited</code> 钩子，它会在我们的Rails应用 <code>Application</code> 类继承 <code>Rails::Application</code> 时被调用。<br><code>inherited</code> 钩子的代码如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> &lt;&lt; <span class="variable language_">self</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">inherited</span>(<span class="params">base</span>)</span><br><span class="line">    raise <span class="string">&quot;You cannot have more than one Rails::Application&quot;</span> <span class="keyword">if</span> Rails.application</span><br><span class="line">    <span class="variable language_">super</span></span><br><span class="line">    Rails.application = base.instance</span><br><span class="line">    Rails.application.add_lib_to_load_path!</span><br><span class="line">    ActiveSupport.run_load_hooks(<span class="symbol">:before_configuration</span>, base.instance)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>class &lt;&lt; self</code> 是Ruby中的另一个定义类方法的方式。在 <code>inherited</code> 中的第1行是检查 <code>Rails.application</code> 是否已存在。<br>如果存在则抛出异常。第一次运行这段代码时 <code>Rails.application</code> 会返回false然后调用 <code>super</code>。<br>在这里 <code>super</code> 即是 <code>Rails::Engine</code> 的 <code>inherited</code> 钩子，因为 <code>Rails::Application</code> 继承自 <code>Rails::Engine</code>。</p>
<p>在下一行，你会看到 <code>Rails.application</code> 被赋值为 <code>base.instance</code> 。其余就是设置Rails应用了。</p>
<p>这就是Rails如何巧妙地使用 <code>inherited</code> 钩子来实现我们的Rails <code>Application</code> 类的单实例。</p>
<h2 id="method-missing"><a href="#method-missing" class="headerlink" title="method_missing"></a>method_missing</h2><p><code>method_missing</code> 可能是Ruby中使用最广的钩子。在许多流行的Ruby框架/gem包/库中都有使用它。<br>当我们试图访问一个对象上不存在的方法时则会调用这个钩子方法。<br>让我们来看一个简单的例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name is Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">p = Person.new</span><br><span class="line"> </span><br><span class="line">puts p.name     <span class="comment"># =&gt; My name is Person </span></span><br><span class="line">puts p.address  <span class="comment"># =&gt; undefined method `address&#x27; for #&lt;Person:0x007fb730a2b450&gt; (NoMethodError)</span></span><br></pre></td></tr></table></figure>
<p>我们定义了一个简单的 <code>Person</code> 类， 它只有一个 <code>name</code> 方法。然后创建一个 <code>Person</code> 的实例对象，<br>并分别调用 <code>name</code> 和 <code>address</code>　两个方法。因为 <code>Person</code> 中定义了 <code>name</code>，因此这个运行没问题。<br>然而 <code>Person</code> 并没有定义 <code>address</code>，这将会抛出一个异常。<br><code>method_missing</code> 钩子可以优雅地捕捉到这些未定义的方法，避免此类异常。<br>让我们修改一下 <code>Person</code> 类：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">method_missing</span>(<span class="params">sym, *args</span>)</span><br><span class="line">     <span class="string">&quot;<span class="subst">#&#123;sym&#125;</span> not defined on <span class="subst">#&#123;<span class="variable language_">self</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">name</span></span><br><span class="line">    <span class="string">&quot;My name is Person&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">p = Person.new</span><br><span class="line"> </span><br><span class="line">puts p.name     <span class="comment"># =&gt; My name is Person</span></span><br><span class="line">puts p.address  <span class="comment"># =&gt; address not defined on #&lt;Person:0x007fb2bb022fe0&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>method_missing</code> 接收两个参数：被调用的方法名和传递给该方法的参数。<br>首先Ruby会寻找我们试图调用的方法，如果方法没找到则会寻找 <code>method_missing</code> 方法。<br>现在我们重载了 <code>Person</code> 中的 <code>method_missing</code>，因此Ruby将会调用它而不是抛出异常。</p>
<p>让我们来看看 <code>Rake</code> 是如何使用 <code>method_missing</code> 的。</p>
<h3 id="Rake中的-method-missing"><a href="#Rake中的-method-missing" class="headerlink" title="Rake中的 method_missing"></a>Rake中的 <code>method_missing</code></h3><p><code>Rake</code> 是Ruby中使用最广泛的gem包之一。<code>Rake</code> 使用 <code>method_missing</code> 来提供访问传递给Rake任务的参数。<br>首先创建一个简单的rake任务：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task <span class="symbol">:hello</span> <span class="keyword">do</span></span><br><span class="line">  puts <span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>如果你通过调用 <code>rake hello</code> 来执行这个任务，你会看到输出 <code>Hello</code>。<br>让我们扩展这个rake任务，以便接收一个参数（一个人名）并向他打招呼：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task <span class="symbol">:hello</span>, <span class="symbol">:name</span> <span class="keyword">do</span> |<span class="params">t, args</span>|</span><br><span class="line">  puts <span class="string">&quot;Hello <span class="subst">#&#123;args.name&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>t</code> 是任务名，<code>args</code> 保存了传递过来的参数。正如你所见，我们调用 <code>args.name</code> 来获取传递给 <code>hello</code> 任务的 <code>name</code> 参数。<br>运行该任务，并传递一个参数：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rake hello[<span class="string">&quot;Imran Latif&quot;</span>]</span><br><span class="line">=&gt; Hello Imran Latif</span><br></pre></td></tr></table></figure>
<p>让我们来看看 <code>Rake</code> 是如何使用 <code>method_missing</code> 为我们提供了传递给任务的参数的。</p>
<p>在上面任务中的 <code>args</code> 对象是一个 <code>Rake::TaskArguments</code> 实例，它是在<a target="_blank" rel="noopener" href="https://github.com/ruby/rake/blob/v10.4.2/lib/rake/task_arguments.rb">这里</a>所定义。<br>这个类负责管理传递给Rake任务的参数。查看 <code>Rake::TaskArguments</code> 的代码，你会发现并没有定义相关的方法将参数传给任务。<br>那么 <code>Rake</code> 是如何将参数提供给任务的呢？答案是 <code>Rake</code> 是使用了 <code>method_missing</code> 巧妙地实现了这个功能。<br>看看第64行 <code>method_missing</code> 的定义：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">method_missing</span>(<span class="params">sym, *args</span>)</span><br><span class="line">  lookup(sym.to_sym)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>在这个类中定义 <code>method_missing</code> 是为了保证能够访问到那些未定义的方法，而不是由Ruby抛出异常。<br>在 <code>method_missing</code> 中它调用了 <code>lookup</code> 方法：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">lookup</span>(<span class="params">name</span>)</span><br><span class="line">  <span class="keyword">if</span> <span class="variable">@hash</span>.has_key?(name)</span><br><span class="line">   <span class="variable">@hash</span>[name]</span><br><span class="line">  <span class="keyword">elsif</span> <span class="variable">@parent</span></span><br><span class="line">    <span class="variable">@parent</span>.lookup(name)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>method_missing</code> 调用 <code>lookup</code>，并将方法名以 <code>Symbol(符号)</code> 的形式传递给它。<br><code>lookup</code> 方法将会在 <code>@hash</code> 中进行查找，它是在 <code>Rake::TaskArguments</code> 的构造函数中创建的。<br>如果 <code>@hash</code> 中包含该参数则返回，如果在 <code>@hash</code> 中没有则 <code>Rake</code> 会尝试调用 <code>@parent</code> 的 <code>lookup</code>。<br>如果该参数没有找到，则什么都不返回。</p>
<p>这就是 <code>Rake</code> 如何巧妙地使用 <code>method_missing</code> 提供了访问传递给Rake任务的参数的。<br>感谢<a target="_blank" rel="noopener" href="https://twitter.com/jimweirich">Jim Weirich</a>编写了Rake。</p>
<h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><p>我们讨论了5个重要的Ruby钩子方法，探索了它们是如何工作的，以及一些流行的框架/gem包是如何使用它们来提供一些优雅的功能。<br>我希望你能喜欢这篇文章。请在评论中告诉我们你所喜欢的Ruby钩子，以及你使用它们所解决的问题。</p>
<p>原文地址： <a target="_blank" rel="noopener" href="http://www.sitepoint.com/rubys-important-hook-methods/">http://www.sitepoint.com/rubys-important-hook-methods/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84143.html" data-id="cl1hoxk0l007jdwoydad7f9h4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby/" rel="tag">Ruby</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-使用Unicorn部署rails应用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84142.html" class="article-date">
  <time datetime="2015-04-05T12:47:15.000Z" itemprop="datePublished">2015-04-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Ruby%E6%A0%8F%E7%9B%AE/">Ruby栏目</a>►<a class="article-category-link" href="/categories/Ruby%E6%A0%8F%E7%9B%AE/Web%E5%BC%80%E5%8F%91/">Web开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84142.html">使用Unicorn部署rails应用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>玩 rails 也有段时间了，最近研究下怎么部署一个 rails 应用。在几年前的话要部署 rails 应用是件很麻烦的事，<br>但是近几年出现了一些比较好的工具可以方便的进行 rails 部署。如： Unicorn、thin、Passenger等。</p>
<p>Unicorn 是一个 Rack 应用的HTTP服务器。之前玩 Python 的时候也有一个 Gunicorn ，使用它来部署 Python 的 Web 应用<br>也很方便，可以参考我之前的那篇文件 <a href="84138.html">《使用gunicorn部署Django》</a> 。</p>
<p>接下来简单分享下使用 Nginx + Unicorn 来部署 rails 的配置。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>首先安装 unicorn 包： <code>$ gem install unicorn</code></p>
<p>然后编译一下静态文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ RAILS_ENV=production rake assets:clean</span><br><span class="line">$ RAILS_ENV=production rake assets:precompile</span><br></pre></td></tr></table></figure>
<p>下载配置文件： <code>$ curl -o config/unicorn.rb https://raw.github.com/defunkt/unicorn/master/examples/unicorn.conf.rb</code></p>
<p>接着根据情况修改相关配置，如： working_directory、listen 等。<br>例如我的是需要同时监听网络端口和 sock 文件，那么我的 listen 设置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listen &quot;#&#123;root_path&#125;/tmp/sockets/unicorn.sock&quot;, :backlog =&gt; 64</span><br><span class="line">listen 8081, :tcp_nopush =&gt; true</span><br></pre></td></tr></table></figure>
<h2 id="配置-Nginx"><a href="#配置-Nginx" class="headerlink" title="配置 Nginx"></a>配置 Nginx</h2><p>然后配置 Nginx 的反向代理，以下是我的 Nginx 配置示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">upstream rails_server &#123;</span><br><span class="line">  server unix:/app_path/tmp/sockets/unicorn.sock fail_timeout=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">	server_name webserver localhost;</span><br><span class="line"></span><br><span class="line">	root /app_path/public;</span><br><span class="line"></span><br><span class="line">  try_files $uri $uri @unicorn;</span><br><span class="line"></span><br><span class="line">  location @unicorn &#123;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header Host $http_host;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_pass http://rails_server;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  location ~ /\.ht &#123;</span><br><span class="line">    deny  all;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>配置完成之后，最后启动服务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ bundle exec unicorn_rails -c config/unicorn.rb -D -E production</span><br><span class="line">$ sudo service nginx start</span><br></pre></td></tr></table></figure>
<p>然后再在浏览器中访问试试。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84142.html" data-id="cl1hoxk0l007idwoy5v3s7k99" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby/" rel="tag">Ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web%E5%BC%80%E5%8F%91/" rel="tag">Web开发</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Vagrant使用笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84141.html" class="article-date">
  <time datetime="2015-02-24T11:17:43.000Z" itemprop="datePublished">2015-02-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux%E6%A0%8F%E7%9B%AE/">Linux栏目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84141.html">Vagrant使用笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Vgrant是一个基于 Ruby 使用 Virtualbox 进行创建和部署虚拟化环境的工具。<br>类似的工具之前有使用过 Docker。就我个人而言这两款工具之间，Docker是轻量级的VM，<br>因此性能应该会比较好，但是只能在64位的系统下使用。<br>而 Vgrant 是使用 Virtualbox 进行虚拟化，因此性能上不及 Docker，<br>不过它可以在32/64位的 Linux、Windows 等系统上运行。</p>
<p>我觉得 Vgrant 比较适合用于在开发环境中使用，而 Docker 比较适合用于生产环境。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>首先安装 virtualbox，然后再安装 Vgrant。</p>
<p>1.通过源代码安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mitchellh/vagrant</span><br><span class="line">cd vagrant</span><br><span class="line">bundle install</span><br><span class="line">rake install</span><br></pre></td></tr></table></figure>
<p>2.通过安装包安装<br>根据情况选择下载对应的安装包： <a target="_blank" rel="noopener" href="http://www.vagrantup.com/downloads.html">http://www.vagrantup.com/downloads.html</a></p>
<p>注意：如果是 Windows 系统，可能还需要将 Vgrant 的路径添加到环境变量中，以便使用 vgrant 命令。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>Vagrant 的使用方法也很简单，基本如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 这里我先添加一个 ArchLinux 的镜像</span><br><span class="line">vagrant box add archlinux http://vagrant.srijn.net/archlinux-x64-2014-01-07.box</span><br><span class="line"># 进行初始化</span><br><span class="line">vagrant init archlinux</span><br><span class="line"># 运行虚拟机</span><br><span class="line">vagrant up</span><br><span class="line"># 如果需要进行ssh连接到虚拟机中进行一些操作，可以执行该命令</span><br><span class="line">vagrant ssh</span><br></pre></td></tr></table></figure>
<p>其他的一些命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 关闭虚拟机</span><br><span class="line">vagrant halt</span><br><span class="line"># 删除创建的虚拟机</span><br><span class="line">vagrant destroy</span><br></pre></td></tr></table></figure>
<p>vagrant的一些镜像： <a target="_blank" rel="noopener" href="http://www.vagrantbox.es/">http://www.vagrantbox.es/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84141.html" data-id="cl1hoxk0k007hdwoyg75bdve0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby/" rel="tag">Ruby</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Redis集群配置实例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84140.html" class="article-date">
  <time datetime="2015-01-14T10:11:36.000Z" itemprop="datePublished">2015-01-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84140.html">Redis集群配置实例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>通过配置 redis 的主从集群可将请求的负荷分散到多台服务器上。</p>
<p>redis 的集群配置比较简单，以下是一个例子。<br>假设有如下三台主机：</p>
<ul>
<li>172.17.0.11 (主)</li>
<li>172.17.0.12 (从)</li>
<li>172.17.0.13 (从)</li>
</ul>
<p>在从服务器上添加如下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof 172.17.0.11 6379</span><br></pre></td></tr></table></figure>
<p>如果主服务器设置了认证密码，那么还需要再添加一条配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth &lt;password&gt;</span><br></pre></td></tr></table></figure>
<p>然后分别启动三台服务器的 redis 服务即可。</p>
<p>接下来连接主服务器添加一些数据测试一下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h 172.17.0.11</span><br><span class="line">172.17.0.11:6379&gt; set foo1 bar1</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>然后再连接到从服务器查询结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h 172.17.0.12</span><br><span class="line">172.17.0.12:6379&gt; get foo1</span><br><span class="line">&quot;bar1&quot;</span><br></pre></td></tr></table></figure>
<p>这时发现数据已经同步过来了。</p>
<p>注意：从服务器默认是只读的。如果需要设置为可写，可将 <code>slave-read-only</code> 设置项的值设为 <code>no</code> 即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84140.html" data-id="cl1hoxk0k007gdwoy1yje0i5i" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Mongodb分片配置实例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84139.html" class="article-date">
  <time datetime="2014-12-29T08:52:37.000Z" itemprop="datePublished">2014-12-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84139.html">Mongodb分片配置实例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>数据分片即是从一个集合中选择一个片键(shard key)作为数据拆分的依据，原理与索引类似，然后将集合的数据拆分并保存到不同的服务器上。<br>以下通过一个例子来介绍一下Mongodb的分片配置。</p>
<p>有四台主机：</p>
<ul>
<li>172.17.0.6    (配置服务器)</li>
<li>172.17.0.7    (mongos)</li>
<li>172.17.0.8    (片服务器)</li>
<li>172.17.0.9    (片服务器)</li>
</ul>
<p>1.在 172.17.0.6 上启动 mongod 服务作为配置服务器；<br>修改配置，使其作为一个配置服务器，默认监听 27019 端口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configsvr = true</span><br></pre></td></tr></table></figure>
<p>启动服务 <code>$ service mongodb start</code></p>
<p>2.在 172.17.0.7 上启动 mongos 服务作为路由服务;<br>建立mongos进程。(可以有多台配置服务器)，用法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongos --configdb &lt;config server hostnames&gt;[,&lt;config server hostnames&gt;]</span><br></pre></td></tr></table></figure>
<p>例如： <code>$ mongos --configdb 172.17.0.6:27019</code></p>
<p>注意：在同一个分片集群中的每个 mongos 必须使用相同的 configDB 配置。</p>
<p>3.添加分片<br>一个片服务既可以是单个 mongod 实例，也可以是一个副本集。<br>1).先分别在 172.17.0.8 和 172.17.0.9 上启动片服务器，即就是一个普通的 mongod 服务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service mongodb start</span><br></pre></td></tr></table></figure>
<p>2).使用 mongo 客户端连接到 mongos 服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --host &lt;hostname of machine running mongos&gt; --port &lt;port mongos listens on&gt;</span><br></pre></td></tr></table></figure>
<p>如： <code>$ mongo --host 172.17.0.7 --port 27017</code></p>
<p>3).在 mongo 客户端上执行命令添加分片：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; use admin</span><br><span class="line">&gt; db.auth(&lt;user&gt;, &lt;pswd&gt;)</span><br><span class="line">&gt; sh.addShard(&quot;172.17.0.8:27017&quot;)</span><br><span class="line">&gt; sh.addShard(&quot;172.17.0.9:27017&quot;)</span><br></pre></td></tr></table></figure>
<p>4.切片数据<br>1).首先对数据库进行切片<br>使用 mongo 客户端连接到 mongos ，执行命令打开数据库的分片功能，用法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sh.enableSharding(&quot;&lt;database&gt;&quot;)</span><br></pre></td></tr></table></figure>
<p>例如要打开 mydb 数据库的分片功能： <code>&gt; sh.enableSharding(&quot;mydb&quot;)</code></p>
<p>2).然后对数据集合进行切片<br>命令用法如下：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sh.shardCollection(&quot;&lt;database&gt;.&lt;collection&gt;&quot;, shard-key-pattern)</span><br></pre></td></tr></table></figure>
<p><code>shard-key-pattern</code> 与索引的用法一样，例如，要对 mydb 数据库的 test 集合按照 <code>_id</code> 字段进行分片： <code>&gt; sh.shardCollection(&quot;mydb.test&quot;, &#123;&quot;_id&quot;: &quot;hashed&quot;&#125;)</code></p>
<p>接下来通过一个程序来测试一下，向数据库中添加10000条数据：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env ruby</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;mongo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  conn = <span class="title class_">Mongo::Connection</span>.new <span class="string">&#x27;172.17.0.7&#x27;</span></span><br><span class="line">  db = conn[<span class="string">&#x27;mydb&#x27;</span>]</span><br><span class="line"><span class="keyword">rescue</span> Exception=&gt;e</span><br><span class="line">  p e</span><br><span class="line">  exit <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">10000</span></span><br><span class="line">  d = &#123;<span class="string">&#x27;no&#x27;</span> =&gt; i&#125;</span><br><span class="line">  d = db[<span class="string">&#x27;test&#x27;</span>].insert(d)</span><br><span class="line">  i += <span class="number">1</span></span><br><span class="line">  puts d</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>然后分别查看 172.17.0.8 和 172.17.0.9 的状态：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">172.17.0.8:</span><br><span class="line">&gt; db.test.count()</span><br><span class="line">4952</span><br><span class="line"></span><br><span class="line">172.17.0.9:</span><br><span class="line">&gt; db.test.count()</span><br><span class="line">5048</span><br></pre></td></tr></table></figure>
<p>数据基本上是平均的分布在两台服务器上。</p>
<p>参考： <a target="_blank" rel="noopener" href="http://docs.mongodb.org/manual/tutorial/deploy-shard-cluster/">http://docs.mongodb.org/manual/tutorial/deploy-shard-cluster/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84139.html" data-id="cl1hoxk0k007fdwoy5z16hc4i" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-使用gunicorn部署Django" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84138.html" class="article-date">
  <time datetime="2014-12-13T13:03:27.000Z" itemprop="datePublished">2014-12-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>►<a class="article-category-link" href="/categories/Web%E5%BC%80%E5%8F%91/Python%E6%A0%8F%E7%9B%AE/">Python栏目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84138.html">使用gunicorn部署Django</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="http://gunicorn.org/">Gunicorn</a> 是 Python的 一个 WSGI HTTP服务器，根据它的介绍说是它来自于 Ruby 的 Unicorn。可以方便的部署 Python 的 Web 程序，而且本身支持多种 Python 的框架，如 Django、Paster等。</p>
<p>通过介绍来看貌似很不错的样子，只可惜我现在不玩 Python 了，于是就简单体验一下。</p>
<h2 id="简单应用"><a href="#简单应用" class="headerlink" title="简单应用"></a>简单应用</h2><p>首先是安装，这个可以直接使用 <code>pip</code> 来完成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install gunicorn</span><br></pre></td></tr></table></figure>
<p>然后再根据官方文档的介绍部署一个简单的例子试试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ cd examples</span><br><span class="line">$ cat test.py</span><br><span class="line"># -*- coding: utf-8 -</span><br><span class="line">#</span><br><span class="line"># This file is part of gunicorn released under the MIT license.</span><br><span class="line"># See the NOTICE for more information.</span><br><span class="line"></span><br><span class="line">def app(environ, start_response):</span><br><span class="line">    &quot;&quot;&quot;Simplest possible application object&quot;&quot;&quot;</span><br><span class="line">    data = &#x27;Hello, World!\n&#x27;</span><br><span class="line">    status = &#x27;200 OK&#x27;</span><br><span class="line">    response_headers = [</span><br><span class="line">        (&#x27;Content-type&#x27;,&#x27;text/plain&#x27;),</span><br><span class="line">        (&#x27;Content-Length&#x27;, str(len(data)))</span><br><span class="line">    ]</span><br><span class="line">    start_response(status, response_headers)</span><br><span class="line">    return iter([data])</span><br><span class="line"></span><br><span class="line">$ gunicorn -b 0.0.0.0:8000 --workers=2 test:app</span><br></pre></td></tr></table></figure>
<p>好的，现在程序运行起来了，可以访问 <a target="_blank" rel="noopener" href="http://localhost:8000">http://localhost:8000</a> 看下效果。</p>
<p>gunicorn 也可以通过配置文件来设置一些内容， 一个配置文件是一个 python 脚本，格式类似 <code>.ini</code> 。通过 <code>-c</code> 参数指定要使用的配置文件。如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># config.ini</span><br><span class="line">bind = [&quot;0.0.0.0:8000&quot;, &quot;unix:///tmp/gunicorn.sock&quot;]</span><br><span class="line">workers = 3 </span><br></pre></td></tr></table></figure>
<p>gunicorn 还能与 Django 和 Paster 应用集成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gunicorn --env DJANGO_SETTINGS_MODULE=myproject.settings myproject.wsgi:application</span><br><span class="line">$ gunicorn --paste development.ini -b :8080 --chdir /path/to/project</span><br></pre></td></tr></table></figure>
<h2 id="与-Nginx-部署"><a href="#与-Nginx-部署" class="headerlink" title="与 Nginx 部署"></a>与 Nginx 部署</h2><p>gunicorn 本身也是一个 WSGI 应用，可以与 Nginx 一同使用。<br>以下是 Nginx + Gunicorn 部署 Django 的事例， Nginx 配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># nginx.conf</span><br><span class="line">http &#123;</span><br><span class="line">    include mime.types;</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line">    access_log /tmp/nginx.access.log combined;</span><br><span class="line">    sendfile on;</span><br><span class="line"></span><br><span class="line">    upstream app_server &#123;</span><br><span class="line">        server unix:/tmp/gunicorn.sock fail_timeout=0;</span><br><span class="line">        # For a TCP configuration:</span><br><span class="line">        # server 192.168.0.7:8000 fail_timeout=0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80 default;</span><br><span class="line">        client_max_body_size 4G;</span><br><span class="line">        server_name _;</span><br><span class="line"></span><br><span class="line">        keepalive_timeout 5;</span><br><span class="line"></span><br><span class="line">        # path for static files</span><br><span class="line">        root /path/to/app/current/public;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            # checks for static file, if not found proxy to app</span><br><span class="line">            try_files $uri @proxy_to_app;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location @proxy_to_app &#123;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_set_header Host $http_host;</span><br><span class="line">            proxy_redirect off;</span><br><span class="line"></span><br><span class="line">            proxy_pass   http://app_server;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /500.html;</span><br><span class="line">        location = /500.html &#123;</span><br><span class="line">            root /path/to/app/current/public;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Gunicorn 的配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># gunicorn.ini</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">bind = [&quot;0.0.0.0:8000&quot;, &quot;unix:///tmp/gunicorn.sock&quot;]</span><br><span class="line">workers = 3</span><br><span class="line">chdir = os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">raw_env = [&quot;DJANGO_SETTINGS_MODULE=app.settings&quot;]</span><br><span class="line">accesslog = &quot;/tmp/gunicorn-access.log&quot;</span><br><span class="line">errorlog = &quot;/tmp/gunicorn.log&quot;</span><br><span class="line">daemon = True</span><br><span class="line">pidfile = &quot;/tmp/gunicorn.pid&quot;</span><br></pre></td></tr></table></figure>
<p>运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gunicorn -c gunicorn.ini myproject.wsgi:application</span><br><span class="line">$ service nginx start</span><br></pre></td></tr></table></figure>
<h2 id="其他内容"><a href="#其他内容" class="headerlink" title="其他内容"></a>其他内容</h2><p>与 WSGI 应用一样，如果之后配置有改动可以向 gunicorn 服务进程发送 <code>HUP</code> 信号让其重新加载配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kill -s HUP &lt;pid&gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84138.html" data-id="cl1hoxk0k007edwoybyyrajlh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Mongodb集群配置实例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84137.html" class="article-date">
  <time datetime="2014-12-10T12:33:02.000Z" itemprop="datePublished">2014-12-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84137.html">Mongodb集群配置实例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Mongodb的集群有两种，一个是主从复制，另一种是副本集。</p>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>根据 Mongodb 的官方文档说明，在生产环境中建议使用副本集代替主从复制。 <a target="_blank" rel="noopener" href="http://docs.mongodb.org/manual/core/master-slave/">http://docs.mongodb.org/manual/core/master-slave/</a></p>
<p>不过对于主从复制还是可以了解一下。假设有如下三台主机：</p>
<ul>
<li>172.17.0.4    (主)</li>
<li>172.17.0.5    (从)</li>
<li>172.17.0.6    (从)</li>
</ul>
<p>要进行主从复制的配置，首先修改主服务器的配置信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">master = true         # 以主服务器模式启动</span><br><span class="line">bind_ip = 0.0.0.0</span><br></pre></td></tr></table></figure>
<p>然后修改另两台从服务器配置信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">slave = true</span><br><span class="line">source = 172.17.0.4</span><br><span class="line">bind_ip = 0.0.0.0</span><br></pre></td></tr></table></figure>
<p>最后启动三台主机上的 Mongodb 服务，再通过一个简单的程序来测试一下。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env ruby</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;mongo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  conn = <span class="title class_">Mongo::Connection</span>.new <span class="string">&#x27;172.17.0.4&#x27;</span></span><br><span class="line">  db = conn[<span class="string">&#x27;test&#x27;</span>]</span><br><span class="line"><span class="keyword">rescue</span> Exception=&gt;e</span><br><span class="line">  p e</span><br><span class="line">  exit <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">100</span></span><br><span class="line">  d = &#123;<span class="string">&#x27;no&#x27;</span> =&gt; i&#125;</span><br><span class="line">  d = db[<span class="string">&#x27;data&#x27;</span>].insert(d)</span><br><span class="line">  i += <span class="number">1</span></span><br><span class="line">  puts d</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>执行该脚本，向 <code>172.17.0.4</code> 主机的 Mongodb 中插入一些数据。然后发现数据被同步到了另外两台主机上。</p>
<p>主从之间安全认证：<br>如果启动了 <code>auth</code> 项，那么主从之间的认证需要使用 <code>keyFile</code> 选项。</p>
<p>执行如下命令生成 key 文件，并设置为只有 mongodb 的进程用户可读写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ openssl rand -base64 741 &gt; /path/mongodb_keyFile</span><br><span class="line">$ chmow 600 /path/mongodb_keyFile</span><br><span class="line">$ chown mongodb:mongodb /path/mongodb_keyFile</span><br></pre></td></tr></table></figure>
<p>将该文件复制到这三台主机中，然后分别修改主从的配置信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keyFile = /path/mongodb_keyFile</span><br></pre></td></tr></table></figure>
<h2 id="副本集"><a href="#副本集" class="headerlink" title="副本集"></a>副本集</h2><p>同样的对于这三台主机，我们重新修改配置设置为副本集的形式。</p>
<ul>
<li>172.17.0.4</li>
<li>172.17.0.5</li>
<li>172.17.0.6</li>
</ul>
<p>首先修改配置文件，设置副本集的名字。<br>注意：副本集中所有主机设置的名字需要一样。这里我们设为 <code>myrepl0</code>。<br>注意：设置副本集之前各个 mongodb 的数据目录必须都为空。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replSet = myrepl0</span><br></pre></td></tr></table></figure>
<p>接着启动所有 mongodb 服务，然后对副本集进行初始化。<br>连接任意一台 mongodb 服务，执行如下操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; rs.initiate(&#123;&#x27;_id&#x27;: &#x27;myrepl0&#x27;, &#x27;members&#x27;: [</span><br><span class="line">    &#123;&#x27;_id&#x27;: 1, &#x27;host&#x27;: &#x27;172.17.0.4:27017&#x27;&#125;,</span><br><span class="line">    &#123;&#x27;_id&#x27;: 2, &#x27;host&#x27;: &#x27;172.17.0.7:27017&#x27;&#125;,</span><br><span class="line">    &#123;&#x27;_id&#x27;: 3, &#x27;host&#x27;: &#x27;172.17.0.8:27017&#x27;&#125;</span><br><span class="line">]&#125;)</span><br></pre></td></tr></table></figure>
<p>现在副本集的初始化已完成，可以通过如下命令查看状态：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; rs.status()</span><br></pre></td></tr></table></figure>
<p>在运行过程中可以随时添加或移除一个节点，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rs.add(&quot;172.17.0.8:27017&quot;)</span><br><span class="line">rs.remove(&quot;172.17.0.8:27017&quot;)</span><br></pre></td></tr></table></figure>
<p>可以再通过上面的程序添加一些数据。然后再连接到任意一台主机进行查询，看看数据是否已同步。</p>
<p>详细内容可参考文档： <a target="_blank" rel="noopener" href="http://docs.mongodb.org/manual/core/replication/">http://docs.mongodb.org/manual/core/replication/</a></p>
<p>安全认证：</p>
<p>1.禁用 auth 选项和 replSet 选项再运行 mongodb</p>
<p>2.连接到该 mongodb 服务并创建用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt; db.addUser(&#x27;root&#x27;,&#x27;root&#x27;)</span><br><span class="line">&#123;</span><br><span class="line">        &quot;user&quot; : &quot;root&quot;,</span><br><span class="line">        &quot;readOnly&quot; : false,</span><br><span class="line">        &quot;pwd&quot; : &quot;2a8025f0885adad5a8ce0044070032b3&quot;,</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;54745351f79804bd44b596fb&quot;)</span><br><span class="line">&#125;</span><br><span class="line">&gt; </span><br></pre></td></tr></table></figure>
<p>3.重新以 auth、keyFile 和 replSet 模式启动 mongodb</p>
<p>4.连接到刚刚创建用户的 mongodb 服务</p>
<p>5.跟之前的步骤一样，配置副本集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; rs.initiate(&#123;&#x27;_id&#x27;: &#x27;myrepl0&#x27;, &#x27;members&#x27;: [</span><br><span class="line">    &#123;&#x27;_id&#x27;: 1, &#x27;host&#x27;: &#x27;172.17.0.4:27017&#x27;&#125;,</span><br><span class="line">    &#123;&#x27;_id&#x27;: 2, &#x27;host&#x27;: &#x27;172.17.0.7:27017&#x27;&#125;,</span><br><span class="line">    &#123;&#x27;_id&#x27;: 3, &#x27;host&#x27;: &#x27;172.17.0.8:27017&#x27;&#125;</span><br><span class="line">]&#125;)</span><br></pre></td></tr></table></figure>
<p>参考： <a target="_blank" rel="noopener" href="http://docs.mongodb.org/manual/tutorial/deploy-replica-set-with-auth/">http://docs.mongodb.org/manual/tutorial/deploy-replica-set-with-auth/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84137.html" data-id="cl1hoxk0k007ddwoy5r393l0o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-使用VIM进行PHP远程调试" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84136.html" class="article-date">
  <time datetime="2014-11-19T12:00:30.000Z" itemprop="datePublished">2014-11-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/">资源分享</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84136.html">使用VIM进行PHP远程调试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在写 PHP 时感觉它的调试不是很方便，基本都是用的 <code>var_dump</code> 将信息输出到页面上进行调试。最终实现是受不了这种方式，就找了一下看看有没有什么简便的方法。<br>于是就找到了 <code>vdebug</code> 这个 vim 插件，使用它可以方便的进行远程调试。</p>
<p>根据 <code>vdebug</code> 的介绍，说是它可以用来调试基于 DBGP 协议的程序，比如： PHP、Python、Ruby等。<br>可能只是 DBGP 协议在 PHP 中用得比较多吧，因此看到的大部分介绍都是说的 PHP 调试。<br>关于 DBGP 协议的详细介绍可参考： <a target="_blank" rel="noopener" href="http://xdebug.org/docs-dbgp.php">http://xdebug.org/docs-dbgp.php</a></p>
<p><strong>使用方法：</strong></p>
<p>首先是在 vim 中安装这个插件，下载地址： <a target="_blank" rel="noopener" href="https://github.com/joonty/vdebug">https://github.com/joonty/vdebug</a></p>
<p>由于它的配置信息都写死在代码中的，因此我就 fork 了一份进行自定义的修改，如快捷键设置、远程主机名和端口号。</p>
<p>然后是安装 PHP 的 Xdebug 扩展，并配置一些参数信息。在 <code>php.ini</code> 配置文件中添加如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xdebug.remote_enable=on</span><br><span class="line">xdebug.remote_handler=dbgp</span><br><span class="line">xdebug.remote_host=127.0.0.1</span><br><span class="line">xdebug.remote_port=9010</span><br></pre></td></tr></table></figure>
<p>注意：这里的主机名和端口号要与 <code>vdebug</code> 中的一致。</p>
<p>接着使用 vim 打开一个 php 文件，按 <code>&lt;F5&gt;</code> 键启动该插件进行调试。然后在浏览器中访问该 php 程序，<br>并加上 <code>XDEBUG_SESSION_START=1</code> 参数，如： <a target="_blank" rel="noopener" href="http://127.0.0.1/test.php?XDEBUG_SESSION_START=1">http://127.0.0.1/test.php?XDEBUG_SESSION_START=1</a></p>
<p>现在就可以在 vim 中对 php 程序进行单步调试了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84136.html" data-id="cl1hoxk0j007cdwoyb5zf1jod" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/" rel="tag">vim</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Nginx+uwsgi+Django环境配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84135.html" class="article-date">
  <time datetime="2014-11-11T13:02:17.000Z" itemprop="datePublished">2014-11-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a>►<a class="article-category-link" href="/categories/Web%E5%BC%80%E5%8F%91/Python%E6%A0%8F%E7%9B%AE/">Python栏目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84135.html">Nginx + uwsgi + Django环境配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有段时间没折腾 Django 了，又有点生疏了。最近又部署了一下 Django 的环境，顺便作个笔记以便之后查阅。</p>
<p>首先安装 nginx、uwsgi 以及 uwsgi 的 python 插件。</p>
<p>然后新建一个 uwsgi 的配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line">uid = www-data</span><br><span class="line">chdir = /repo/django-blog</span><br><span class="line">virtualenv = /repo/django-blog/pyenv2.7/    # python虚拟环境，没有可以不设置</span><br><span class="line">env = DJANGO_SETTINGS_MODULE=blog.settings</span><br><span class="line">module = blog.wsgi:application</span><br><span class="line">master = true</span><br><span class="line">plugin = python</span><br><span class="line">pidfile = /tmp/blog-master.pid</span><br><span class="line">socket = /tmp/blog.sock</span><br><span class="line">enable-threads = true</span><br><span class="line">post-buffering=1024000</span><br><span class="line">post-buffering-busize=655360</span><br></pre></td></tr></table></figure>
<p>这里我们的 Django 项目代码位于 <code>/repo/django-blog</code> ，项目的配置文件为： <code>blog/settings.py</code> 。</p>
<p><code>virtualenv</code> 项表明我们使用的是 <code>virtualenv</code> 环境，也可以直接系统的 python 环境。不过还是建议使用虚拟环境，以免软件包版本冲突。</p>
<p><code>post-buffering</code> 和 <code>post-buffering-busize</code> 这两项设置了 POST 请求时缓冲区的大小，该值可根据自己的情况进行调整。之前遇到过由于缓冲区不足导致返回的内容不完整。</p>
<p>再安装对应的 python 依赖包，然后运行 uwsgi 服务。</p>
<p>接着修改 nginx 的配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name localhost;</span><br><span class="line"></span><br><span class="line">  client_max_body_size 50m;</span><br><span class="line"></span><br><span class="line">  access_log /var/log/nginx/blog-access.log;</span><br><span class="line">  error_log /var/log/nginx/blog-error.log;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    uwsgi_pass unix:///tmp/blog.sock;</span><br><span class="line">    include uwsgi_params;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /static &#123;</span><br><span class="line">    alias /repo/django-blog/static/;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个内容比较简单， <code>client_max_body_size</code> 项是用于设置 http 请求的 body 最大大小。如果你的程序中有文件上传的，那么就需要根据自身情况来设置允许上传文件的最大值。</p>
<p>最后再启动 nginx 服务。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84135.html" data-id="cl1hoxk0j007bdwoy2sfphn02" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-配置rails的vim环境" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/84134.html" class="article-date">
  <time datetime="2014-11-08T08:02:58.000Z" itemprop="datePublished">2014-11-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/">资源分享</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/84134.html">配置rails的vim环境</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天分享一款 vim 的 rails 插件： <code>vim-rails</code> 。</p>
<p>使用该插件可以方便的在多个文件之间进行跳转。如在控制器的 action 上按 <code>gf</code> 键会自动跳转到对应的视图文件。</p>
<p>也可以使用 <code>:Emodel</code>, <code>:Eview</code>, <code>:Econtroller</code>, 命令在模型、视图以及控制器之间进行跳转。</p>
<p>该插件还提供了对 rails 的一些关键字的高亮。</p>
<p>并且还可以直接在 vim 中使用 <code>:Rails</code> 命令。</p>
<p>同时还有 <code>vim-rake</code> 和 <code>vim-bundler</code> 两个插件提供了 <code>rake</code> 和 <code>bundle</code> 的 vim 命令接口。</p>
<p>如果是用的 vundle 进行插件管理的话，可以直接在 .vimrc 配置中添加如下内容即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bundle &#x27;tpope/vim-rails&#x27;</span><br><span class="line">Bundle &#x27;tpope/vim-rake&#x27;</span><br><span class="line">Bundle &#x27;tpope/vim-bundler&#x27;</span><br></pre></td></tr></table></figure>
<p>然后再在vim执行命令 :BundleInstall 即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.xefan.com/archives/84134.html" data-id="cl1hoxk0j007adwoy09nf6xn7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/" rel="tag">vim</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/4/">&amp;laquo;Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><a class="extend next" rel="next" href="/page/6/">Next&amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux%E6%A0%8F%E7%9B%AE/">Linux栏目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python%E6%A0%8F%E7%9B%AE/">Python栏目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby%E6%A0%8F%E7%9B%AE/">Ruby栏目</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby%E6%A0%8F%E7%9B%AE/Web%E5%BC%80%E5%8F%91/">Web开发</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%BC%80%E5%8F%91/Python%E6%A0%8F%E7%9B%AE/">Python栏目</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/">前端相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%A0%8F%E7%9B%AE/">嵌入式栏目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">开源软件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/">数据结构和算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/">编程开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97/">网络日志</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/">资源分享</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARM/" rel="tag">ARM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Arch/" rel="tag">Arch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dreamweaver/" rel="tag">Dreamweaver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fedora/" rel="tag">Fedora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flash/" rel="tag">Flash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GObject/" rel="tag">GObject</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gentoo/" rel="tag">Gentoo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hash/" rel="tag">Hash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/" rel="tag">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PS/" rel="tag">PS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt/" rel="tag">Qt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspberry-pi/" rel="tag">Raspberry pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby/" rel="tag">Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrapy/" rel="tag">Scrapy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TQ2440/" rel="tag">TQ2440</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/USB/" rel="tag">USB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VirtualBox/" rel="tag">VirtualBox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web%E5%BC%80%E5%8F%91/" rel="tag">Web开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WordPress/" rel="tag">WordPress</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xcode/" rel="tag">Xcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/access/" rel="tag">access</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adobe/" rel="tag">adobe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ajax/" rel="tag">ajax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/" rel="tag">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/" rel="tag">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp/" rel="tag">asp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/firefox/" rel="tag">firefox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftp/" rel="tag">ftp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcc/" rel="tag">gcc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grub/" rel="tag">grub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gtk/" rel="tag">gtk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gulp/" rel="tag">gulp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ibus/" rel="tag">ibus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pygame/" rel="tag">pygame</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/" rel="tag">ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vmware/" rel="tag">vmware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/w3m/" rel="tag">w3m</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/" rel="tag">xml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%8D%E8%B4%B9/" rel="tag">免费</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E6%A0%B8/" rel="tag">内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/" rel="tag">匹配算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag">嵌入式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/" rel="tag">开源软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" rel="tag">排序算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E7%A9%BA%E9%97%B4/" rel="tag">文件空间</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A0%E7%BA%BF%E7%BD%91/" rel="tag">无线网</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">树莓派</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E5%BC%8F/" rel="tag">正则式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%A8%E5%86%8C%E6%9C%BA/" rel="tag">注册机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag">游戏</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E8%84%91%E6%8A%80%E5%B7%A7/" rel="tag">电脑技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A9%BA%E9%97%B4/" rel="tag">空间</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%A2%E6%97%97/" rel="tag">红旗</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E5%85%B8%E8%AF%AD%E5%BD%95/" rel="tag">经典语录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97/" rel="tag">网络日志</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BF%BB%E8%AF%91/" rel="tag">翻译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B/" rel="tag">视频教程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/" rel="tag">资源分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ARM/" style="font-size: 13.68px;">ARM</a> <a href="/tags/Android/" style="font-size: 10.53px;">Android</a> <a href="/tags/Arch/" style="font-size: 13.16px;">Arch</a> <a href="/tags/C/" style="font-size: 15.79px;">C</a> <a href="/tags/Django/" style="font-size: 11.05px;">Django</a> <a href="/tags/Docker/" style="font-size: 11.05px;">Docker</a> <a href="/tags/Dreamweaver/" style="font-size: 10px;">Dreamweaver</a> <a href="/tags/Fedora/" style="font-size: 10.53px;">Fedora</a> <a href="/tags/Flash/" style="font-size: 10px;">Flash</a> <a href="/tags/GObject/" style="font-size: 12.63px;">GObject</a> <a href="/tags/Gentoo/" style="font-size: 10.53px;">Gentoo</a> <a href="/tags/Hash/" style="font-size: 10px;">Hash</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Mac/" style="font-size: 10.53px;">Mac</a> <a href="/tags/PS/" style="font-size: 12.63px;">PS</a> <a href="/tags/Qt/" style="font-size: 10.53px;">Qt</a> <a href="/tags/Raspberry-pi/" style="font-size: 10px;">Raspberry pi</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Ruby/" style="font-size: 18.95px;">Ruby</a> <a href="/tags/Scrapy/" style="font-size: 11.05px;">Scrapy</a> <a href="/tags/TQ2440/" style="font-size: 12.11px;">TQ2440</a> <a href="/tags/USB/" style="font-size: 11.05px;">USB</a> <a href="/tags/VirtualBox/" style="font-size: 11.05px;">VirtualBox</a> <a href="/tags/Web%E5%BC%80%E5%8F%91/" style="font-size: 16.84px;">Web开发</a> <a href="/tags/WordPress/" style="font-size: 10px;">WordPress</a> <a href="/tags/Xcode/" style="font-size: 10px;">Xcode</a> <a href="/tags/access/" style="font-size: 12.63px;">access</a> <a href="/tags/adobe/" style="font-size: 10px;">adobe</a> <a href="/tags/ajax/" style="font-size: 11.05px;">ajax</a> <a href="/tags/angular/" style="font-size: 13.16px;">angular</a> <a href="/tags/apache/" style="font-size: 10px;">apache</a> <a href="/tags/asp/" style="font-size: 13.16px;">asp</a> <a href="/tags/css/" style="font-size: 10.53px;">css</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/firefox/" style="font-size: 11.05px;">firefox</a> <a href="/tags/ftp/" style="font-size: 10px;">ftp</a> <a href="/tags/gcc/" style="font-size: 12.63px;">gcc</a> <a href="/tags/git/" style="font-size: 13.16px;">git</a> <a href="/tags/grub/" style="font-size: 10px;">grub</a> <a href="/tags/gtk/" style="font-size: 17.89px;">gtk</a> <a href="/tags/gulp/" style="font-size: 10px;">gulp</a> <a href="/tags/ibus/" style="font-size: 10px;">ibus</a> <a href="/tags/js/" style="font-size: 16.32px;">js</a> <a href="/tags/k8s/" style="font-size: 10.53px;">k8s</a> <a href="/tags/mongodb/" style="font-size: 15.26px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 11.58px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/node/" style="font-size: 10.53px;">node</a> <a href="/tags/php/" style="font-size: 14.74px;">php</a> <a href="/tags/pygame/" style="font-size: 15.26px;">pygame</a> <a href="/tags/python/" style="font-size: 19.47px;">python</a> <a href="/tags/react/" style="font-size: 12.63px;">react</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/ruby/" style="font-size: 10px;">ruby</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/typescript/" style="font-size: 10px;">typescript</a> <a href="/tags/ubuntu/" style="font-size: 13.16px;">ubuntu</a> <a href="/tags/vim/" style="font-size: 18.42px;">vim</a> <a href="/tags/vmware/" style="font-size: 10px;">vmware</a> <a href="/tags/w3m/" style="font-size: 10px;">w3m</a> <a href="/tags/windows/" style="font-size: 13.16px;">windows</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a> <a href="/tags/%E5%85%8D%E8%B4%B9/" style="font-size: 10px;">免费</a> <a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 10px;">内核</a> <a href="/tags/%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/" style="font-size: 12.63px;">匹配算法</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 10.53px;">单片机</a> <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 10px;">嵌入式</a> <a href="/tags/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/" style="font-size: 14.21px;">开源软件</a> <a href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" style="font-size: 14.21px;">排序算法</a> <a href="/tags/%E6%96%87%E4%BB%B6%E7%A9%BA%E9%97%B4/" style="font-size: 10px;">文件空间</a> <a href="/tags/%E6%97%A0%E7%BA%BF%E7%BD%91/" style="font-size: 10px;">无线网</a> <a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 10px;">树莓派</a> <a href="/tags/%E6%AD%A3%E5%88%99%E5%BC%8F/" style="font-size: 10px;">正则式</a> <a href="/tags/%E6%B3%A8%E5%86%8C%E6%9C%BA/" style="font-size: 10.53px;">注册机</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 14.74px;">游戏</a> <a href="/tags/%E7%94%B5%E8%84%91%E6%8A%80%E5%B7%A7/" style="font-size: 14.21px;">电脑技巧</a> <a href="/tags/%E7%A9%BA%E9%97%B4/" style="font-size: 10px;">空间</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 17.37px;">算法</a> <a href="/tags/%E7%BA%A2%E6%97%97/" style="font-size: 10px;">红旗</a> <a href="/tags/%E7%BB%8F%E5%85%B8%E8%AF%AD%E5%BD%95/" style="font-size: 10px;">经典语录</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97/" style="font-size: 13.16px;">网络日志</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 18.42px;">翻译</a> <a href="/tags/%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B/" style="font-size: 14.74px;">视频教程</a> <a href="/tags/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/" style="font-size: 15.26px;">资源分享</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 10.53px;">转载</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">December 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">November 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">August 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">July 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/03/">March 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/02/">February 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/01/">January 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">December 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">October 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">August 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">July 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06/">June 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/05/">May 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/12/">December 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/11/">November 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/10/">October 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/09/">September 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/08/">August 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/07/">July 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/05/">May 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/12/">December 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/07/">July 2008</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/archives/84183.html">记录在docker中运行whenever遇到的问题</a>
          </li>
        
          <li>
            <a href="/archives/84182.html">Gitlab Runner 配置</a>
          </li>
        
          <li>
            <a href="/archives/84181.html">Github Runner 配置</a>
          </li>
        
          <li>
            <a href="/archives/84180.html">使用python编写帝国时代2修改器</a>
          </li>
        
          <li>
            <a href="/archives/84179.html">使用Vagrant和Docker搭建Kubernetes集群</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
  <h3 class="widget-title">Link</h3>
    <div class="widget">
      <ul id="category-list">
        <li><a target="_blank" title="我的Github" href="https://github.com/wusuopu">@Github</a></li>
        <li><a target="_blank" title="我的微博" href="http://www.weibo.com/u/1768691343">@Weibo</a></li>
        <li><a target="_blank" title="我的Twitter" href="https://twitter.com/longchangjin">@Twitter</a></li>
        <li><a target="_blank" title="我的豆瓣" href="http://www.douban.com/people/lchj/">@Douban</a></li>

        <li><a target="_blank" title="" href="http://gtk.awaysoft.com/">GTK+ 中文社区</a></li>
      </ul>
    </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 龍昌<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
<div style="display:none;"><script src="http://s94.cnzz.com/stat.php?id=1259846&web_id=1259846&show=pic" language="JavaScript"></script></div>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/gbook" class="mobile-nav-link">留言板</a>
  
</nav>
    


<script src="/js/jquery.min.js"></script>



  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>