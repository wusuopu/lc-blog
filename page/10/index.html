
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>龍昌博客</title>
  <meta name="author" content="龍昌">

  
  <meta name="description" content="变量 在这章的教程中我们将详细介绍变量。 变量是保存数据的地址。每个变量都有唯一的一个名字，变量命名存在着一些约定。变量保存着数据对象，更确切的说变量是对数据所在的计算机内存地址的引用。每一个对象都具有一定的数据类型，内置的类型或者自定义的类型。Ruby属于动态语言，与Java、 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.xefan.com/page/10/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="龍昌博客" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.useso.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">龍昌博客</a></h1>
  
    <h2>从Pythoneer转向Rubist</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.xefan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
 <li><a href="/about/">About</a></li>  <li><a href="/gbook/">留言板</a></li> 
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83905.html">[翻译]Ruby教程4——变量</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-05T00:00:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83905.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83905.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>变量</h1>


<p>在这章的教程中我们将详细介绍变量。  </p>


<p>变量是保存数据的地址。每个变量都有唯一的一个名字，变量命名存在着一些约定。变量保存着数据对象，更确切的说变量是对数据所在的计算机内存地址的引用。每一个对象都具有一定的数据类型，内置的类型或者自定义的类型。Ruby属于动态语言，与Java、C或者Pascal之类的强类型语言不同，动态语言不用为变量定义确切数据类型，而是解释器在分配变量时决定它的类型。在Ruby中程序运行过程变量可以包含不同类型的不同值。</p>


<blockquote>
<p>#!/usr/bin/ruby  </p>
<p>i = 5<br>
 puts i<br>
 i = 7<br>
 puts i  </p>
</blockquote>


<p>变量是可变的，与常量不同，在程序运行过程中它们可以保存不同的值。在上面这个例子中有一个名为<em>i</em>的变量，首先赋值为5,然后又改为7。</p>


<h2>命名约定</h2>


<p>与其他语言一样，Ruby对变量标识符也有些命名约定。<br>
Ruby是区分大小写的，这意味着<em>age</em>和<em>Age</em>是两个变量名。许多语言都是区分大小写的，但是BASIC例外。我们改变字符的大小写可以创建不同的变量，但是不推荐这种做法。</p>


<blockquote>
<p>#!/usr/bin/ruby  </p>
<p>i = 5<br>
 p i<br>
 I = 7<br>
 p I  </p>
</blockquote>


<p>这个例子定义了两个变量<em>I</em>和<em>i</em>，它们保存了不同的值。</p>


<p>./case.rb<br>
5<br>
7  </p>


<p>以上是<em>case.rb</em>脚本的输出结果。</p>


<hr>


<p>在Ruby中变量名可由字母数字和下划线组成。为了使解释器能简单的从字面上区分数字和变量，变量名不能以数字开头。变量名同样也不能以大写字母开头，在Ruby中以大写字母开头会被认为是常量。</p>


<blockquote>
<p>#!/usr/bin/ruby  </p>
<p>name = &#8220;Jane&#8221;<br>
 placeOfBirth = &#8220;Bratislava&#8221;<br>
 placeOfBirth = &#8220;Kosice&#8221;<br>
 favorite_season = &#8220;autumn&#8221;  </p>
<p>n1 = 2<br>
 n2 = 4<br>
 n3 = 7  </p>
<p>p name, placeOfBirth, favorite_season<br>
 p n1, n2, n3  </p>
</blockquote>


<p>在这个脚本中我们展示一些变量的命名。</p>


<hr>


<p>变量名应该是有意义的。好的编程习惯是给变量取个具有描述性的名字，使得程序更加可读。</p>


<pre><code>#!/usr/bin/ruby

name = "Jane"
place_of_birth = "Bratislava"
occupation = "student"

i = 5
while i &gt; 0 do
    puts name
    i -= 1
end
</code></pre>


<p>这个脚本展示三个具有描述性的变量名。对于程序员来说<em>place_of_birth</em>比其他的名字如<em>pob</em>更具有描述性。在循环的时候通常选择一个比较简单的变量名。</p>


<h2>印章(Sigils)</h2>


<p>变量标识符可以以一些特殊的印章（Sigils）符号开头。印章（Sigils）是附加在标识符上的符号。在Ruby中变量印章（Sigils）表示了变量的作用域范围。在Perl中它是表示数据的类型。Ruby的变量印章（Sigils）符号有<em>$</em>和<em>@</em>。  </p>


<blockquote>
<p>#!/usr/bin/ruby  </p>
<p>tree_name = &#8220;pine&#8221;<br>
 $car_name = &#8220;Peugeot&#8221;<br>
 @sea_name = &#8220;Black sea&#8221;<br>
 @@species = &#8220;Cat&#8221;  </p>
<p>p local_variables<br>
 p global_variables.include? :$car_name<br>
 p self.instance_variables<br>
 p Object.class_variables  </p>
</blockquote>


<p>我们定义了四个不同作用域范围的变量。作用域表示了该变量可以被引用到的范围。我们使用了内置的方法来决定变量的作用域。</p>


<blockquote>
<p>tree_name = &#8220;pine&#8221;  </p>
</blockquote>


<p>不包含印章（Sigils）符号的变量是一个局部变量。局部变量只在局部有效，如在方法、代码块、模块内。</p>


<blockquote>
<p>$car_name = &#8220;Peugeot&#8221;  </p>
</blockquote>


<p>全局变量以<em>$</em>符号开头。它们在所有地方都是有效的。在程序中不要滥用全局变量。</p>


<blockquote>
<p>@sea_name = &#8220;Black sea&#8221;  </p>
</blockquote>


<p>实例变量是以<em>@</em>符号开头。它只有在实例对象中才有效。</p>


<blockquote>
<p>@@species = &#8220;Cat&#8221;  </p>
</blockquote>


<p>最后我们定义了一个类变量。它在所有属于这个类的实例中都有效。</p>


<blockquote>
<p>p local_variables  </p>
</blockquote>


<p><em>local_variables</em>是保存了当前环境下所有定义的局部变量的数组。</p>


<blockquote>
<p>p global_variables.include? :$car_name  </p>
</blockquote>


<p>类似的，<em>global_variables</em>是保存的全部全局变量的数组。由于全局变量很多，我们就不将它们全部在终端上打印了。每次Ruby脚本启动时都会预定义一些变量。我们使用数组的<em>include?</em>方法来检查我们全局变量是否定义了。同时请注意我们引用变量是用的符号。（符号是以一个冒号开头）</p>


<blockquote>
<p>p self.instance_variables  </p>
</blockquote>


<p><em>self</em>伪变量指向了<em>instance_variables</em>方法的接收对象。这个例子中的接收对象是<em>main</em>，Ruby的顶级执行区域。</p>


<blockquote>
<p>p Object.class_variables </p>
</blockquote>


<p>最后我们获取所有的类变量数组。<em>main</em>是一个Object类的实例。</p>


<p>$ ./sigils.rb<br>
[:tree_name]<br>
true<br>
[:@sea_name]<br>
[:@@species]  </p>


<p>以上是这个例子的输出结果，我们看到了变量的符号名。</p>


<h2>局部变量</h2>


<p>局部变量是只在Ruby源代码的局部区域有效。这个区域也称为局部作用域。局部变量是在Ruby的模块、方法、类中定义。</p>


<pre><code>#!/usr/bin/ruby

def method1
   x = 5
   p x    
end

method1

p x
</code></pre>


<p>我们定义了一个名为<em>method1</em>的方法，它有一个变量。这个变量是局部变量。这意味着这个变量只在这个方法内有效。我们只能在这个方法名到<em>end</em>关键字之间访问<em>x</em>变量。</p>


<pre><code>def method1
   x = 5
   p x    
end
</code></pre>


<p>以上定义了一个<em>method1</em>方法。在方法内部创建了一个局部变量<em>x</em>，然后将它的值打印到终端。</p>


<blockquote>
<p>method1  </p>
</blockquote>


<p>方法被调用。</p>


<blockquote>
<p>p x  </p>
</blockquote>


<p>我们试图在方法外部访问这个局部变量。这将导致<em>NameError</em>错误，Ruby解释器找不到这个标识符。</p>


<p>$ ./locals.rb<br>
5<br>
./locals.rb:11:in <code>&lt;main&gt;': undefined local variable   
or method</code>x&#8217; for main:Object (NameError)  </p>


<p>以上是这个例子的输出结果。</p>


<hr>


<p>以下例子是对前一个例子的简单修改。</p>


<pre><code>#!/usr/bin/ruby

x = 5

def method1
    x = 10
    p x
end

method1

p x
</code></pre>


<p>我们定义了两个<em>x</em>变量。一个是在<em>method1</em>内部定义的，另一个是在外部定义的。他们是两个不同的局部变量，并不会相互冲突。</p>


<pre><code>x = 5
</code></pre>


<p>我们创建了一个局部变量，它的值为5。这个变量的局部作用范围是<em>main</em>区域。它在<em>method1</em>内部是无效的。  </p>


<pre><code>def method1  
    x = 10  
    p x  
end
</code></pre>


<p>在<em>method1</em>内部创建了一个新的<em>x</em>局部变量，它的值是10.它存在于<em>method1</em>方法内部，在<em>end</em>关键字之后就会失效。</p>


<p>$ ./locals2.rb<br>
10<br>
5  </p>


<p>以上是输出结果。</p>


<hr>


<p>如果一个方法接收了参数，那么就会创建与这些参数相对应的局部变量。  </p>


<pre><code>#!/usr/bin/ruby


def rectangle_area a, b
    puts local_variables
    return a * b
end

puts rectangle_area 5, 6
</code></pre>


<p>我们定义了一个方法，它接收两个值，然后返回这个矩形的面积。</p>


<pre><code>def rectangle_area a, b
    puts local_variables
    return a * b
end
</code></pre>


<p><em>rectangle_area</em>方法接收两个参数。它们是矩形的边长，然后我们计算它的面积。对应于标识符<em>a</em>、<em>b</em>的两个局部变量将自动创建了。我们调用<em>local_variables</em>方法查看方法内部的所有局部变量。</p>


<pre><code>puts rectangle_area 5, 6
</code></pre>


<p>这里我们给<em>rectangle_area</em>方法传了两个值。这两个值将会分配给在方法内部创建的两个局部变量。  </p>


<p>$ ./parameters.rb<br>
a<br>
b<br>
30  </p>


<p>输出了三个结果。前两个是<em>rectangle_area</em>方法内部的局部变量名。第三个是面积的计算结果。</p>


<hr>


<p>一个方法可以定义在另一个方法的内部。内嵌方法有它自己的局部变量。</p>


<pre><code>#!/usr/bin/ruby

def method1

    def method2

        def method3
            m5, m6 = 3
            puts "Level 3"
            puts local_variables
        end

        m3, m4 = 3
        puts "Level 2"
        puts local_variables
        method3    
    end

    m1, m2 = 3
    puts "Level 1"
    puts local_variables
    method2

end

method1
</code></pre>


<p>在这个Ruby脚本中我们创建了三个方法。<em>method2</em>和<em>method3</em>是内嵌方法。<em>method2</em>定义在<em>method1</em>内部，<em>method3</em>又定义在<em>method2</em>内部。每一个方法的局部变量仅在这个方法内是可访问的。</p>


<p>$ ./lms.rb<br>
Level 1<br>
m1<br>
m2<br>
Level 2<br>
m3<br>
m4<br>
Level 3<br>
m5<br>
m6  </p>


<p>从输出结果我们可以知道<em>method1</em>有两个局部变量<em>m1</em>和<em>m2</em>。内嵌方法<em>method2</em>的局部变量有<em>m3</em>、<em>m4</em>。最内部的方法<em>method3</em>的局部变量是<em>m5</em>、<em>m6</em>。  </p>


<hr>


<p>这一节的最后一个例子将展示一些局部作用域的示范。</p>


<pre><code>module ModuleM
    m1, m2 = 4

    puts "Inside module"
    puts local_variables        
end


def method1
    v, w = 3
    puts "Inside method"
    puts local_variables
end


class Some
    x, y = 2
    puts "Inside class"
    puts local_variables
end

method1

t1, t2 = 7

puts "Inside toplevel"
puts local_variables
</code></pre>


<p>在这个例子我们分别在模块、方法、类和顶级环境中创建局部变量。<em>local_variables</em>是内核模块的一个方法，用于获取当前的所有局部变量。</p>


<pre><code>module ModuleM
    m1, m2 = 4

    puts "Inside module"
    puts local_variables        
end
</code></pre>


<p>模块是一个方法和常量的集合。我们创建了两个局部变量<em>m1</em>和<em>m2</em>。</p>


<pre><code>def method1
    v, w = 3
    puts "Inside method"
    puts local_variables
end
</code></pre>


<p>在<em>method1</em>方法中创建了两个局部变量<em>v</em>、<em>w</em>。</p>


<pre><code>class Some
    x, y = 2
    puts "Inside class"
    puts local_variables
end
</code></pre>


<p>在<em>Some</em>类中创建了两个局部变量<em>x</em>、<em>y</em>。</p>


<pre><code>t1, t2 = 7
</code></pre>


<p>最后我们为Ruby顶级环境创建两个局部变量。</p>


<p>$ ./locals3.rb <br>
Inside module<br>
m1<br>
m2<br>
Inside class<br>
x<br>
y<br>
Inside method<br>
v<br>
w<br>
Inside toplevel<br>
t1<br>
t2  </p>


<p>输出结果展示了各个作用域的局部变量。</p>


<h2>全局变量</h2>


<p>全局变量可以在脚本的任何地方访问到。它们以<em>$</em>符号开头。<br>
全局变量可能会引起很多程序错误，因此不鼓励使用全局变量。除非有原因要使用，否则建议使用局部变量。</p>


<pre><code>#!/usr/bin/ruby

$gb = 6


module ModuleM        
    puts "Inside module"
    puts $gb
end


def method1
    puts "Inside method"
    puts $gb
end


class Some
    puts "Inside class"
    puts $gb
end

method1

puts "Inside toplevel"
puts $gb
puts global_variables.include? :$gb
</code></pre>


<p>在这个例子中我们创建了一个全局变量<em>$gb</em>。这个变量在模块、方法、类和顶级环境都可以访问。全部变量<em>$gb</em>是所有的实体中都是有效的。</p>


<pre><code>$gb = 6
</code></pre>


<p>创建全局变量<em>$gb</em>，它的值为6。</p>


<pre><code>module ModuleM        
    puts "Inside module"
    puts $gb
end
</code></pre>


<p>在一个模块定义中我们打印全局变量的值。</p>


<pre><code>def method1
    puts "Inside method"
    puts $gb
end
</code></pre>


<p>在一个方法定义中我们打印全局变量的值。</p>


<pre><code>class Some
    puts "Inside class"
    puts $gb
end
</code></pre>


<p>在一个类定义中我们打印全局变量的值。</p>


<pre><code>puts $gb
puts global_variables.include? :$gb
</code></pre>


<p>在顶级环境下打印全局变量的值，并检查这个变量是否为全局变量。</p>


<p>$ ./globals.rb<br>
Inside module<br>
6<br>
Inside class<br>
6<br>
Inside method<br>
6<br>
Inside toplevel<br>
6<br>
true  </p>


<p>这个例子的输出结果确认了全局变量可以任何地方访问到。  </p>


<hr>


<p>当一个Ruby脚本启动时，它会访问多个预定义的全局变量。这些全局变量不认为有害并且能帮助完成一些常见的任务。</p>


<pre><code>#!/usr/bin/ruby

p $LOAD_PATH
p $:
</code></pre>


<p>这个脚本显示了<em>$LOAD_PATH</em>这个全局变量。这个变量列出了<em>require</em>方法会搜索的所有目录。<em>$:</em>是<em>$LOAD_PATH</em>的缩写。<br>
更多的全局变量会在本章的变量预定义这节中介绍。</p>


<h2>实例变量、类变量</h2>


<p>在这节将简要的介绍下实例变量和类变量。它们将会在面向对象那一章详细介绍。<br>
实例变量是属于具体某个对象实例的变量。每个对象都有它自己的变量。实例变量以<em>@</em>符号开头。类变量属于特定某个类的。这个类所创建的对象实例共享这个类的类变量。类变量以<em>@@</em>符号开头。</p>


<pre><code>#!/usr/bin/ruby

class Being

    @@is = true

    def initialize nm
        @name = nm
    end

    def to_s
        "This is #{@name}"
    end

    def does_exist?
        @@is
    end
end

b1 = Being.new "Being 1"
b2 = Being.new "Being 2"
b3 = Being.new "Being 3"

p b1, b2, b3

p b1.does_exist?
p b2.does_exist?
p b3.does_exist?
</code></pre>


<p>我们创建一个自定义<em>Being</em>类。这个<em>Being</em>类有一个类变量和一个实例变量。</p>


<pre><code>class Being        
    @@is = true
</code></pre>


<p><em>@@is</em>是一个类变量。这个类变量被所有<em>Being</em>类的实例所共享。这个例子的逻辑是判断是不是<em>Being</em>。</p>


<pre><code>def initialize nm
    @name = nm
end
</code></pre>


<p><em>initialize</em>方法是构造函数。这个方法在对象被创建时调用。用于创建<em>@name</em>实例变量。  </p>


<pre><code>def to_s
    "This is #{@name}"
end
</code></pre>


<p>当这个对象作为打印方法如p或者puts的参数时<em>to_s method</em>方法会被调用。这个方法返回这个对象便于人类阅读的描述内容。  </p>


<pre><code>def does_exist?
    @@is
end
</code></pre>


<p><em>does_exist?</em>返回类变量。</p>


<pre><code>b1 = Being.new "Being 1"
b2 = Being.new "Being 2"
b3 = Being.new "Being 3"
</code></pre>


<p>创建Being类的三个实例对象。每个对象拥有不同的名字。这个名字存储在实例变量中，对于每个对象它是唯一的。名字将会在<em>to_s</em>方法中使用，用于返回一个对该对象的简短描述。</p>


<pre><code>p b1, b2, b3
</code></pre>


<p>这个方法将刚创建的三个对象作为参数，它将调用每个对象的<em>to_s</em>方法。  </p>


<pre><code>p b1.does_exist?
p b2.does_exist?
p b3.does_exist?
</code></pre>


<p>最后我们调用每个实例对象的<em>does_exist?</em>方法。这三个方法会输出相同的结果，因为这个方法返回的是类变量。</p>


<pre><code>$ ./icvars.rb
This is Being 1
This is Being 2
This is Being 3
true
true
true
</code></pre>


<p>以上是这个例子的输出结果。前三条信息是唯一的，因为这个字符串是存储在实例变量中的。<em>true</em>值是类变量，它被调用的三次。  </p>


<h2>环境&amp;命令行变量</h2>


<p>可以用<em>ENV</em>常量来访问环境变量。它是一个Ruby的hash对象。每个环境变量都是<em>ENV</em>这个hash对象的键值。  </p>


<p><em>ARGV</em>常量存储了命令行的参数值。它们是在脚本启动时传递的。<em>ARGV</em>是一个数组，参数以字符串存储。<em>S*</em>是<em>ARGV</em>的别名。</p>


<p><em>ENV</em>和<em>ARGV</em>都是全局常量。</p>


<pre><code>#!/usr/bin/ruby

ARGV.each do |a|
  puts "Argument: #{a}"
end
</code></pre>


<p>这个脚本我们通过循环遍历打印了<em>ARGV</em>的每个值。</p>


<p>$ ./commandline.rb 1 2 3<br>
Argument: 1<br>
Argument: 2<br>
Argument: 3  </p>


<p>我们给了三个命令行参数。它们在终端上各打印了一行。</p>


<hr>


<p>接下来的例子介绍了处理环境变量。</p>


<pre><code>#!/usr/bin/ruby

puts ENV['SHELL']
puts ENV['LANG']
puts ENV['TERM']
</code></pre>


<p>这个脚本在终端上打印了三个环境变量的值。这些变量值的内容依赖于我们操作系统的系统设置。 </p>


<p>$ ./environment.rb<br>
/bin/bash<br>
en_US.utf8<br>
xterm  </p>


<p>以上是一个输出例子。</p>


<h2>伪变量</h2>


<p>在Ruby中有一些变量被称作伪变量。它们不同于常规的变量，不能给它们设置值。<br>
<em>self</em>是当前方法的接收者。<em>nil</em>是<em>NilClass</em>的唯一实例，它代表值不存在。<em>true</em>是<em>TrueClass</em>的唯一实例，它代表布尔真。<em>flase</em>是<em>FalseClass</em>是唯一实例，它代表布尔假。<br>
<em>true</em>和<em>false</em>是布尔数据类型。从另一个角度来看他们是特殊的类实例，这是因为在Ruby中一切皆对象。</p>


<pre><code>#!/usr/bin/ruby

p self
p nil
p true
p false

p self.class
p nil.class
p true.class
p false.class
</code></pre>


<p>这是一个伪变量的例子。我们打印所有的伪变量，然后再看它们的类名。  </p>


<pre><code>p self
</code></pre>


<p>在当前上下文<em>self</em>伪变量返回的是<em>main</em>执行的上下文。  </p>


<p>$ ./pseudo.rb<br>
main<br>
nil<br>
true<br>
false<br>
Object<br>
NilClass<br>
TrueClass<br>
FalseClass  </p>


<p>以上是例子的输出结果。</p>


<hr>


<p>在本节的第二个例子，我们将进一步分析<em>self</em>。</p>


<pre><code>#!/usr/bin/ruby

class Some
    puts self
end

class Other
    puts self
end

puts self
</code></pre>


<p>之前我们说过，<em>self</em>是对当前方法接收者的引用。以上例子展示了三个不同的接收者。 </p>


<pre><code>class Some
    puts self
end
</code></pre>


<p>这个接收者名为<em>Some</em>。</p>


<pre><code>class Other
    puts self
end
</code></pre>


<p>这是另一个接收者，名为：<em>Other</em>。</p>


<pre><code>puts self
</code></pre>


<p>第三个接收者是Ruby顶级环境。</p>


<p>$ ./pseudoself.rb <br>
Some <br>
Other <br>
main   </p>


<p>以上是例子的输出结果。</p>


<hr>


<p>本节的最后一个例子展示了另外三个伪变量。</p>


<pre><code>#!/usr/bin/ruby

if true
    puts "This message is shown"
end

if false
    puts "This message is not shown"
end

p $name
p $age
</code></pre>


<p>上面的例子展示了<em>true</em>、<em>false</em>和<em>nil</em>伪变量。 </p>


<pre><code>if true
    puts "This message is shown"
end
</code></pre>


<p><em>true</em>用于布尔表达式中。这条消息总是会打印的。  </p>


<pre><code>if false
    puts "This message is not shown"
end
</code></pre>


<p>这条消息永远不会打印。这个条件不成立。这个布尔表达式总是会返回一个负值。  </p>


<pre><code>p $name
p $age
</code></pre>


<p>如果全局变量没有初始化就引用，那么它们就会包含一个<em>nil</em>伪变量。这代表值不存在。  </p>


<p>$ ./pseudo2.rb<br>
This message is shown<br>
nil<br>
nil  </p>


<p>以上是<em>pseudo2.rb</em>脚本的输出结果。</p>


<h2>预定义变量</h2>


<p>Ruby中有很多预定义的全局变量。这是继承到Perl，Ruby受Perl的影响很大。Ruby脚本启动之后就可以访问这些变量了。接下来有些例子展示预定义变量。</p>


<pre><code>#!/usr/bin/ruby

print "Script name: ", $0, "\n"
print "Command line arguments: ", $*, "\n"

puts "Process number of this script: #{$$}"
</code></pre>


<p>以上使用了三个预定义变量。<em>$0</em>、<em>$*</em>和<em>$$</em>。<em>$0</em>存储了当前脚本的名字。<em>$*</em>存储了命令行参数。 <em>$$</em>存储了当前脚本程序的PID。  </p>


<p>$ ./predefined.rb 1 2 3 <br>
Script name: ./predefined.rb<br>
Command line arguments: [&#8220;1&#8221;, &#8220;2&#8221;, &#8220;3&#8221;]<br>
Process number of this script: 3122  </p>


<p>以上是一个输出例子。</p>


<hr>


<p><em>$?</em>全局变量存储了最后一个子进程的退出状态。  </p>


<pre><code>#!/usr/bin/ruby

system 'echo "Ruby"'
puts $?

%x[exit '1']
puts $?
</code></pre>


<p>我们执行两个子进程，然后使用<em>$?</em>查看它们的退出状态。</p>


<pre><code>system 'echo "Ruby"'
puts $?
</code></pre>


<p>使用<em>system</em>方法启动一个子进程。它是一个bash的echo命令，用于在终端输出消息。  </p>


<pre><code>%x[exit '1']
puts $?
</code></pre>


<p>第二个情况是使用状态1执行bash的exit命令。这次我们使用<em>%x</em> 操作符，用于执行一条被分隔符所选择的命令。</p>


<p>$ ./predefined2.rb<br>
Ruby<br>
pid 3131 exit 0<br>
pid 3133 exit 1  </p>


<p>第一个子进程退出状态为0,第二为1。 </p>


<hr>


<p><em>$;</em>变量存储了字符串<em>split</em>方法的默认分隔符。  </p>


<pre><code>#!/usr/bin/ruby

str = "1,2,3,4,5,6,7"
p str.split

$; = ","
p str.split
</code></pre>


<p>我们使用<em>$;</em>变量来控制字符串的<em>split</em>方法是如何分隔的。这个方法接收一个参数，用于确定字符串应该何处分隔。 如果这个参数省略了，那么将会使用<em>$;</em>的值。  </p>


<pre><code>$; = ","
p str.split
</code></pre>


<p>我们为<em>$;</em>分隔符指定个值。当<em>split</em>方法没有传递参数时，<em>$;</em>的值将会被使用。  </p>


<p>$ ./predefined3.rb<br>
[&#8220;1,2,3,4,5,6,7&#8221;]<br>
[&#8220;1&#8221;, &#8220;2&#8221;, &#8220;3&#8221;, &#8220;4&#8221;, &#8220;5&#8221;, &#8220;6&#8221;, &#8220;7&#8221;]  </p>


<p>在第一种情况下字符串没有被分割，第二种情况下字符串正确的被分割了。  </p>


<hr>


<p>最后我们展示三个用于正则表达式的全局预定义变量。  </p>


<pre><code>#!/usr/bin/ruby

"Her name is Jane" =~ /name/

p $`
p $&amp;
p $'
</code></pre>


<p>当我们对字符串使用<em>=~</em>保用符时，Ruby设置了一些变量。<em>$&amp;</em>变量设为最后一个匹配该正则式的内容。<em>$`</em>设为<em>$&amp;</em>之前的内容.<em>$’</em>为<em>$&amp;</em>之后的内容。</p>


<p>$ ./predefined4.rb<br>
&#8220;Her &#8221;<br>
&#8220;name&#8221;<br>
&#8221; is Jane&#8221;  </p>


<p>以上是这个例子的输出结果。</p>


<p>在这一章的教程中我们深入的学习了Ruby的变量。</p>


<hr>


<p>原文地址： <a href="http://zetcode.com/lang/rubytutorial/variables/">http://zetcode.com/lang/rubytutorial/variables/</a><br>
翻译：龙昌  admin@longchangjin.cn<br>
完整教程：<a href="https://github.com/wusuopu/Ruby-tutorial">https://github.com/wusuopu/Ruby-tutorial</a>  </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83902.html">[翻译]Ruby教程3——基础</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-04T00:00:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83902.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83902.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>基础</h1>


<p>在这一章我们将覆盖Ruby语言的基本程序概念。我们展示一些非常基础的程序，使用到了变量、常量和基本的数据类型。从终端读取、写入内容；我们将会介绍变量的插值（interpolation）。</p>


<p>我们从一个非常简单的代码例子开始。  </p>


<blockquote>
<p>#!/usr/bin/ruby<br>
  puts &#8220;This is Ruby&#8221;</p>
</blockquote>


<p>这个简单的脚本会在终端打印<em>&#8220;This is Ruby&#8221;</em>信息。  </p>


<blockquote>
<p>#!/usr/bin/ruby</p>
</blockquote>


<p>这用于执行这个脚本的Ruby解释器的路径。</p>


<blockquote>
<p>puts &#8220;This is Ruby&#8221;</p>
</blockquote>


<p><em>puts</em>是Ruby的关键字，用于将它的参数打印到终端上。在这个例子中它的参数是一个被双引号分隔的字符串。</p>


<p>$ ./first.rb <br>
This is Ruby</p>


<p>以上是这个例子的输出结果。</p>


<hr>


<p>我们可以从终端读取值。</p>


<blockquote>
<p>#!/usr/bin/ruby<br>
   print &#8220;What is your name? &#8221;<br>
   name = gets
   puts &#8220;Hello #{name}&#8221;</p>
</blockquote>


<p>第二个程序将会从终端读取一个值并输出。  </p>


<blockquote>
<p>print &#8220;What is your name? &#8221;</p>
</blockquote>


<p><em>print</em>关键字是将参数打印到终端上。<em>print</em>与<em>puts</em>的不同在于<em>print</em>不同自动换行，而<em>puts</em>会自动换行。</p>


<blockquote>
<p>name = gets</p>
</blockquote>


<p>这里我们将从用户输入中读取值并将其保存在<em>name</em>变量中。<em>gets</em>是一个方法用于从终端读取一行内容。它是一个内置的方法。</p>


<blockquote>
<p>puts &#8220;Hello #{name}&#8221;</p>
</blockquote>


<p>在这行代码我们展示变量的插值。变量插值（Variable interpolation）是将字符串字面量中的变量替换成它真实的值。变量插值（interpolation）的其他说法是：变量置换和变量扩展。  </p>


<blockquote>
<p>$ ./name.rb <br>
 What is your name? Jan<br>
 Hello Jan  </p>
</blockquote>


<p>以上是第二个程序的输出结果。</p>


<hr>


<p>Ruby代码可以从命令行运行。这个是借鉴至Perl的单行方式，小块代码执行小任务。</p>


<blockquote>
<p>$ ruby -e &#8220;puts RUBY_VERSION&#8221;<br>
 2.0.0</p>
</blockquote>


<p><em>-e</em>参数告诉Ruby要执行的代码从命令行中给定，而不是Ruby代码文件。我们例子将在终端输出Ruby解释器的版本号。<br>
译注：原文的作者使用的是ruby 1.9.3，而如今ruby最新版已经是2.0.0了。</p>


<hr>


<p>Ruby解释器有一个<em>-c</em>选项用于检查代码的语法。如果启用了的话，代码将不会被执行。如果代码没有语法错误，那么将会打印<em>&#8220;Syntax OK&#8221;</em>。</p>


<blockquote>
<p>#!/usr/bin/ruby<br>
 class Being end <br>
 m = Test.new<br>
 p m  </p>
</blockquote>


<p>以上例子中有一个语法错误。如果我们将<em>class</em>和<em>end</em>关键字放在同一行，那么我们就必须还要使用分号字符(;)。</p>


<p>$ ruby -c syntax_check.rb <br>
syntax_check.rb:3: syntax error, unexpected keyword_end, expecting &#8216;&lt;&#8217; or &#8216;;&#8217; or &#8216;\n&#8217;<br>
syntax_check.rb:6: syntax error, unexpected $end, expecting keyword_end  </p>


<p>发现了语法错误。如果我们在<em>Being</em>的后面加上分号，错误提示消息就会消失。  </p>


<h2>命令行参数</h2>


<p>Ruby程序可以从命令行接收参数。当我们执行程序时参数接在程序名的后面。</p>


<blockquote>
<p>#!/usr/bin/ruby<br>
 puts ARGV  </p>
</blockquote>


<p>接在文件名后面的有效命令行参数被Ruby程序保存在全局数组ARGV中。</p>


<p>这里我们将所有的命令行参数打印到终端上。  </p>


<p>$ ./args.rb 1 2 3<br>
1<br>
2<br>
3  </p>


<p>我们提供了三个数字作为命令行参数，并且它们都打印到终端上了。</p>


<hr>


<p>在下面的例子中我们将打印所有的参数还有脚本名。</p>


<blockquote>
<p>#!/usr/bin/ruby<br>
 puts $0<br>
 puts $*  </p>
</blockquote>


<p><em>$0</em>是全局变量，包含被执行的脚本的名称。在Ruby中全局变量是以<em>$</em>字符开头。<em>$*</em>是另一个全局变量。它与ARGV是相等的，包含了命令行的所有参数。</p>


<p>$ ./args2.rb Ruby Python Perl<br>
./args2.rb<br>
Ruby<br>
Python<br>
Perl  </p>


<p><em>args2.rb</em>脚本接收了三个参数。脚本名和这三个参数都打印到终端上了。  </p>


<h2>变量和常量</h2>


<p>变量是保存数据的地址。变量包括名称和数据类型。数据类型表示了数据的不同类型。整数、字符串和浮点数都是数据类型。Ruby是一门动态语言，这意味着我们不需要（也不能）定义一个变量的确定类型。而是Ruby解释器在分配变量时决定它的数据类型。此外，在程序运行时一个变量还可以包含不同类型的不同值。这与Java、C或者Pascal之类的强类型语言不同。与变量不同，常量（应该）保持它的值。一旦初始化了就不能修改。然后在Ruby中是有可能修改常量的值，这种情况下会出现一个警告。</p>


<blockquote>
<p>#!/usr/bin/ruby<br>
 city = &#8220;New York&#8221;<br>
 name = &#8220;Paul&#8221;; age = 35<br>
 nationality = &#8220;American&#8221;  </p>
<p>puts city<br>
 puts name<br>
 puts age<br>
 puts nationality  </p>
<p>city = &#8220;London&#8221;  </p>
<p>puts city  </p>
</blockquote>


<p>在上面的例子中我们使用了四个变量。</p>


<blockquote>
<p>city = &#8220;New York&#8221;</p>
</blockquote>


<p>我们给<em>city</em>变量分配了一个字符串。这个变量是动态创建的。 </p>


<blockquote>
<p>name = &#8220;Paul&#8221;; age = 35</p>
</blockquote>


<p>创建两个变量。我们可以将两条语句放在一行里。然后为了提高可读性应该每行一条语句。</p>


<blockquote>
<p>puts city<br>
 puts name<br>
 puts age<br>
 puts nationality  </p>
</blockquote>


<p>将变量的值打印到终端。</p>


<blockquote>
<p>city = &#8220;London&#8221;  </p>
</blockquote>


<p>给<em>city</em>变量分配新的值。  </p>


<p>$ ./variables.rb <br>
New York<br>
Paul<br>
35<br>
American<br>
London  </p>


<p>这是以上例子的输出。</p>


<hr>


<p>之前我们已经介绍过常量了，它一直都保存着一个值。但是不同于其他语言，Ruby没有对这个进行强制限制。</p>


<blockquote>
<p>#!/usr/bin/ruby  </p>
<p>WIDTH = 100<br>
 HEIGHT = 150   </p>
<p>var = 40<br>
 puts var  </p>
<p>var = 50<br>
 puts var  </p>
<p>puts WIDTH<br>
 WIDTH = 110<br>
 puts WIDTH  </p>
</blockquote>


<p>在这个例子中定义了两个常量和一个变量。</p>


<blockquote>
<p>WIDTH = 100<br>
 HEIGHT = 150   </p>
</blockquote>


<p>在Ruby中常量是以大写字母开头的。通常是将所有字母都大写。</p>


<blockquote>
<p>var = 40<br>
 puts var  </p>
<p>var = 50  </p>
</blockquote>


<p>定义并初始化一个变量。随后又给它分配了一个新的值，这是合法的。</p>


<blockquote>
<p>WIDTH = 100  </p>
</blockquote>


<p>我们给常量分配了一个新的值。常量一旦创建就不应该改变，否则它就不意味着是一个常量。Ruby解释器将会给出一条警告。</p>


<p>$ ./constants.rb <br>
40<br>
50<br>
100<br>
./constants.rb:13: warning: already initialized constant WIDTH<br>
110  </p>


<p>以上是脚本的输出。</p>


<h2>变量插值</h2>


<p>变量插值（interpolation）是将字符串中的变量替换成它的值。变量插值的其他说法是：变量置换和变量扩展。</p>


<blockquote>
<p>#!/usr/bin/ruby  </p>
<p>age = 34<br>
 name = &#8220;William&#8221;  </p>
<p>puts &#8220;#{name} is #{age} years old&#8221;   </p>
</blockquote>


<p>在Ruby中字符串是不可变的。我们不能修改一个已存在的字符串。变量插值是字符创建时进行的。  </p>


<blockquote>
<p>age = 34<br>
 name = &#8220;William&#8221;  </p>
</blockquote>


<p>定义两个变量。</p>


<blockquote>
<p>puts &#8220;#{name} is #{age} years old&#8221; </p>
</blockquote>


<p>字符串是被双引号所引起来。当我们将变量名放在<em>#{</em>和<em>}</em>字符之间时,这个变量会被它的值所篡改。</p>


<p>$ ./interpolation.rb <br>
William is 34 years old  </p>


<p>以上是这个例子的输出。</p>


<p>这一章覆盖了Ruby语言的一些基础。 </p>


<hr>


<p>原文地址： <a href="http://zetcode.com/lang/rubytutorial/basics/">http://zetcode.com/lang/rubytutorial/basics/</a><br>
翻译：龙昌  admin@longchangjin.cn<br>
完整教程：<a href="https://github.com/wusuopu/Ruby-tutorial">https://github.com/wusuopu/Ruby-tutorial</a>  </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83899.html">[翻译]Ruby教程2——词法结构</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-02T00:00:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83899.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83899.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Ruby 词法结构</h1>


<p>计算机语言跟人类语言类似也有词法结构。一个Ruby程序的源代码由符号构成。符号标志是最基本的代码元素。在Ruby语言中我们有多种词法结构，如：注释、变量、字面量、空白符号、操作符、分隔符和关键字。</p>


<h2>注释</h2>


<p>注释是用于向人们阐明源代码。在Ruby中有两种注释的方法，单行注释和多行注释。单行注释以#字符开始；多行注释是放置在<em>=bgin</em>和<em>=end</em> 等号标志之间。</p>


<blockquote>
<p>#!/usr/bin/ruby  </p>
<p>=begin  </p>
<blockquote>
<p>comments.rb<br>
      author Jan Bodnar<br>
      ZetCode 2011    </p>
</blockquote>
<p>=end  </p>
<p># prints message to the terminal<br>
 puts &#8220;Comments example&#8221;  </p>
</blockquote>


<p>这个例子同时展示的两种方法的注释。注释的内容将会被Ruby解释器忽略掉。</p>


<blockquote>
<pre><code>=begin  
    comments.rb  
    author Jan Bodnar  
    ZetCode 2011  
=end
</code></pre>
</blockquote>


<p>这是一个多行注释的例子，两个符号标志必须在行首。</p>


<h2>空白符号</h2>


<p>在源文件中Ruby的空白符号被用于分隔符号标志和结束语句。它也用于增强代码的可读性。  </p>


<p>if true then<br>
&nbsp;&nbsp;puts &#8220;A message&#8221;<br>
end  </p>


<p>空白字符在一些时候是必须的。例如在<em>if</em>关键字和<em>true</em>关键字之间；或者在<em>puts</em>方法和实际的字符串之间。而有时它又是被禁止的，如它不能包含在变量标识符或者语言关键字中。  </p>


<p>a=1<br>
b&nbsp;=&nbsp;2<br>
c&nbsp;&nbsp;=&nbsp;&nbsp;3  </p>


<p>这些在符号标志之间的空白字符对于Ruby解释器是无关紧要的。但是它于整个项目的风格统一非常重要。</p>


<hr>


<blockquote>
<p>#!/usr/bin/ruby  </p>
<p>x = 5 + 3<br>
 puts x  </p>
<p>x = 5 <br>
   &nbsp;&nbsp;&nbsp;&nbsp;+ 3<br>
 puts x      </p>
<p>x = 5 + <br>
   &nbsp;&nbsp;&nbsp;&nbsp;3<br>
 puts x</p>
</blockquote>


<p>换行是一种用于结束语句的空白字符形式。  </p>


<p>x = 5 + 3  </p>


<p>在第一种情况，我们有一条语句。它将相加求和的值赋给x变量。这个变量的值为8。  </p>


<p>x = 5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+3</p>


<p>现在第二种情况。第1条语句被换行符终止了，x变量的值是5。另一条语句<em>+3</em>，没有任何影响。  </p>


<p>x = 5 +<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3  </p>


<p>最后，第1条语句的换行符之前有一个+二元操作符，因此解释器期望另一个值，它将检查第二行。在这种情况它将这两种作为一条语句，因此x这是的值为8。  </p>


<p>$ ./whitespace.rb<br>
8<br>
5<br>
8  </p>


<p>以上为输出结果。  </p>


<h2>变量</h2>


<p>变量是一个保存了值的标识符。在编程时我们说我们给一个变量分配一个值。专业一点的说法是一个变量是对计算机中存储了值的内存的引用。在Ruby中一个变量可以保存字符串、数字或者多种对象。不同时间变量可以被分配不同的值。<br>
在Ruby中变量名由字母数字和下划线组成，但是不能以数字开头。Ruby解释器可以很容易地区分原始的数字跟变量。变量名不能以大写字母开头，在Ruby中以大写字母开头的标识符会被认为是一个常量。</p>


<blockquote>
<p>Value<br>
   value2<br>
   company_name  </p>
</blockquote>


<p>以上这些都是合法的变量名。</p>


<blockquote>
<p>12Val<br>
   exx$<br>
   first-name  </p>
</blockquote>


<p>以上这些都不是合法的变量名。  </p>


<p>变量名前可以加<em>$</em>和<em>@</em>这两个特殊的字符，它们用于创建特殊作用域的变量。  </p>


<p>变量名是大小写敏感的，这意味着<em>price</em>和<em>pRice</em>是两个不同的标识符。  </p>


<blockquote>
<p>#!/usr/bin/ruby<br>
 number = 10<br>
 numBER = 11  </p>
<p>puts number, numBER  </p>
</blockquote>


<p>在这个脚本中我们给两个标识符分配了两个数字。<em>number</em>和<em>numBER</em>是两个不同的变量。</p>


<blockquote>
<p>$ ./case.rb<br>
   10<br>
   11  </p>
</blockquote>


<p>以上是这个脚本运行的输出结果。</p>


<h2>常量</h2>


<p>常量的值在程序运行过程中是不变的。在Ruby中一个标识符的首字母大写即为一个常量。编程时对于常量约定是所有字母全都大写。<br>
与其他语言不同，Ruby不会强制要求常量的值始终不变。当我们给一个常量分配新的值时解释器只会提示一个警告。  </p>


<blockquote>
<p>#!/usr/bin/ruby<br>
 Name = &#8220;Robert&#8221;<br>
 AGE = 23<br>
 Name = &#8220;Juliet&#8221;  </p>
</blockquote>


<p>在上面的例子中我们创建了两个常量，其中一个被重新定义了。  </p>


<blockquote>
<p>Name = &#8220;Robert&#8221;<br>
 AGE = 23  </p>
</blockquote>


<p>创建两个常量。在Ruby中标识符的首字母大写即定义为常量。作为约定常量通常是所有字母都大写的。  </p>


<blockquote>
<p>Name = &#8220;Juliet&#8221;  </p>
</blockquote>


<p>我们重新定义了一个常量，这会引起一个警告。</p>


<blockquote>
<p>$ ./constants.rb<br>
   ./constants.rb:6: warning: already initialized constant Name  </p>
</blockquote>


<p>以上是这个例子运行的输出。</p>


<h2>字面量</h2>


<p>字面量（literal）是按原文本内容所表示的特殊类型的值。字面量类型包括布尔型、整型、浮点型、字符串、字符和日期。专业的说一个字面量在编译时会分配一个值，该值在运行时会分配给对应的变量。</p>


<blockquote>
<p>age = 29<br>
 nationality = &#8220;Hungarian&#8221;  </p>
</blockquote>


<p>这里我们分配了两个字面量变量。数字<em>29</em>和字符串<em>&#8220;Hungarian&#8221;</em>都是字面量。  </p>


<pre><code>#!/usr/bin/ruby

require 'date'

sng = true  
name = "James"  
job = nil  
weight = 68.5  
born = Date.parse("November 12, 1986")

puts "His name is #{name}"

if sng == true  
    puts "He is single"  
else  
    puts "He is in a relationship"  
end

puts "His job is #{job}"  
puts "He weighs #{weight} kilograms"  
puts "He was born in #{born}"
</code></pre>


<p>在上面这个例子中，我们使用了多个字面量。布尔字面量的值可能为<em>true</em>或者<em>false</em>，<em>James</em>是一个字符串字面量，<em>nil</em>表示一个不存在的值，<em>68.5</em>是一个浮点数，最后<em>November 12,1986</em>是一个日期。</p>


<blockquote>
<p>$ ./literals.rb<br>
   His name is James<br>
   He is single<br>
   His job is <br>
   He weighs 68.5 kilograms<br>
   He was born in 1986-11-12  </p>
</blockquote>


<p>以上为<em>literals.rb</em>脚本的输出结果。 </p>


<h2>代码块</h2>


<p>Ruby语句通常是放在代码块中。一个代码块可以被<em>{}</em>符号或者<em>do</em>、<em>end</em>关键字分隔。  </p>


<pre><code>#!/usr/bin/ruby

puts [2, -1, -4, 0].delete_if { |x| x &lt; 0 }

[1, 2, 3].each do |e|
    puts e
end
</code></pre>


<p>这个例子中我们展示了两个代码块。  </p>


<p>Ruby代码的控制流通常是使用<em>if</em>关键字。这个关键字k跟随着一个代码块，在这种情况下代码块被<em>then</em>、<em>end</em>关键字分隔，<em>then</em>关键字是可选的。</p>


<pre><code>#!/usr/bin/ruby

if true then
    puts "Ruby language"
    puts "Ruby script"
end
</code></pre>


<p>在上面这个例子中，我们展示了一个简单的代码块。它有两条语句。这个代码块被<em>then</em>、<em>end</em>关键字分隔。<em>then</em>关键字可以省略。</p>


<h2>符号</h2>


<p>符号<em>$</em>、<em>@</em>是特殊字符用于表示变量的作用域，<em>$</em>表示全局变量，<em>@</em>表示实例变量，<em>@@</em>表示类变量。  </p>


<blockquote>
<p>$car_name = &#8220;Peugeot&#8221;<br>
  @sea_name = &#8220;Black sea&#8221;<br>
  @@species = &#8220;Cat&#8221;  </p>
</blockquote>


<p>这些符号总是位于变量标识符的开头。</p>


<h2>操作符</h2>


<p>操作符是一个用于对值执行一个动作的符号。  </p>


<pre><code>!    +    -    ~    *    **    /    %
&lt;&lt;    &gt;&gt;    &amp;    |    ^
==    ===    !=    &lt;=&gt;    &gt;=    &gt;
&lt;    &lt;=    =    %=    /=    -=
+=    *=    **=    ..    ...    not
and    or    ?:    &amp;&amp;    ||
</code></pre>


<p>以上是在Ruby中所有有效的操作符，我们将在之后的教程中介绍它们。  </p>


<h2>分隔符</h2>


<p>分隔符是一个或多个用于在纯文本或者其他数据流中指定分隔独立区域范围的字符序列。  </p>


<pre><code>(       )       [       ]       {       }      
,       ;       '       "       |       |

#!/usr/bin/ruby

name = "Jane"
occupation = 'Student'
numbers = [ 2, 3, 5, 3, 6, 2 ]

puts name; puts occupation
puts numbers[2]
numbers.each { |i| puts i }
puts ( 2 + 3 ) * 5
</code></pre>


<p>在上面这个例子中我们展示多种Ruby分隔符的用法。  </p>


<blockquote>
<p>name = &#8220;Jane&#8221;<br>
 occupation = &#8216;Student&#8217;  </p>
</blockquote>


<p>在Ruby中单引号和双引号被用于分隔字符串。</p>


<blockquote>
<p>numbers = [ 2, 3, 5, 3, 6, 2 ]  </p>
</blockquote>


<p>中括号用于指定数组的范围。逗号用于分隔数组项。  </p>


<blockquote>
<p>puts name; puts occupation  </p>
</blockquote>


<p>在Ruby中分号用于分隔两条语句。</p>


<blockquote>
<p>puts numbers[2]  </p>
</blockquote>


<p>分隔符可用于不同的环境中，这里中括号用于访问数组。</p>


<blockquote>
<p>numbers.each { |i| puts i }  </p>
</blockquote>


<p>大括号用于定义代码块。管道用于定义在每次循环中被当前数组项所填充的元素。</p>


<blockquote>
<p>puts ( 2 + 3 ) * 5</p>
</blockquote>


<p>括号用于改变一个表达式的求值。</p>


<h2>关键字</h2>


<p>关键字是在Ruby语言中被保留的字。关键字用于在计算机程序中展示特定的任务。例如：在终端中打印一个值，执行重复的任务或者展示逻辑操作。程序员不能使用关键字作为普通的变量。  </p>


<pre><code>alias    and      BEGIN      begin    break    case  
class    def      defined?   do       else     elsif  
END      end      ensure     false    for      if  
in       module   next       nil      not      or  
redo     rescue   retry      return   self     super  
then     true     undef      unless   until    when   
while    yield
</code></pre>


<p>这些是Ruby的关键列表。</p>


<p>以上就是Ruby的词法结构了。</p>


<hr>


<p>原文地址： <a href="http://zetcode.com/lang/rubytutorial/lexis/">http://zetcode.com/lang/rubytutorial/lexis/</a><br>
翻译：龙昌  admin@longchangjin.cn<br>
完整教程：<a href="https://github.com/wusuopu/Ruby-tutorial">https://github.com/wusuopu/Ruby-tutorial</a>  </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83895.html">[翻译]Ruby教程1——Ruby语言介绍</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-02T00:00:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83895.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83895.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Ruby</h1>


<p>在这部分Ruby教程中，我们将介绍Ruby编程语言。</p>


<h2>目标</h2>


<p>这个教程的目标是让你入门Ruby。这个教程覆盖了Ruby的主要内容，包括变量、表达式、集合、流程控制结构以及其他的一些主要特性。同样也会描述一些高级的概念，例如面向对象和正则表达式。这不会完全地覆盖这个语言。</p>


<h2>Ruby</h2>


<p>Ruby是一门动态的、反射的、通用的面向对象编程语言。它的源作者是一个日本程序员——松本行弘 (まつもとゆきひろ)。Ruby第一次发表是在1995年。</p>


<p>Ruby支持多种程序范式。包括面向对象、反射、命令式的和反射的编程。Ruby语言主要是受到Perl、Smalltalk、Eiffel和Lisp的影响。不同于java、C#以及C，Ruby没有官方的规范。取而代之的是用原始的C实现的Ruby语言作为实际参考。同时也还存在一些用其他方法实现的Ruby语言，如：JRuby、IronRuby或者MacRuby。</p>


<p>Ruby的官方网站是: <a href="htp://ruby-lang.org">ruby-lang.org</a></p>


<h2>人气</h2>


<p>如今有上百种编程语言，而Ruby属于最流行的一个。在<a href="http://langpop.com">langpop.com</a>和<a href="http://www.tiobe.com/index.php/content/paperinfo/tpci/index.html">tiobe</a>网站Ruby都排在第10名左右。Ruby on Rails——一个非常流行的web应用框架是使用Ruby开发第一个杀手级的应用。</p>


<h2>交互式的解释器</h2>


<p>我们可以通过脚本或者交互式的解释器来运行Ruby语句。在这个教程中我们将使用交互式的Ruby会话来展示一些小的代码片段。大的代码例子将放在Ruby脚本中。</p>


<blockquote>
<p>$ irb<br>
  irb(main):001:0&gt; puts RUBY_VERSION<br>
  2.0.0<br>
  =&gt; nil  </p>
</blockquote>


<p>这是一个Ruby交互会式会话的例子。我们在终端中打印了一个特别的常量RUBY_VERSION，它被设置为当前使用的Ruby的版本。<br>
译注：原文的作者使用的是ruby 1.8.7，而如今ruby最新版已经是2.0.0了，因此我在翻译的时候也结合了当前新的内容。</p>


<h2>Ruby脚本</h2>


<p>我们开始我们的第一个简单的Ruby脚本例子。  </p>


<blockquote>
<p>#!/usr/bin/ruby<br>
 # first.rb<br>
 puts &#8220;This is Ruby&#8221;  </p>
</blockquote>


<p>这个脚本我们将在终端上打印一条消息。</p>


<blockquote>
<p>#!/usr/bin/ruby</p>
</blockquote>


<p>UNIX下的每一个脚本都是以shebang符号开始的。shebang是脚本中开始的前两个字符：<strong>#!</strong>。shebang后面是执行我们脚本的解释器的路径。/usr/bin是Ruby解释器最常用的位置。它也可以定位在/usr/local/bin或者其他什么地方。</p>


<blockquote>
<p># first.rb  </p>
</blockquote>


<p>在Ruby中注释是以#开始。</p>


<blockquote>
<p>puts &#8220;This is Ruby&#8221; </p>
</blockquote>


<p>puts方法是将字符串打印到终端。</p>


<blockquote>
<p>$ which ruby<br>
 /usr/bin/ruby  </p>
</blockquote>


<p>Ruby解释器的路径可以使用which命令找到。</p>


<blockquote>
<p>$ chmod +x first.rb<br>
 $ ./first.rb<br>
 This is Ruby  </p>
</blockquote>


<p>通过chmod命令，我们给脚本增加可执行的权限。</p>


<h2>资源</h2>


<p>以下资源在编写该教程时会使用到：<br>
<em> <a href="http://www.ruby-lang.org/">ruby-lang.org</a><br>
</em> <a href="http://ruby-doc.org/">ruby-doc.org</a><br>
<em> <a href="http://en.wikipedia.org/wiki/Ruby_(programming_language)">Ruby article on wikipedia.org</a><br>
</em> <a href="http://ruby.runpaint.org/">ruby.runpaint.org</a></p>


<p>在这章的教程中我们介绍了Ruby语言。  </p>


<hr>


<p>原文地址： <a href="http://zetcode.com/lang/rubytutorial/ruby/">http://zetcode.com/lang/rubytutorial/ruby/</a><br>
翻译：龙昌  admin@longchangjin.cn<br>
完整教程：<a href="https://github.com/wusuopu/Ruby-tutorial">https://github.com/wusuopu/Ruby-tutorial</a>  </p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83890.html">Scrapy框架学习笔记3—— Scrapy与mongodb结合</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-10-07T00:00:00+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83890.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83890.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>创建一个新的Item Pipeline，并将其添加到settings.py的ITEM_PIPELINES列表中。<br/>
在process_item方法中将item的数据保存到mongodb中。<br/>
scrapy的Item与dict相似，而mongodb中的数据是心bson格式保存的。因此Item的数据应该可以直接存储到mongodb中而几乎不用做额外的处理。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">MyMongoDBPipeline</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongodb_server</span><span class="p">,</span> <span class="n">mongodb_port</span><span class="p">,</span> <span class="n">mongodb_db</span><span class="p">,</span> <span class="n">mongodb_collection</span><span class="p">):</span>
</span><span class='line'>        <span class="n">connection</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">mongodb_server</span><span class="p">,</span> <span class="n">mongodb_port</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_db</span> <span class="o">=</span> <span class="n">mongodb_db</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="n">mongodb_db</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_collection</span> <span class="o">=</span> <span class="n">mongodb_collection</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">[</span><span class="n">mongodb_collection</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@classmethod</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">from_crawler</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">crawler</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># 连接mongodb</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">27017</span><span class="p">,</span> <span class="s">&#39;scrapy&#39;</span><span class="p">,</span> <span class="s">&#39;items&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</span><span class='line'>        <span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s">&quot;Item </span><span class="si">%s</span><span class="s"> wrote to MongoDB database </span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_collection</span><span class="p">),</span>
</span><span class='line'>                <span class="n">level</span><span class="o">=</span><span class="n">log</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">spider</span><span class="o">=</span><span class="n">spider</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">item</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83887.html">Scrapy框架学习笔记2—— Scrapy与Django结合</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-10-07T00:00:00+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83887.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83887.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前面也介绍过了Scrapy与Django的设计思想非常相似，因此这个两个结合也是比较容易的。<br/>
以下方法在Scrapy 0.18与Django 1.5下面测试是可以用的。</p>

<h3>1.首先设置Django的运行环境</h3>


<p>在settings.py中添加如下代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">setup_django_environment</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">imp</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
</span><span class='line'>    <span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">setup_environ</span>
</span><span class='line'>    <span class="n">m</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s">&#39;settings&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&#39;settings&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">]))</span>
</span><span class='line'>    <span class="n">setup_environ</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span class='line'>    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pardir</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="n">setup_django_environment</span><span class="p">(</span><span class="s">&quot;/django/project/path&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>注意：如果你的Django项目是用的sqlite数据库的话，那就需要设置为绝对路径，不能使用相对路径。</p>

<h3>2.创建django item</h3>


<p>首先在Django项目代码中创建一个Django的model，例如:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ScrapyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">link</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">desc</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后在Scrapy项目中创建一个新的Item，只不过这次我们不再是继承自scrapy.item.Item，而是scrapy.contrib.djangoitem.DjangoItem:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Test1DjItem</span><span class="p">(</span><span class="n">DjangoItem</span><span class="p">):</span>
</span><span class='line'>    <span class="n">django_model</span> <span class="o">=</span> <span class="n">ScrapyModel</span>
</span></code></pre></td></tr></table></div></figure>


<p>用法与原来的Item相同，只是最后要执行一个save函数来调用django的save方法将数据存入数据库。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83883.html">Scrapy框架学习笔记1——概括</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-10-07T00:00:00+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83883.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83883.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Scrapy是一个python的web爬虫框架，其设计思想与Django非常相似。如果事先用过Django的话那么理解Scrapy应该不难。</p>

<h3>0.安装Scrapy</h3>


<p>当前Scrapy的稳定版本是0.18<br/>
使用pip进行安装：  <code>pip install Scrapy</code><br/>
使用easy_install进行安装：  <code>easy_install Scrapy</code></p>

<p>初次使用可以按照它的官方教程操作，先熟悉一下：<br/>
<a href="http://doc.scrapy.org/en/0.18/intro/tutorial.html">http://doc.scrapy.org/en/0.18/intro/tutorial.html</a></p>

<h3>1.一个项目的基本流程</h3>


<p>  创建新项目  scrapy startproject &lt;name&gt;</p>

<p>  然后在&lt;name&gt;/spiders目录下新建一个python文件。<br/>
  编写一个新的class继承自 scrapy.spider.BaseSpider，并且需要设置如下属性：<br/>
    * name: 该爬虫的名字，不能与其它的相同<br/>
    * start_urls: 开始的url入口<br/>
    * parse(): 对从start_urls的获取的内容进行处理的函数，需要一个Response参数<br/>
    * allowed_domains: 一个列表，表示该爬虫允许爬取的网站域名。可选</p>

<p>  爬虫运行流程：<br/>
    * 首先调用 start_requests()方法访问start_urls的链接（默认的），然后由parse回调方法对请求的响应进行处理。<br/>
    * 在回调中处理Response，并返回Item或者Request，再或者是由这两种对象组成的一个可迭代的对象。<br/>
      Request对象对应的callback可以与parse相同，也可以不同。</p>

<p>  最后运行这个爬虫脚本：  scrapy crawl name</p>

<p>  也可以直接在终端运行一个选择器： scrapy shell &lt;url&gt;</p>

<h3>2.使用Item</h3>


<pre><code>scrapy.item.Item的调用接口类似于python的dict，Item包含多个scrapy.item.Field。  
这跟django的Model与Field有点相似。  
Item通常是在Spider的parse方法里使用，它用来保存解析到的数据。
</code></pre>

<h3>3.使用Item Pipeline</h3>


<p>  在settings.py中设置ITEM_PIPELINES，其默认为[]，与django的MIDDLEWARE_CLASSES等相似。<br/>
  从Spider的parse返回的Item数据将依次被ITEM_PIPELINES列表中的Pipeline类处理。</p>

<p>  一个Item Pipeline类必须实现以下方法：</p>

<blockquote><p> process_item(item, spider)</p>

<blockquote><p>为每个item pipeline组件调用，并且需要返回一个scrapy.item.Item实例对象或者抛出一个scrapy.exceptions.DropItem异常。<br/>
当抛出异常后该item将不会被之后的pipeline处理。<br/>
参数:<br/>
        item (Item object) – 由parse方法返回的Item对象<br/>
        spider (BaseSpider object) – 抓取到这个Item对象对应的爬虫对象</p></blockquote>

<p> 也可额外的实现以下两个方法：<br/>
 open_spider(spider)</p>

<blockquote><p>当爬虫打开之后被调用。<br/>
参数: spider (BaseSpider object) – 已经运行的爬虫</p></blockquote>

<p> close_spider(spider)</p>

<blockquote><p>当爬虫关闭之后被调用。<br/>
参数: spider (BaseSpider object) – 已经关闭的爬虫</p></blockquote></blockquote>

<h3>4.保存数据</h3>


<p>  想要保存抓取到的数据，最简单的方法是使用Feed exports。 参考官方文档：<a href="http://doc.scrapy.org/en/0.18/topics/feed-exports.html#topics-feed-exports">http://doc.scrapy.org/en/0.18/topics/feed-exports.html#topics-feed-exports</a></p>

<p>  例如将抓取的数据导出为json:  scrapy crawl dmoz -o items.json -t json</p>

<p>  对于小项目用这种方法也足够了。如果是比较复杂的数据的话可能就需要编写一个Item Pipeline进行处理了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83880.html">分享几款vim风格的浏览器</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-24T00:00:00+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83880.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83880.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>作为一个了vim用户，希望所有的操作都能够以vim的按键方式完成，上网浏览网页也不例外。于是乎就找了几款vim按键绑定的浏览器。</p>

<p>0.Firefox + Vimperator / Chrome + Vimium<br/>
如果是用的Firefox或者Chrome浏览器的话直接安装相应的插件即可达到想要的效果。<br/>
Firefox的是Vimperator；Chrome的是Vimium。</p>

<p>但是感觉Firefox和Chrome有时又太占资源了，我想到一个轻量级的浏览器。</p>

<p>1.w3m<br/>
如果你是一个终端控的话，w3m貌似还不错。现在常见的Linux发行版的软件源中应该都包含了w3m，直接通过软件仓库安装就行了。<br/>
只不过w3m太简洁了，显示不了CSS样式，执行不了js代码，甚至是显示图片都比较麻烦。</p>

<p>2.uzbl<br/>
uzbl是一款基于GTK+Webkit的浏览器，只是它的按键与原生的vim相差比较大，我刚开始操作不太适应。<br/>
它的配置文件在$HOME/.config/uzbl目录下，如果把它配置好了的话那使用起来应该也会很不错的。<br/>
uzbl默认是不支持多标签的，如果要想打开多个标签请运行uzbl-tabbed程序。<br/>
下载地址：<a href="http://www.uzbl.org/">http://www.uzbl.org/</a></p>

<p>linuxdeepin用户可以执行命令 sudo apt-get install uzbl来安装。</p>

<p>3.dwb<br/>
dwb是一款基于gtk和webkit的轻量级的浏览器。它的按键与Firefox的Vimperator插件较为相似。<br/>
我个人觉得dwb是这几款浏览器中最为方便的，它配置比较简单，而且提供了一个web的配置页面。如图：<br/>
<img src="http://portix.bitbucket.org/dwb/resources/prefs.jpg" alt="" /></p>

<p>下载地址：<a href="http://portix.bitbucket.org/dwb/">http://portix.bitbucket.org/dwb/</a></p>

<p>4.luakit<br/>
luakit也是基于gtk和webkit的，只不过它是用lua语言开发的。它的配置文件也是lua脚本，如果想到修改配置的话可能需要懂点lua语言。<br/>
我感觉luakit的按键与vim最相近，而且它还提供了页面调试功能，这对做web开发的人来说比较方便。</p>

<p>下载地址：<a href="http://mason-larobina.github.io/luakit/">http://mason-larobina.github.io/luakit/</a></p>

<p>linuxdeepin用户可以执行命令 sudo apt-get install luakit来安装。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83877.html">分享两个vim的git插件</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-11T00:00:00+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83877.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83877.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>1.vim-git</p>

<p>我只是简单体验发一下，个人觉得这个就是用vim的命令把git的命令包装了一下，还不如直接在终端下操作方便。</p>

<p>常用命令<br/>
:GitAdd<br/>
:GitCommit<br/>
:GitStatus<br/>
:GitLog<br/>
:GitCheckout<br/>
:GitDiff<br/>
:GitPull<br/>
:GitPush</p>

<p>快捷键<br/>
&lt;Leader&gt;gd 等同于 :GitDiff<br/>
&lt;Leader&gt;gD 等同于 :GitDiff —cached<br/>
&lt;Leader&gt;gs 等同于 :GitStatus<br/>
&lt;Leader&gt;gl 等同于 :GitLog<br/>
&lt;Leader&gt;ga 等同于 :GitAdd<br/>
&lt;Leader&gt;gA 等同于 :GitAdd &lt;cfile&gt;<br/>
&lt;Leader&gt;gc 等同于 :GitCommit</p>

<p>下载地址：<a href="https://github.com/motemen/git-vim.git">https://github.com/motemen/git-vim.git</a></p>

<p>2.vim-fugitive</p>

<p>感觉这个比较强大，尤其是配合vimdiff来查看文件的发动非常方便。
它的说明文档介绍到如果你的vim版本低于7.2，那么建议同时也把vim-git安装上。</p>

<p>下载地址：<a href="https://github.com/tpope/vim-fugitive.git">https://github.com/tpope/vim-fugitive.git</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
    <h1 class="entry-title"><a href="http://www.xefan.com/archives/83875.html">Md5的一个碰撞例子</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-07-20T00:00:00+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="http://www.xefan.com/archives/83875.html#disqus_thread"
             data-disqus-identifier="http://www.xefan.com/archives/83875.html">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>md5作为计算机安全领域广泛使用的一种散列函数，被用于检测信息是否完整一致。</p>

<p>然而在2004年8月17日的美国加州圣巴巴拉，正在召开的国际密码学会议（Crypto’2004）上来自山东大学的王小云教授做了破译MD5、HAVAL-128、 MD4和RIPEMD算法的报告。她公布了MD系列算法的破解结果。</p>

<p>各位好奇的可以在网上搜索王小云老师的那篇论文，反正我是看不懂的。不过倒是找到了一个md5碰撞的例子，于是就拿来分享一下。</p>

<p>比如有两个文件test1、test2，文件的十六进制内容分别如下：</p>

<pre>
% xxd test1            
0000000: 0e30 6561 559a a787 d00b c6f7 0bbd fe34  .0eaU..........4
0000010: 04cf 0365 9e70 4f85 34c0 0ffb 659c 4c87  ...e.pO.4...e.L.
0000020: 40cc 942f eb2d a115 a3f4 155c bb86 0749  @../.-.....\...I
0000030: 7386 656d 7d1f 34a4 2059 d78f 5a8d d1ef  s.em}.4. Y..Z...

% xxd test2
0000000: 0e30 6561 559a a787 d00b c6f7 0bbd fe34  .0eaU..........4
0000010: 04cf 0365 9e74 4f85 34c0 0ffb 659c 4c87  ...e.tO.4...e.L.
0000020: 40cc 942f eb2d a115 a3f4 15dc bb86 0749  @../.-.........I
0000030: 7386 656d 7d1f 34a4 2059 d78f 5a8d d1ef  s.em}.4. Y..Z...
</pre>


<p>如果想得到文件的原始内容，可以把上面的输出信息保存为一个文本文件（如test.txt），然后再执行命令 xxd -r test1.txt > test 即可。
从上面可以看到这两个文件的内容明显是不一样的，那么现在就来计算一下这两个文件的md5值吧。</p>

<pre>
% md5sum test1
cee9a457e790cf20d4bdaa6d69f01e41  test1
% md5sum test2
cee9a457e790cf20d4bdaa6d69f01e41  test2
</pre>


<p>从计算结果可以看到，虽然这两个文件内容不同，但是它们的md5值却是相同的。这个就是所谓的碰撞。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/11">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/9">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Subscription</h1>
  <!--以下是QQ邮件列表订阅嵌入代码--><script >var nId = "e7ee5da6d322dc7157c25cfd8a7700bb23a056dd1fb18cb4",nWidth="auto",sColor="light",sText="请输入邮件地址：" ;</script><script src="http://list.qq.com/zh_CN/htmledition/js/qf/page/qfcode.js" charset="gb18030"></script>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84159.html">HTTP Access Control跨域请求</a>
      </li>
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84158.html">Xcode文档离线安装</a>
      </li>
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84157.html">Javascript使用async进行流程控制</a>
      </li>
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84156.html">AngularJS学习笔记7——与rails整合</a>
      </li>
    
      <li class="post">
        <a href="http://www.xefan.com/archives/84155.html">AngularJS学习笔记6——与jQuery、Bootstrap结合</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/categories/linux栏目/index.html'>linux栏目 (48)</a></li><li><a href='/categories/python栏目/index.html'>python栏目 (34)</a></li><li><a href='/categories/ruby栏目/index.html'>ruby栏目 (32)</a></li><li><a href='/categories/web开发/index.html'>web开发 (20)</a></li><li><a href='/categories/前端相关/index.html'>前端相关 (9)</a></li><li><a href='/categories/嵌入式栏目/index.html'>嵌入式栏目 (11)</a></li><li><a href='/categories/开源软件/index.html'>开源软件 (20)</a></li><li><a href='/categories/教程/index.html'>教程 (16)</a></li><li><a href='/categories/数据库/index.html'>数据库 (10)</a></li><li><a href='/categories/数据结构和算法/index.html'>数据结构和算法 (16)</a></li><li><a href='/categories/编程开发/index.html'>编程开发 (38)</a></li><li><a href='/categories/网络日志/index.html'>网络日志 (11)</a></li><li><a href='/categories/资源分享/index.html'>资源分享 (24)</a></li></ul>
</section>
<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/tags/access/index.html' style='font-size: 105.3731343283582%'>access(6)</a> <a href='/tags/adobe/index.html' style='font-size: 100.8955223880597%'>adobe(1)</a> <a href='/tags/ajax/index.html' style='font-size: 102.68656716417911%'>ajax(3)</a> <a href='/tags/angular/index.html' style='font-size: 106.26865671641791%'>angular(7)</a> <a href='/tags/apache/index.html' style='font-size: 100.8955223880597%'>apache(1)</a> <a href='/tags/arch/index.html' style='font-size: 106.26865671641791%'>Arch(7)</a> <a href='/tags/arm/index.html' style='font-size: 107.16417910447761%'>ARM(8)</a> <a href='/tags/asp/index.html' style='font-size: 106.26865671641791%'>asp(7)</a> <a href='/tags/c/index.html' style='font-size: 111.64179104477611%'>C(13)</a> <a href='/tags/css/index.html' style='font-size: 101.7910447761194%'>css(2)</a> <a href='/tags/django/index.html' style='font-size: 102.68656716417911%'>Django(3)</a> <a href='/tags/dreamweaver/index.html' style='font-size: 100.8955223880597%'>Dreamweaver(1)</a> <a href='/tags/fedora/index.html' style='font-size: 101.7910447761194%'>Fedora(2)</a> <a href='/tags/firefox/index.html' style='font-size: 102.68656716417911%'>firefox(3)</a> <a href='/tags/flash/index.html' style='font-size: 100.8955223880597%'>Flash(1)</a> <a href='/tags/ftp/index.html' style='font-size: 100.8955223880597%'>ftp(1)</a> <a href='/tags/gcc/index.html' style='font-size: 105.3731343283582%'>gcc(6)</a> <a href='/tags/gentoo/index.html' style='font-size: 101.7910447761194%'>Gentoo(2)</a> <a href='/tags/git/index.html' style='font-size: 103.58208955223881%'>git(4)</a> <a href='/tags/gobject/index.html' style='font-size: 105.3731343283582%'>GObject(6)</a> <a href='/tags/grub/index.html' style='font-size: 100.8955223880597%'>grub(1)</a> <a href='/tags/gtk/index.html' style='font-size: 115.22388059701493%'>gtk(17)</a> <a href='/tags/hash/index.html' style='font-size: 100.8955223880597%'>Hash(1)</a> <a href='/tags/ibus/index.html' style='font-size: 100.8955223880597%'>ibus(1)</a> <a href='/tags/js/index.html' style='font-size: 108.95522388059702%'>js(10)</a> <a href='/tags/linux/index.html' style='font-size: 160.0%'>Linux(67)</a> <a href='/tags/mac/index.html' style='font-size: 100.8955223880597%'>Mac(1)</a> <a href='/tags/mongodb/index.html' style='font-size: 110.74626865671642%'>mongodb(12)</a> <a href='/tags/mysql/index.html' style='font-size: 103.58208955223881%'>mysql(4)</a> <a href='/tags/nginx/index.html' style='font-size: 100.8955223880597%'>nginx(1)</a> <a href='/tags/node/index.html' style='font-size: 100.8955223880597%'>node(1)</a> <a href='/tags/php/index.html' style='font-size: 108.95522388059702%'>php(10)</a> <a href='/tags/ps/index.html' style='font-size: 105.3731343283582%'>PS(6)</a> <a href='/tags/pygame/index.html' style='font-size: 110.74626865671642%'>pygame(12)</a> <a href='/tags/python/index.html' style='font-size: 145.67164179104478%'>python(51)</a> <a href='/tags/qt/index.html' style='font-size: 101.7910447761194%'>Qt(2)</a> <a href='/tags/redis/index.html' style='font-size: 100.8955223880597%'>redis(1)</a> <a href='/tags/redis/index.html' style='font-size: 100.8955223880597%'>Redis(1)</a> <a href='/tags/ruby/index.html' style='font-size: 129.55223880597015%'>Ruby(33)</a> <a href='/tags/scrapy/index.html' style='font-size: 102.68656716417911%'>Scrapy(3)</a> <a href='/tags/shell/index.html' style='font-size: 100.8955223880597%'>shell(1)</a> <a href='/tags/tq2440/index.html' style='font-size: 104.4776119402985%'>TQ2440(5)</a> <a href='/tags/ubuntu/index.html' style='font-size: 106.26865671641791%'>ubuntu(7)</a> <a href='/tags/usb/index.html' style='font-size: 102.68656716417911%'>USB(3)</a> <a href='/tags/vim/index.html' style='font-size: 123.28358208955224%'>vim(26)</a> <a href='/tags/virtualbox/index.html' style='font-size: 102.68656716417911%'>VirtualBox(3)</a> <a href='/tags/vmware/index.html' style='font-size: 100.8955223880597%'>vmware(1)</a> <a href='/tags/w3m/index.html' style='font-size: 100.8955223880597%'>w3m(1)</a> <a href='/tags/web开发/index.html' style='font-size: 113.43283582089552%'>Web开发(15)</a> <a href='/tags/windows/index.html' style='font-size: 106.26865671641791%'>windows(7)</a> <a href='/tags/wordpress/index.html' style='font-size: 100.8955223880597%'>WordPress(1)</a> <a href='/tags/xcode/index.html' style='font-size: 100.8955223880597%'>Xcode(1)</a> <a href='/tags/xml/index.html' style='font-size: 100.8955223880597%'>xml(1)</a> <a href='/tags/免费/index.html' style='font-size: 100.8955223880597%'>免费(1)</a> <a href='/tags/内核/index.html' style='font-size: 100.8955223880597%'>内核(1)</a> <a href='/tags/匹配算法/index.html' style='font-size: 105.3731343283582%'>匹配算法(6)</a> <a href='/tags/单片机/index.html' style='font-size: 101.7910447761194%'>单片机(2)</a> <a href='/tags/嵌入式/index.html' style='font-size: 100.8955223880597%'>嵌入式(1)</a> <a href='/tags/开源软件/index.html' style='font-size: 108.05970149253731%'>开源软件(9)</a> <a href='/tags/排序算法/index.html' style='font-size: 108.05970149253731%'>排序算法(9)</a> <a href='/tags/文件空间/index.html' style='font-size: 100.8955223880597%'>文件空间(1)</a> <a href='/tags/无线网/index.html' style='font-size: 100.8955223880597%'>无线网(1)</a> <a href='/tags/正则式/index.html' style='font-size: 100.8955223880597%'>正则式(1)</a> <a href='/tags/注册机/index.html' style='font-size: 101.7910447761194%'>注册机(2)</a> <a href='/tags/游戏/index.html' style='font-size: 108.95522388059702%'>游戏(10)</a> <a href='/tags/电脑技巧/index.html' style='font-size: 108.05970149253731%'>电脑技巧(9)</a> <a href='/tags/空间/index.html' style='font-size: 100.8955223880597%'>空间(1)</a> <a href='/tags/算法/index.html' style='font-size: 114.32835820895522%'>算法(16)</a> <a href='/tags/红旗/index.html' style='font-size: 100.8955223880597%'>红旗(1)</a> <a href='/tags/经典语录/index.html' style='font-size: 100.8955223880597%'>经典语录(1)</a> <a href='/tags/网络日志/index.html' style='font-size: 105.3731343283582%'>网络日志(6)</a> <a href='/tags/翻译/index.html' style='font-size: 123.28358208955224%'>翻译(26)</a> <a href='/tags/视频教程/index.html' style='font-size: 108.95522388059702%'>视频教程(10)</a> <a href='/tags/资源分享/index.html' style='font-size: 110.74626865671642%'>资源分享(12)</a> <a href='/tags/转载/index.html' style='font-size: 101.7910447761194%'>转载(2)</a> <a href='/tags/随笔/index.html' style='font-size: 100.8955223880597%'>随笔(1)</a> </span>
</section>
<section>
  <h1>Link</h1>
    <ul id="category-list">
      <li><a target="_blank" title="我的Github" href="https://github.com/wusuopu">@Github</a></li>
      <li><a target="_blank" title="我的微博" href="http://www.weibo.com/u/1768691343">@Weibo</a></li>
      <li><a target="_blank" title="我的Twitter" href="https://twitter.com/longchangjin">@Twitter</a></li>
      <li><a target="_blank" title="我的豆瓣" href="http://www.douban.com/people/lchj/">@Douban</a></li>

      <li><a target="_blank" title="" href="http://www.vimer.cn/">Vimer的程序世界</a></li>
      <li><a target="_blank" title="" href="http://pythoner.net/">python开发者社区</a></li>
      <li><a target="_blank" title="" href="http://simple-is-better.com/">python.cn(news, jobs)</a></li>
      <li><a target="_blank" title="" href="http://gtk.awaysoft.com/">GTK+ 中文社区</a></li>
    </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - 龍昌 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
<div style="display:none;"><script src="http://s94.cnzz.com/stat.php?id=1259846&web_id=1259846&show=pic" language="JavaScript"></script></div>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'longchang';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      //dsq.src = '/javascripts/disqus/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
